{"componentChunkName":"component---src-templates-blog-post-js","path":"/angularjs/2016/03/29/exploring-angular-1.5-lifecycle-hooks.html","webpackCompilationHash":"0c5d630095500f933ccd","result":{"data":{"site":{"siteMetadata":{"title":"Articles by thoughtram","authors":[{"id":"pascal_precht","name":"Pascal Precht","twitter":"PascalPrecht","img":"https://avatars2.githubusercontent.com/u/445106?s=460&v=4"},{"id":"christoph_burgdorf","name":"Christoph Burgdorf","twitter":"cburgdorf","img":"https://avatars0.githubusercontent.com/u/521109?s=460&v=4"},{"id":"dominic_elm","name":"Dominic Elm","twitter":"d3lm","img":"https://avatars0.githubusercontent.com/u/12571019?s=400&v=4"},{"id":"thomas_burleson","name":"Thomas Burleson","twitter":"thomasburleson","img":"https://avatars3.githubusercontent.com/u/210413?s=400&v=4"},{"id":"elvira_eulitz","name":"Elvira Eulitz","twitter":"ElviraEulitz","img":"https://avatars3.githubusercontent.com/u/29247040?s=400&v=4"},{"id":"maxim_koretskyi","name":"Maxim Koretskyi","twitter":"maxim_koretskyi","img":"https://avatars3.githubusercontent.com/u/6124091?s=400&v=4"}]}},"markdownRemark":{"id":"bde2eb10-a518-50e3-ac0a-684bf25b8f84","excerpt":"Angular 1.5 has been finally released and it’s more powerful than ever before! Many new features have been added and tons of fixes landed in the latest bigger…","html":"<p>Angular 1.5 has been finally released and it’s more powerful than ever before! Many new features have been added and tons of fixes landed in the latest bigger release. If you’re following our articles, you know that we love to give an overview of the latest and greatest in the Angular world. Last year we blogged about the 1.3 release in our article series <a href=\"http://blog.thoughtram.io/exploring-angular-1.3\">Exploring Angular 1.3</a>. With this article we’re going to start a new series called, guess what, “Exploring Angular 1.5”, and the first topic we’re going to explore is the new feature of <strong>Lifecycle Hooks</strong>. Let’s get started right away!</p>\n<h2>Lifecycle Hooks</h2>\n<p>Lifecycle hooks in Angular landed first in the Angular 2 alpha release and they are more or less inspired by the <a href=\"http://webcomponents.org/articles/introduction-to-custom-elements/#lifecycle-callbacks\">Custom Elements lifecycle callbacks</a>. By inspired we mean that they are not exactly the same. They’re not only named differently and do different things, there are also more. An Angular 2 component comes with lifecycle hooks like <code class=\"language-text\">ngOnInit()</code>, <code class=\"language-text\">ngOnDestroy()</code>, <code class=\"language-text\">ngOnChanges()</code> and many more. We get a very detailed overview of these in the <a href=\"https://angular.io/docs/ts/latest/guide/lifecycle-hooks.html\">official docs</a>.</p>\n<p>However, this article is on Angular 1.5. Since Angular 1 is evolving in a way to keep the gap to Angular 2 as small as possible, some lifecycle callbacks have been backported to the current “best Angular yet”. Let’s take a look at them one by one.</p>\n<p><strong>Note: The Angular lifecycle-hooks were introduced in version 1.5.3.</strong></p>\n<h2><code class=\"language-text\">$onInit()</code></h2>\n<p>This lifecycle hook will be executed when all controllers on an element have been constructed and after their bindings are initialized. This hook is meant to be used for any kind of initialization work of a controller. To get a better idea of how this behaves, let’s take a look at some code.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> mod <span class=\"token operator\">=</span> angular<span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyCmpController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Pascal'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nmod<span class=\"token punctuation\">.</span><span class=\"token function\">component</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myCmp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token string\">'&lt;h1>{{$ctrl.name}}&lt;/h1>'</span><span class=\"token punctuation\">,</span>\n  controller<span class=\"token punctuation\">:</span> MyCmpController\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We start off with an <a href=\"https://docs.angularjs.org/guide/component\">Angular 1.5 component</a> <code class=\"language-text\">myCmp</code>. A component has a controller and a template, and in our example, our component simply has a <code class=\"language-text\">name</code> property that we interpolate. <code class=\"language-text\">$ctrl</code> is the default <code class=\"language-text\">controllerAs</code> namespace, which is super nice because we don’t have to set it up.</p>\n<p>We can now move the initialization work into the <code class=\"language-text\">$onInit</code> lifecycle hook, by defining the hook on the controller instance:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">MyCmpController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">$onInit</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'My Component'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Okay great. But uhm… what’s the big deal? Well, while the resulting output will be the same, we now have the nice side effect that this component doesn’t do any initialization work when its constructor is called. Imagine we’d need to do some http requests during initialization of this component or controller. We’d need to take care of mocking these requests whenever we construct such a component. Now we have a better place for these kind of things.</p>\n<p><strong>Intercomponent Communication</strong></p>\n<p>Another nice thing about <code class=\"language-text\">$onInit</code>, is that we can access controllers of parent components on our own component’s controller, as those are exposed to it for intercomponent communication. This means it’s not even necessary anymore to have a <code class=\"language-text\">link()</code> function to access other directive controllers.</p>\n<p>For example, if we’d build a <code class=\"language-text\">&lt;tabs&gt;</code> component and a <code class=\"language-text\">&lt;tab&gt;</code> component, where the latter needs access to the <code class=\"language-text\">TabsController</code> to register itself on it, we can simply ask for it using the <code class=\"language-text\">require</code> property an call it directly via the controller instance.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">mod<span class=\"token punctuation\">.</span><span class=\"token function\">component</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myTab'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  require<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    tabsCtrl<span class=\"token punctuation\">:</span> <span class=\"token string\">'^myTabs'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">controller</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">$onInit</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tabsCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">addTab</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>So after all, this aligns perfectly with what we’ve predicted a long time ago in our article on <a href=\"/angularjs/2015/01/02/exploring-angular-1.3-bindToController.html\">binding to directive controllers</a>.</p>\n<h2><code class=\"language-text\">$onChanges()</code></h2>\n<p>This hook allows us to react to changes of one-way bindings of a component. One-way bindings have also been introduced in Angular 1.5 and align a bit more with Angular 2’s uni-directional data flow. Let’s say we make the <code class=\"language-text\">name</code> property of our <code class=\"language-text\">myCmp</code> configurable from the outside world using a one-way binding:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">mod<span class=\"token punctuation\">.</span><span class=\"token function\">component</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myCmp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token string\">'&lt;h1>{{$ctrl.name}}&lt;/h1>'</span><span class=\"token punctuation\">,</span>\n  bindings<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token string\">'&lt;'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  controller<span class=\"token punctuation\">:</span> MyCmpController\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We can now bind an expression to the component’s <code class=\"language-text\">name</code> property like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>my-cmp</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>someExpression<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>my-cmp</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Let’s say we want to prepend the name with “Howdy” when the name is “Pascal” and otherwise simply greet with “Hello”. We can do that using the <code class=\"language-text\">$onChanges()</code> lifecycle hook. It gets called with an object that holds the changes of all one-way bindings with the <code class=\"language-text\">currentValue</code> and the <code class=\"language-text\">previousValue</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">MyCmpController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">$onChanges</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">changesObj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>changesObj<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> prefix<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">(</span>changesObj<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>currentValue <span class=\"token operator\">===</span> <span class=\"token string\">'Pascal'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span>\n        prefix <span class=\"token operator\">=</span> <span class=\"token string\">'Howdy '</span> <span class=\"token punctuation\">:</span> prefix <span class=\"token operator\">=</span> <span class=\"token string\">'Hello '</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> prefix <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Neat stuff!</p>\n<h2><code class=\"language-text\">$onDestroy()</code></h2>\n<p><code class=\"language-text\">$onDestroy()</code> is a hook that is called when its containing scope is destroyed. We can use this hook to release external resources, watches and event handlers.</p>\n<p>For example, if we’d manually set up a <code class=\"language-text\">click</code> handler (instead of using <code class=\"language-text\">ng-click</code>), we need unregister the event handler when the component is destroyed, otherwise it’ll keep hanging around and leaks memory.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">MyCmpController</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">$element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">clickHandler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// do something</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">$onInit</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    $element<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> clickHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">$onDestroy</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    $element<span class=\"token punctuation\">.</span><span class=\"token function\">off</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> clickHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2><code class=\"language-text\">$postLink()</code></h2>\n<p>There has been a lot of discussion around the fact that <code class=\"language-text\">bindToController</code> pushes us into the direction not to use <code class=\"language-text\">compile()</code> and <code class=\"language-text\">link()</code> anymore, and rather stick to simply <code class=\"language-text\">controller()</code> because it does the same job almost all the time, because it seemed unclear what to do when DOM manipulation needs to be done.</p>\n<p>Well, it turns out there has always been the local injectable <code class=\"language-text\">$element</code>, which is basically a reference to the DOM element on which our directive is applied. This reference can and could be used to do DOM manipulation, even in the controller.</p>\n<p>This still gave some Angular users a weird feeling because there’s this one rule to not do DOM manipulations in the controller. This rule still applies, unless we’re talking about directive controllers. And a component controller <strong>is</strong> a directive controller.</p>\n<p>In Angular 1.5 it gets even better, because there’s a lifecycle hook called <code class=\"language-text\">$postLink()</code>, which not only can be the place where we do all of the DOM manipulation, but it’s also the hook where we know that all child directives have been compiled and linked.</p>\n<p>We’ll see if there are going to be more lifecycle hooks that Angular 1.5 can take advantage of. We clearly can’t simply backport all of Angular 2’s lifecycle hooks, because the compilation process is not exactly the same, so some lifecycle hooks don’t really make sense in an Angular 1 world.</p>","frontmatter":{"author":"pascal_precht","title":"Exploring Angular 1.5: Lifecycle Hooks","imageUrl":null,"date":"29 March 2016","summary":"Angular 1.5 is finally out! This article discusses the new lifecycle hooks in Angular.","categories":["angularjs"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/angularjs/2016/03/29/exploring-angular-1.5-lifecycle-hooks.html","previous":{"fields":{"slug":"/angular/2016/03/21/template-driven-forms-in-angular-2.html"},"frontmatter":{"date":"2016/03/21","title":"Template-driven Forms in Angular","categories":["angular"]}},"next":{"fields":{"slug":"/announcements/2016/04/15/updates-and-announcements.html"},"frontmatter":{"date":"2016/04/15","title":"Updates and announcements","categories":["announcements"]}}}}}