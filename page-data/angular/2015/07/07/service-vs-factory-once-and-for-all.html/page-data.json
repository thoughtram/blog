{"componentChunkName":"component---src-templates-blog-post-js","path":"/angular/2015/07/07/service-vs-factory-once-and-for-all.html","webpackCompilationHash":"0c5d630095500f933ccd","result":{"data":{"site":{"siteMetadata":{"title":"Articles by thoughtram","authors":[{"id":"pascal_precht","name":"Pascal Precht","twitter":"PascalPrecht","img":"https://avatars2.githubusercontent.com/u/445106?s=460&v=4"},{"id":"christoph_burgdorf","name":"Christoph Burgdorf","twitter":"cburgdorf","img":"https://avatars0.githubusercontent.com/u/521109?s=460&v=4"},{"id":"dominic_elm","name":"Dominic Elm","twitter":"d3lm","img":"https://avatars0.githubusercontent.com/u/12571019?s=400&v=4"},{"id":"thomas_burleson","name":"Thomas Burleson","twitter":"thomasburleson","img":"https://avatars3.githubusercontent.com/u/210413?s=400&v=4"},{"id":"elvira_eulitz","name":"Elvira Eulitz","twitter":"ElviraEulitz","img":"https://avatars3.githubusercontent.com/u/29247040?s=400&v=4"},{"id":"maxim_koretskyi","name":"Maxim Koretskyi","twitter":"maxim_koretskyi","img":"https://avatars3.githubusercontent.com/u/6124091?s=400&v=4"}]}},"markdownRemark":{"id":"e30adc77-f256-534b-b664-89cf54552458","excerpt":"Wait, what? Yet another article that answers the big question: Service vs Factory, what should I use? Yes, it seems that this is not needed anymore, since there…","html":"<p>Wait, what? Yet another article that answers the big question: Service vs Factory, what should I use? Yes, it seems that this is not needed anymore, since there are a ton of resources in the internet that discuss that topic. It turns out that this question still pops up every week or so on different channels, and even after reading the top ten answers on StackOverflow, it’s still not very clear. Despite that, it also appears that the current resources on the web don’t really promote the actual best practice, especially if we consider the recent movements of the web platform. ES6 I’m looking at you!</p>\n<p>This article explains once and for all the difference between services and factories and why <strong>we want to prefer services over factories</strong>.</p>\n<h2>The difference between services and factories</h2>\n<p>Okay, so what is the difference between a service and a factory in AngularJS? As we all know, we can define a service like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MyService'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sayHello</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">.service()</code> is a method on our module that takes a name and a function that defines the service. Pretty straight forward. Once defined, we can inject and use that particular service in other components, like controllers, directives and filters, like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">controller</span><span class=\"token punctuation\">(</span><span class=\"token string\">'AppController'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">MyService</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  MyService<span class=\"token punctuation\">.</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// logs 'hello'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Okay, clear. Now the same thing as a factory:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MyService'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">sayHello</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Again, <code class=\"language-text\">.factory()</code> is a method on our module and it also takes a name and a function, that defines the factory. We can inject and use that thing exactly the same way we did with the service. Now what is the difference here?</p>\n<p>Well, you might see that instead of working with <code class=\"language-text\">this</code> in the factory, we’re returning an object literal. Why is that? It turns out, <strong>a service is a constructor function</strong> whereas a factory is not. Somewhere deep inside of this Angular world, there’s this code that calls <code class=\"language-text\">Object.create()</code> with the service constructor function, when it gets instantiated. However, a factory function is really just a function that gets called, which is why we have to return an object explicitly.</p>\n<p>To make that a bit more clear, we can simply take a look at the Angular source code. Here’s what the <code class=\"language-text\">factory()</code> function looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> factoryFn<span class=\"token punctuation\">,</span> enforce</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">provider</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    $<span class=\"token keyword\">get</span><span class=\"token punctuation\">:</span> enforce <span class=\"token operator\">!==</span> <span class=\"token boolean\">false</span> <span class=\"token operator\">?</span> <span class=\"token function\">enforceReturnValue</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> factoryFn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> factoryFn\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It takes the name and the factory function that is passed and basically returns a provider with the same name, that has a <code class=\"language-text\">$get</code> method which is our factory function. So what is it with this provider thing? Well, whenever you ask the injector for a specific dependency, it basically asks the corresponding provider for an instance of that service, by calling the <code class=\"language-text\">$get()</code> method. That’s why <code class=\"language-text\">$get()</code> is required, when creating providers.</p>\n<p>In other words, if we inject <code class=\"language-text\">MyService</code> somewhere, what happens behind the scenes is:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">MyServiceProvider<span class=\"token punctuation\">.</span>$<span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// return the instance of the service</span></code></pre></div>\n<p>Alright, factory functions just get called, what about the service code? Here’s another snippet:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> constructor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'$injector'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">$injector</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> $injector<span class=\"token punctuation\">.</span><span class=\"token function\">instantiate</span><span class=\"token punctuation\">(</span>constructor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Oh look, it turns out that when we call <code class=\"language-text\">service()</code> it actually calls <code class=\"language-text\">factory()</code>. But it doesn’t just pass our service constructor function to the factory as it is. It passes a function that asks the injector to instantiate and object by the given constructor. In other words: a service calls a predefined factory, which ends up as <code class=\"language-text\">$get()</code> method on the corresponding provider. <code class=\"language-text\">$injector.instantiate()</code> is the method that ultimately calls <code class=\"language-text\">Object.create()</code> with the constructor function. That’s why we use <code class=\"language-text\">this</code> in services.</p>\n<p>Okay, so it turns out that, no matter what we use, <code class=\"language-text\">service()</code> or <code class=\"language-text\">factory()</code>, it’s always a factory that is called which creates a provider for our service. Which brings us to the mostly asked question in the Angular history: Which one should I use?</p>\n<h2>Which one to use?</h2>\n<p>Asking that question on the internet takes us to a couple of articles and StackOverflow answers. The first is <a href=\"http://stackoverflow.com/questions/13762228/confused-about-service-vs-factory\">this</a> answer. It says:</p>\n<p>“Basically the difference between the service and factory is as follows:”</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myService'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// service is just a constructor function</span>\n  <span class=\"token comment\">// that will be called with 'new'</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sayHello</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token keyword\">return</span> <span class=\"token string\">\"Hi \"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token string\">\"!\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myFactory'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// factory returns an object</span>\n  <span class=\"token comment\">// you can run some code before</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">sayHello</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token string\">\"Hi \"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token string\">\"!\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We now already know what happens behind the scenes, but this answer adds another comment. It says we can run code <strong>before</strong> we return our object literal. That basically allows us to do some configuration stuff or conditionally create an object or not, which doesn’t seem to be possible when creating a service directly, which is why <strong>most resources recommend to use factories over services, but the reasoning is inappreciable.</strong></p>\n<p>What if I told you, <strong>we can do the exact same thing with services too?</strong></p>\n<p>Yeap, correct. A service is a constructor function, however, that doesn’t prevent us from doing additional work and return object literals. In fact, constructor functions in JavaScript can return whatever they want. So we can take our service code and write it in a way that it basically does the exact same thing as our factory:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MyService'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// we could do additional work here too</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">sayHello</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Hoppla, so what now? We just realised that, depending on how we write our services, there’s no difference between the two at all anymore. The big question remains: Which one should we use?</p>\n<h2>Services allow us to use ES6 classes</h2>\n<p>Of course, writing services in that way is kind of contra productive, since it’s called as a constructor function, so it should also be used like one. Is there any advantage over the other at all then? Yes, there is. It turns out that it’s actually better to use services where possible, when it comes to migrating to ES6. The reason for that is simply that a service is a constructor function and a factory is not. Working with constructor functions in ES5 allows us to easily use ES6 classes when we migrate to ES6.</p>\n<p>For example, we can take our code and rewrite it in ES6 like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MyService'</span><span class=\"token punctuation\">,</span> MyService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>An ES6 class is really just a constructor function in ES5. We wrote about that in <a href=\"/angularjs/es6/2015/01/23/exploring-angular-1.3-using-es6.html\">Using ES6 with Angular today</a>, if you haven’t read that article yet, I’d recommend checking that out.</p>\n<p>With factories, this is not possible because they are simply called as functions. I hope this article made everything clear and encourages people to <strong>not</strong> use factories over services, if they don’t know what to use.</p>\n<p>This and more you learn in our <a href=\"http://thoughtram.io/angular-master-class.html\">Angular Master Class</a>!</p>","frontmatter":{"author":"pascal_precht","title":"Service vs Factory - Once and for all","imageUrl":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAABnklEQVQ4y41T2WKCMBDsa6sSTns+9cmDm3Ar2vb/v2k7mwC2tioPQxYIw8zO5s5LW3rM9rTMduQmLdlYGVbSkAhrMtMjmcmBrKihxTan+Uaq9bwecCeCksywIgvgVYQlUJGB5wwmVeA6KMjwi4tkipBfWPiAlTpxQ05UK6Uuag/rACeuycY7K6quE/JFBLlSYAZQCRVajVZp9uB9s7VURAPZv5aNrYS6hJ7zil7LjrysJRMq3PyLnOxIT3mn+nv+4VWFVlQoUjuSJGDL8KUicWJWqft2TdUvQu6J8Eu6X0llabbOaI71YZX1dY8bVkdCbrQNUhtN56RZoRnVY9IialE3qq+TFLqYN06VU2ZSE/cKqA0EI+IO2KMtuJ9CyBs4xWEsWC2PDNd6dKDOz6db5guPC8+imrNQ2+eaf+L05FPsnsYmSUCU4UGhg9jocDTkZHWj5WVa0fvugFlscIZxjuUnOcBb9UEvRacCmaJuJDSgzEsy2EtVygv0jO1yUEZ/ihascgqh6mHICvIeJ4uzzV+7Ny1zw8WPk3AJUy1/A8gqzQzmi7CIAAAAAElFTkSuQmCC","aspectRatio":1.266211604095563,"src":"/static/6ba1cdb98fc1e5f51fd52d2f15a484c5/57090/service-vs-factory.png","srcSet":"/static/6ba1cdb98fc1e5f51fd52d2f15a484c5/d9446/service-vs-factory.png 158w,\n/static/6ba1cdb98fc1e5f51fd52d2f15a484c5/2f6e7/service-vs-factory.png 315w,\n/static/6ba1cdb98fc1e5f51fd52d2f15a484c5/57090/service-vs-factory.png 630w,\n/static/6ba1cdb98fc1e5f51fd52d2f15a484c5/0b009/service-vs-factory.png 742w","sizes":"(max-width: 630px) 100vw, 630px"}}},"date":"07 July 2015","summary":"This is yet another article on services vs factories in AngularJS. It explains once and for all, why we mostly want to use service.","categories":["angular"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/angular/2015/07/07/service-vs-factory-once-and-for-all.html","previous":{"fields":{"slug":"/angular/2015/07/06/even-better-es5-code-for-angular-2.html"},"frontmatter":{"date":"2015/07/06","title":"Even better ES5 code for Angular","categories":["angular"]}},"next":{"fields":{"slug":"/rust/2015/07/29/a-web-app-with-nickel-from-first-line-to-heroku-deployment.html"},"frontmatter":{"date":"2015/07/29","title":"A web app with Nickel: From first line to Heroku deployment","categories":["rust"]}}}}}