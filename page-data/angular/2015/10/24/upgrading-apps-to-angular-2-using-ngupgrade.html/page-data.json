{"componentChunkName":"component---src-templates-blog-post-js","path":"/angular/2015/10/24/upgrading-apps-to-angular-2-using-ngupgrade.html","webpackCompilationHash":"0c5d630095500f933ccd","result":{"data":{"site":{"siteMetadata":{"title":"Articles by thoughtram","authors":[{"id":"pascal_precht","name":"Pascal Precht","twitter":"PascalPrecht","img":"https://avatars2.githubusercontent.com/u/445106?s=460&v=4"},{"id":"christoph_burgdorf","name":"Christoph Burgdorf","twitter":"cburgdorf","img":"https://avatars0.githubusercontent.com/u/521109?s=460&v=4"},{"id":"dominic_elm","name":"Dominic Elm","twitter":"d3lm","img":"https://avatars0.githubusercontent.com/u/12571019?s=400&v=4"},{"id":"thomas_burleson","name":"Thomas Burleson","twitter":"thomasburleson","img":"https://avatars3.githubusercontent.com/u/210413?s=400&v=4"},{"id":"elvira_eulitz","name":"Elvira Eulitz","twitter":"ElviraEulitz","img":"https://avatars3.githubusercontent.com/u/29247040?s=400&v=4"},{"id":"maxim_koretskyi","name":"Maxim Koretskyi","twitter":"maxim_koretskyi","img":"https://avatars3.githubusercontent.com/u/6124091?s=400&v=4"}]}},"markdownRemark":{"id":"eceda728-5e95-5c97-814b-16031216360f","excerpt":"Upgrading an existing AngularJS application to Angular >= 2.x is surely one of the most interesting topics when it comes to Angular. A long time it has been…","html":"<p>Upgrading an existing AngularJS application to Angular >= 2.x is surely one of the most interesting topics when it comes to Angular. A long time it has been unclear what a dedicated upgrade path will actually look like, since Angular was still in alpha state and APIs weren’t stable yet, which makes it hard to “assume” where things will go and what’s the best way to get there.</p>\n<p>Earlier this year however, the Angular team has made an <a href=\"http://angularjs.blogspot.de/2015/08/angular-1-and-angular-2-coexistence.html\">official announcement</a> in which they talk about what are the available upgrade strategies and what things of both frameworks have to interoperate in order to run them side-by-side on the same website. While the blog post is rather a kind of birds-eye view where no code is shown, a dedicated <a href=\"https://docs.google.com/document/d/1xvBZoFuNq9hsgRhPPZOJC-Z48AHEbIBPlOCBTSD8m0Y\">design document</a> has been created that gives a more concrete idea on what the APIs will look like.</p>\n<p>Meanwhile, first implementations of <code class=\"language-text\">ngUpgrade</code> have landed in the code base and it’s time to start digging into it. In this article we’re going to explore what we can do to prepare for an upgrade, and of course how we eventually use <code class=\"language-text\">ngUpgrade</code> to upgrade our Angular application.</p>\n<h2>Why upgrade?</h2>\n<p>One thing that seems to be a bit left out when people get scared that they can’t upgrade to Angular >= 2.x for various reasons, is to think about if an upgrade is needed in the first place. Of course, Angular >= 2.x is the next major version of the framework and it will surely be the version we want to go with when building web applications in the future.</p>\n<p>However, that doesn’t mean that our existing Angular 1 applications aren’t good enough anymore to survive the next generation of the web. It’s not that once Angular 2.x is out, our Angular 1 applications immediately stop working. We still have a massive amount of websites out there that seem to be outdated, old and slow. Believe it or not, even if those websites are over 10 years old, they still work. That’s the nice thing about the web, nothing is as backwards compatible because no one wants to break the web, right?</p>\n<p>So before we think about going through the process upgrading we should really ask ourselves why we want to do it and if the applications we’ve built so far are really in a state that they need this upgrade.</p>\n<p>Nonetheless there are some very strong arguments why one wants to upgrade and here are just a few of them:</p>\n<ul>\n<li><strong>Better Performance</strong> - Angular comes with a way faster change detection, template precompilation, faster bootstrap time, view caching and plenty other things that make the framework freakin’ fast.</li>\n<li><strong>Server-side Rendering</strong> - The next version of Angular has been split up into two parts, an application layer and a render layer. This enables us to run Angular in other environments than the browser like Web Workers or even servers.</li>\n<li><strong>More powerful Templating</strong> - The new template syntax is statically analyzable as discussed <a href=\"/angular/2015/08/11/angular-2-template-syntax-demystified-part-1.html\">here</a>, removes many directives and integrates better with Web Components and other elements.</li>\n<li><strong>Better Ecosystem</strong> - Of course, at the time of writing this article, this is not true. But the Angular ecosystem will eventually be better and more interesting to us in the future.</li>\n</ul>\n<p>There are surely more reasons why Angular >= 2.x is better than Angular 1.x, but keep in mind that we’re talking about the motivation for upgrade here. Let’s talk about how we can prepare for an actual upgrade.</p>\n<h2>Changes in Angular</h2>\n<p>In order to upgrade, we need to understand in what ways Angular >= 2.x is different. Unfortunately, covering the bigger differences between both version of the framework is out of the scope of this article. However, if you’re entirely new to Angular, you might want to checkout our project <a href=\"/exploring-angular-2\">Exploring Angular</a> and get your feet wet.</p>\n<p>Here’s a list of changes that are crucial when thinking about upgrading:</p>\n<ul>\n<li><strong>Components</strong> - Components are the new building blocks when creating applications with Angular. Almost everything is a component, even our application itself.</li>\n<li><strong>Inputs/Outputs</strong> - Components communicate via inputs and outputs, if they run in the Browser, these are element properties and events. Our article on <a href=\"/angular/2015/08/11/angular-2-template-syntax-demystified-part-1.html\">demystifying Angular’s Template syntax</a> explains how they work.</li>\n<li><strong>Content Projection</strong> - Basically the new transclusion, but more aligned with the Web Components standard.</li>\n<li><strong>Dependency Injection</strong> - Instead of having a single injector for our entire application, in Angular each component comes with its own injector. We have a dedicated <a href=\"/angular/2015/05/18/dependency-injection-in-angular-2.html\">article</a> on that too.</li>\n</ul>\n<p>Of course, there are way more things in Angular that will change or be added to the framework, such as <a href=\"/angular/2016/06/14/routing-in-angular-2-revisited.html\">Routing</a>, Forms, the Http layer and more.</p>\n<p><strong>How do we get there?</strong></p>\n<p>After doing tons of research at thoughtram with <a href=\"http://twitter.com/cburgdorf\">Christoph</a> we realised, that the entire upgrade process can basically be categorized in two phases: Preparation and Upgrade.</p>\n<p><img src=\"/6f49d0871e4dd635846506901215239e/upgrade-2-phases-3.svg\"></p>\n<p><strong>Preparation</strong></p>\n<p>This is the phase that we could start off today. What can we do today to make the upgrade process later on easier? This includes several things like how we structure our application, which tools can we use or maybe even a language upgrade.</p>\n<p><strong>Upgrade</strong></p>\n<p>The phase of running both frameworks side-by-side. This is where <code class=\"language-text\">ngUpgrade</code> comes into play to make A1 and A2 components interoperable. Keep in mind that the goal of this phase is to stay in it as little as possible, since running both frameworks on the same website is surely not ideal.</p>\n<h2>Preparing for upgrade</h2>\n<p>Let’s discuss what we can do today to prepare for an actual upgrade.</p>\n<p><strong>Layer application by feature or component</strong></p>\n<p>Oldie but goldie. We still see applications using a project structure where all directives go into <code class=\"language-text\">app/directives</code>, services go into <code class=\"language-text\">app/services</code>, controllers into <code class=\"language-text\">app/controllers</code> and so on and so forth. You get the idea. While this totally works in smaller applications, it doesn’t really take us far when it comes to upgrading. We might want to upgrade component by component. Having an application layered by type rather than by feature/component, makes it harder to extract parts of the code base to upgrade it.</p>\n<p>We should rather go with something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">app\n|- components\n  |- productDetail\n  | |- productDetail.js\n  | |- productDetail.css\n  | |- productDetail.html\n  | |- productDetail.spec.js\n  |- productList\n  |- checkout\n  |- wishlist</code></pre></div>\n<p>This structure allows us to take e.g. <code class=\"language-text\">productDetail</code> and upgrade it to Angular >= 2.x to integrate it back into the application later on. We don’t have to worry if there’s anything else related to <code class=\"language-text\">productDetail</code> in the code base that we might forget, because everything is in one place.</p>\n<p><strong>Use .service() instead of .factory()</strong></p>\n<p>If we plan to not only upgrade the framework, but also the language in which we’re writing our application, we should definitely consider to use <code class=\"language-text\">.service()</code> instead of <code class=\"language-text\">.factory()</code> in all the cases where a service can be potentially a class. In Angular, a service is also just a class, so this seems like a logical thing to do. For more information on why <code class=\"language-text\">.service()</code> might be a better fit, read <a href=\"/angular/2015/07/07/service-vs-factory-once-and-for-all.html\">this article</a>.</p>\n<p><strong>Write new components in ES2015 or TypeScript</strong></p>\n<p>This is an interesting one. When we saw Angular code the very first time, some of us were scared because all of a sudden there were classes and decorators. Despite the fact that we <strong>don’t</strong> have to write our Angular apps in TypeScript (as explained in <a href=\"/angular/2015/05/09/writing-angular-2-code-in-es5.html\">this article</a>), ES2015 is the next standardized version, which means we will write it sooner or later anyways.</p>\n<p>We wrote about <a href=\"/angularjs/es6/2015/01/23/exploring-angular-1.3-using-es6.html\">how to write Angular in ES2015</a> today and if we do plan to upgrade but can’t do it right now, we should definitely write our <strong>new</strong> components in ES2015 or TypeScript.</p>\n<p>That being said, <strong>it doesn’t really make sense to upgrade existing code to ES2015 or TypeScript</strong>. Even though it seems to be a logical step in preparation for upgrade, it doesn’t help us in any way to take the existing and large code base and upgrade it to ES2015 or TypeScript first, before we upgrade the application to Angular >=2.x.</p>\n<p>If we have to upgrade to Angular 2.x, it probably makes more sense to just rewrite component by component, without touching the existing code base. But this of course depends on how big our application is.</p>\n<p>Again, this is just a language upgrade and it doesn’t really help with the upgrade itself, however, it helps us and our team to get used to the new languages features as we’re building components with it.</p>\n<p><strong>Use decorators in Angular 1?</strong></p>\n<p>Of course, we can take our code base closer to what Angular 2.x code would look like, by upgrading our language to TypeScript and use e.g. Decorators that have specifically been created for Angular 1. There are plenty community projects out there, some of them are <a href=\"https://github.com/hannahhoward/a1atscript\">a1atscript</a>, <a href=\"https://github.com/pbastowski/angular2-now\">angular2-now</a>, <a href=\"https://github.com/mikeryan52/angular-decorators\">angular-decorators</a> and <a href=\"https://github.com/eaze/ng-classy\">ng-classy</a>.</p>\n<p>They try solve the same problem, which is adding semantically useful decorators to Angular 1. But do they really help? <strong>I don’t think so</strong>. They might improve the developer experience because all of a sudden we can use nice decorators that generate code for us, however, they don’t help when it comes to upgrading an application to Angular >= 2.x. One project, <a href=\"https://github.com/ngUpgraders/ng-forward\">ng-forward</a>, tries to make the exact same Angular syntax available in Angular 1.x.</p>\n<p>This <em>can</em> be helpful to some extent since you and your team are getting familiar with how to write apps in Angular 2.x while writing Angular 1.x code. On the other hand, it could also be confusing when trying to squeeze Angular 2.x concepts and syntax into the Angular 1.x world. We’ll see how practical it is once projects are starting to use it.</p>\n<h2>Upgrade Strategies</h2>\n<p>Now that we know what we can do to prepare for an upgrade, let’s take a look at the different upgrade strategies available to see which one makes more sense to us.</p>\n<p>There are basically two strategies:</p>\n<ul>\n<li><strong>Big Bang</strong> - Start a spike in Angular >= 2.x and replace entire app once done</li>\n<li><strong>Incremental</strong> - Upgrade existing app once service or component at a time</li>\n</ul>\n<p><strong>Which one should we use?</strong></p>\n<p>This really depends! If our application is rather small a big bang rewrite is probably the easiest and fastest way to upgrade. If our application is rather large and it’s deployed continuesly, we can’t just upgrade the whole thing at once. We need a way to do it step by step, component by component, service by service. This is where the incremental upgrade comes into play.</p>\n<p>In the end it’s really a matter of how much time we have available to process the upgrade. We will focus on incremental upgrade, since this is what the majority of developers want to understand and see how it works.</p>\n<h2>Upgrading using ngUpgrade</h2>\n<p>In order to run both frameworks side-by-side and make components interoperable, the Angular projects comes with a module <code class=\"language-text\">ngUpgrade</code>. The module basically acts as an adapter facade, so we don’t really feel that there are two frameworks running side-by-side.</p>\n<p>For this to work, four things need to interoperate:</p>\n<ul>\n<li><strong>Dependency Injection</strong> - Exposing Angular services into Angular 1.x components and vice-versa.</li>\n<li><strong>Component Nesting</strong> - Angular 1 directives can be used in Angular 2.x components and Angular 2.x components can used Angular 1 directives</li>\n<li><strong>Content Projection / Transclusion</strong> - Angular 1 components transclude Angular 2.x components and Angular 2.x component project Angular 1 directives</li>\n<li><strong>Change Detection</strong> - Angular 1 scope digest and change detectors in Angular >= 2.x are interleaved</li>\n</ul>\n<p>With these four things being interoperable, we can already start upgrading our applications component by component. Routing is another part that can help but is not necessarily mandatory, since we can totally stick with any Angular 1 routing system while upgrading.</p>\n<p><strong>The typical upgrade process</strong></p>\n<p>Here’s what a typical upgrade process would look like:</p>\n<ul>\n<li>Include Angular and upgrade module</li>\n<li>Pick component to upgrade and change its controller and template Angular 2.x syntax (this is now an Angular 2.x component)</li>\n<li>Downgrade Angular 2.x component to make it run in Angular 1.x app</li>\n<li>Pick a service to upgrade, this usually requires little amount of change (especially if we’re on ES2015)</li>\n<li>Repeat step 2 and 3 (and 4)</li>\n<li>Replace Angular 1 bootstrap with Angular 2.x bootstrap</li>\n</ul>\n<p>Let’s use <code class=\"language-text\">ngUpgrade</code> to upgrade our components to Angular 2.x!</p>\n<p><strong>Bootstrapping with ngUpgrade</strong></p>\n<p>The first thing we need to do is to upgrade our Angular 1 application with <code class=\"language-text\">ngUpgrade</code>. Whenever we upgrade an Agular app, we <strong>always</strong> have an Angular 1.x module being bootstrap at root level. This means, during the process of upgrade, Angular components are always bootstrap inside Angular 1.x components.</p>\n<p>Let’s start with an app we want to upgrade;</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> app <span class=\"token operator\">=</span> angular<span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Plain old Angular 1 module. Usually, this module is bootstrapped using the <code class=\"language-text\">ng-app</code> attribute, but now we want to bootstrap our module using <code class=\"language-text\">ngUpgrade</code>. We do that by removing the <code class=\"language-text\">ng-app</code> attribute from the HTML, create an <code class=\"language-text\">ngUpgrade</code> adapter from the upgrade module, and call <code class=\"language-text\">bootstrap()</code> on it with <code class=\"language-text\">myApp</code> as module dependency:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UpgradeAdapter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/upgrade'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> adapter <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UpgradeAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> app <span class=\"token operator\">=</span> angular<span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nadapter<span class=\"token punctuation\">.</span><span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Cool, our app is now bootstrapped using <code class=\"language-text\">ngUpgrade</code> and we can start mixing Angular 1.x components with Angular 2.x components. However, in a real world application, you want to create an instance of <code class=\"language-text\">UpgradeAdapter</code> in a separate module and import it where you need it. This leads to cleaner code when upgrading across your application.</p>\n<h2>Downgrading Angular 2.x components</h2>\n<p>Let’s upgrade our first component to Angular 2.x and use it in our Angular 1.x application. Here we have a <code class=\"language-text\">productDetail</code> component that needs to be upgraded:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">component</span><span class=\"token punctuation\">(</span><span class=\"token string\">'productDetail'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  bindings<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    product<span class=\"token punctuation\">:</span> <span class=\"token string\">'='</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  controller<span class=\"token punctuation\">:</span> <span class=\"token string\">'ProductDetailController'</span><span class=\"token punctuation\">,</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;h2>{{$ctrl.product.name}}&lt;/h2>\n    &lt;p>{{$ctrl.product.description}}&lt;/p>\n  </span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Upgrading this to Angular 2.x looks something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token punctuation\">:</span> <span class=\"token string\">'product-detail'</span><span class=\"token punctuation\">,</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;h2>{{product.name}}&lt;/h2>\n    &lt;p>{{product.description}}&lt;/p>\n  </span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductDetail</span> <span class=\"token punctuation\">{</span>\n  @<span class=\"token function\">Input</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> product<span class=\"token punctuation\">:</span> Product<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Note</strong>: You might want to define this component in a separate file, for simplicity sake we defined it in place.</p>\n<p>Perfect! But how do we get this Angular component into our Angular 1.x application? The <code class=\"language-text\">UpgradeAdapter</code> we’ve created comes with a method <code class=\"language-text\">downgradeNg2Component()</code>, which takes an Angular component and creates an Angular 1.x directive from it. Let’s use our Angular component in Angular 1.x world.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">directive</span><span class=\"token punctuation\">(</span><span class=\"token string\">'productDetail'</span><span class=\"token punctuation\">,</span>\n  adapter<span class=\"token punctuation\">.</span><span class=\"token function\">downgradeNg2Component</span><span class=\"token punctuation\">(</span>ProductDetail<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Yay! That’s it! The adapter will bootstrap this component from within the Angular 1 template where it’s used. </p>\n<p>But wait, our Angular 2.x component is just an Angular 1.x component eventually? Yes and no. The directive is controlled by Angular 1.x, but the component’s view will be controller by Angular >= 2.x. This means the resulting Angular 1.x components takes advantage of Angular 2.x features and performance.</p>\n<h2>Upgrading Angular 1 components</h2>\n<p>There might be cases where one component has already been upgraded to Angular >= 2.x, but it still uses Angular 1.x directives in its template. <code class=\"language-text\">ngUpgrade</code> allows us to use Angular 1.x directives in Angular 2.x components by upgrading them using <code class=\"language-text\">upgradeNg1Component()</code>.</p>\n<p>Let’s say we continued upgrading our application and have a <code class=\"language-text\">ProductList</code> component like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token punctuation\">:</span> <span class=\"token string\">'product-list'</span><span class=\"token punctuation\">,</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;h2>Product List&lt;/h2>\n    &lt;ol>\n      &lt;li *ngFor=\"let product of products\">\n        &lt;product-list-item [product]=\"product\">\n        &lt;/product-list-item>\n      &lt;/li>\n    &lt;/ol>\n  </span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductList</span> <span class=\"token punctuation\">{</span>\n  @<span class=\"token function\">Input</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> products<span class=\"token punctuation\">:</span> Product<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">&lt;product-list-item&gt;</code> is a component that hasn’t been ported to Angular 2.x yet and maybe can’t even for some reason. It needs to be upgraded but how do we get there? As you can see, there’s a <code class=\"language-text\">directives</code> property in the <code class=\"language-text\">@Component()</code> metadata. This property defines which directives are used in the component’s template. What we need is a way to add <code class=\"language-text\">&lt;product-list-item&gt;</code> there too.</p>\n<p><code class=\"language-text\">upgradeNg1Component()</code> enables us to do exactly that. It takes the name of a directive that has been registered somewhere on our Angular 1 module and upgrades it to an Angular 2.x component. Here’s what it looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>BrowserModule<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  declarations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    AppComponent<span class=\"token punctuation\">,</span>\n    ProductList<span class=\"token punctuation\">,</span>\n    adapter<span class=\"token punctuation\">.</span><span class=\"token function\">upgradeNg1Component</span><span class=\"token punctuation\">(</span><span class=\"token string\">'productListItem'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>All we need to do is to downgrade <code class=\"language-text\">ProductList</code> item and we can use it right away!</p>\n<h2>Adding Angular Providers</h2>\n<p>Upgrading components is probably the most crucial part in the entire upgrade process. Sometimes however, components have service dependencies which need to work in both worlds too. Luckily, <code class=\"language-text\">ngUpgrade</code> provides APIs for that.</p>\n<p>Let’s say our <code class=\"language-text\">ProductDetail</code> component, already upgraded to Angular >= 2.x, has a <code class=\"language-text\">ProductService</code> dependency.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductService</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">}</span>\n\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductDetail</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">productService<span class=\"token punctuation\">:</span> ProductService</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In Angular >= 2.x, we have to add a provider configuration for the component’s injector, but since we don’t bootstrap using Angular 2.x, there’s no way to do so. <code class=\"language-text\">ngUpgrade</code> allows us to add a provider using the <code class=\"language-text\">addProvider()</code> method to solve this scenario.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">adapter<span class=\"token punctuation\">.</span><span class=\"token function\">addProvider</span><span class=\"token punctuation\">(</span>ProductService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That’s all we need to do!</p>\n<h2>Upgrading Angular 1 Providers</h2>\n<p>Let’s say our <code class=\"language-text\">ProductService</code> depends on another lower level <code class=\"language-text\">DataService</code> to communicate with a remote server. <code class=\"language-text\">DataService</code> is already implemented in our Angular 1 application but not yet upgraded to Angular 2.x.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductService</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>@<span class=\"token function\">Inject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'DataService'</span><span class=\"token punctuation\">)</span> dataService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token string\">'DataService'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As you can see, we’re using <code class=\"language-text\">@Inject</code> to specify the provider token for <code class=\"language-text\">DataService</code>, since we don’t have a <code class=\"language-text\">DataService</code> type. If this is unclear, you might want to read our articles on <a href=\"/angular/2015/05/18/dependency-injection-in-angular-2.html\">DI in Angular</a>.</p>\n<p>However, there’s no provider for <code class=\"language-text\">&#39;DataService&#39;</code> in Angular 2.x world yet. Let’s make it available using <code class=\"language-text\">upgradeNg1Provider()</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">adapter<span class=\"token punctuation\">.</span><span class=\"token function\">upgradeNg1Provider</span><span class=\"token punctuation\">(</span><span class=\"token string\">'DataService'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Boom! We can make it even better. Let’s assume our Angular 1 service has already been written as class.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DataService</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">}</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token string\">'DataService'</span><span class=\"token punctuation\">,</span> DataService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We can use that class as type and token for dependency injection in Angular 2.x. All we have to do, is to upgrade our service with that token.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">adapter<span class=\"token punctuation\">.</span><span class=\"token function\">upgradeNg1Provider</span><span class=\"token punctuation\">(</span><span class=\"token string\">'DataService'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>asToken<span class=\"token punctuation\">:</span> DataService<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now we can inject it using plain old type annotations.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductService</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dataService<span class=\"token punctuation\">:</span> DataService</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Note</strong>: We added <code class=\"language-text\">@Injectable()</code> to our service because TypeScript needs at least one decorator to emit metadata for it. Learn more in our article on <a href=\"/angular/2015/09/17/resolve-service-dependencies-in-angular-2.html\">Injecting Services in Services in Angular</a>.</p>\n<h2>Downgrading Angular 2.x Providers</h2>\n<p>Last but not least, we might need to be able to use Angular 2.x services in Angular 1.x components. Guess what, <code class=\"language-text\">ngUpgrade</code> comes with a <code class=\"language-text\">downgradeNg2Provider()</code> method.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ProductService'</span><span class=\"token punctuation\">,</span>\n  adapter<span class=\"token punctuation\">.</span><span class=\"token function\">downgradeNg2Provider</span><span class=\"token punctuation\">(</span>ProductService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Conclusion</h2>\n<p><code class=\"language-text\">ngUpgrade</code> provides many useful APIs and is a big step forward when it comes to truly upgrading an application from Angular 1 to Angular >= 2.x. At <a href=\"http://angularconnect.com\">AngularConnect</a> we gave a workshop on upgrading and we’ve open sourced a <a href=\"https://github.com/thoughtram/angular-upgrade-demo\">repository</a> that shows all the steps we’ve been through, from preparation to upgrade. Make sure to check out the <code class=\"language-text\">steps</code> branch.</p>\n<p>Hopefully this article made a bit more clear what this whole upgrade story is all about!</p>","frontmatter":{"author":"pascal_precht","title":"Upgrading Angular apps using ngUpgrade","imageUrl":null,"date":"24 October 2015","summary":"In this article you'll learn how to upgrade your Angular 1 applications to Angular 2 using ngUpgrade.","categories":["angular"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/angular/2015/10/24/upgrading-apps-to-angular-2-using-ngupgrade.html","previous":{"fields":{"slug":"/announcements/2015/10/08/pascal-becomes-a-gde.html"},"frontmatter":{"date":"2015/10/08","title":"Pascal becomes a GDE","categories":["announcements"]}},"next":{"fields":{"slug":"/announcements/2015/10/26/angular-master-class-extended-ngupgrade.html"},"frontmatter":{"date":"2015/10/26","title":"Angular Master Class Extended: ngUpgrade","categories":["announcements"]}}}}}