{"componentChunkName":"component---src-templates-blog-post-js","path":"/angular/2019/03/11/using-dynamic-angular-components-inside-your-custom-widgets.html","webpackCompilationHash":"0c5d630095500f933ccd","result":{"data":{"site":{"siteMetadata":{"title":"Articles by thoughtram","authors":[{"id":"pascal_precht","name":"Pascal Precht","twitter":"PascalPrecht","img":"https://avatars2.githubusercontent.com/u/445106?s=460&v=4"},{"id":"christoph_burgdorf","name":"Christoph Burgdorf","twitter":"cburgdorf","img":"https://avatars0.githubusercontent.com/u/521109?s=460&v=4"},{"id":"dominic_elm","name":"Dominic Elm","twitter":"d3lm","img":"https://avatars0.githubusercontent.com/u/12571019?s=400&v=4"},{"id":"thomas_burleson","name":"Thomas Burleson","twitter":"thomasburleson","img":"https://avatars3.githubusercontent.com/u/210413?s=400&v=4"},{"id":"elvira_eulitz","name":"Elvira Eulitz","twitter":"ElviraEulitz","img":"https://avatars3.githubusercontent.com/u/29247040?s=400&v=4"},{"id":"maxim_koretskyi","name":"Maxim Koretskyi","twitter":"maxim_koretskyi","img":"https://avatars3.githubusercontent.com/u/6124091?s=400&v=4"}]}},"markdownRemark":{"id":"2a70c47e-d9f1-5975-88c8-46a80ebbaf3c","excerpt":"In my previous article I showed how you can integrate a third party widget with Angular using as an example a datagrid widget by ag-Grid. Most widgets you’ll…","html":"<p><a href=\"https://blog.angularindepth.com/a-step-by-step-guide-to-integrating-a-third-party-widget-with-angular-99c2fed174a4/?utm_source=dynamiccomponents3rdpartywidget&#x26;utm_medium=blog&#x26;utm_campaign=thoughtram\">In my previous article</a> I showed how you can integrate a third party widget with Angular using as an example a datagrid widget by <a href=\"https://angular-grid.ag-grid.com/\">ag-Grid</a>. Most widgets you’ll find on the web are customizable and ag-Grid is not an exception. In fact, here at ag-Grid we strongly believe that developers <a href=\"https://medium.com/ag-grid/learn-to-customize-angular-grid-in-less-than-10-minutes-88005d53808d/?utm_source=dynamiccomponents3rdpartywidget&#x26;utm_medium=blog&#x26;utm_campaign=thoughtram\">should be able to easily extend the default functionality</a> to meet their business requirements. For example, you can provide your custom components to implement a custom cell renderer, cell editor or custom filters.</p>\n<p>Pure JavaScript version of ag-Grid is extended by implementing a JavaScript component - a class that implements methods for communication between ag-Grid and the component. For example, all components that implement some kind of UI element must implement <code class=\"language-text\">getGui</code> method that returns a DOM hierarchy that our JavaScript datagrid will render on the screen.</p>\n<p>However, when ag-Grid is used inside Angular, we don’t directly work with DOM. In Angular, we define UI for a component through a template and  delegate DOM manipulation to Angular. And this is exactly the possibility we want to provide for someone who wants to customize ag-Grid that is used as an Angular component. We want to allow our users to customize parts of our Angular datagrid by implementing Angular components.</p>\n<p>Let me give you an example. A developer uses ag-Grid as an Angular component and wants to implement a requirement to format all numbers in cells according to a user’s locale (EUR). To implement this formatting logic in the pure JavaScript grid version, the developer needs to wrap this logic into a JavaScript class and implement the <code class=\"language-text\">getGui</code> method that returns the DOM with formatted values. This will be a component that ag-Grid will use for cell rendering, hence the type of a component is defined in the docs as a <a href=\"https://www.ag-grid.com/javascript-grid-cell-rendering/?utm_source=dynamiccomponents3rdpartywidget&#x26;utm_medium=blog&#x26;utm_campaign=thoughtram\">cell renderer</a>. Here is how it could look:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">NumberCellFormatter</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">:</span> <span class=\"token string\">'currency'</span><span class=\"token punctuation\">,</span> currency<span class=\"token punctuation\">:</span> <span class=\"token string\">'EUR'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eGui <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eGui<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> text<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">getGui</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eGui<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>But when ag-Grid is used as an Angular datagrid, we want developers to define a cell render in Angular way like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    selector<span class=\"token punctuation\">:</span> <span class=\"token string\">'app-number-formatter-cell'</span><span class=\"token punctuation\">,</span>\n    template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n        &lt;span>{{params.value | currency:'EUR'}}&lt;/span>\n    </span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NumberFormatterComponent</span> <span class=\"token punctuation\">{</span>\n    params<span class=\"token punctuation\">:</span> any<span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">agInit</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">:</span> any<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>params <span class=\"token operator\">=</span> params<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Also, as you can see, if a customization component is defined as an Angular component, it can take advantage of built-in Angular mechanisms, like the <code class=\"language-text\">currency</code> pipe to format values.</p>\n<p><strong>To make it possible for developers to use customization components implemented as Angular components, we need to use the <a href=\"https://blog.angularindepth.com/here-is-what-you-need-to-know-about-dynamic-components-in-angular-ac1e96167f9e\">dynamic components mechanism</a> provided by the framework.</strong> Since the DOM of ag-Grid is not controlled by Angular, we need the possibility to retrieve the DOM rendered by Angular for a customization component and render that DOM in an arbitrary place inside the grid. There are many other architectural pieces required to enable developers to customize the grid through Angular components and we’ll now take a look briefly at the most important ones. Here’s the explanation of how we implemented this mechanism in ag-Grid.</p>\n<h2>Implementation</h2>\n<p>We represent each customization component using a generic wrapper component <a href=\"https://github.com/ag-grid/ag-grid/blob/5372a42fa6042c7ddc3c7c13b94eebcc348715d3/packages/ag-grid-angular/src/ng2FrameworkComponentWrapper.ts#L22\">DynamicAgNg2Component</a>. This component <a href=\"https://github.com/ag-grid/ag-grid/blob/5372a42fa6042c7ddc3c7c13b94eebcc348715d3/packages/ag-grid-angular/src/ng2FrameworkComponentWrapper.ts#L29\">keeps a reference to the original</a> customization Angular component implemented by a developer. When ag-Grid needs to instantiate an original component, it creates an instance of the generic <code class=\"language-text\">DynamicAgNg2Component</code> that’s responsible for using dynamic components mechanism to instantiate an Angular component. Once it obtains the reference to the instantiated dynamic component, it retrieves the DOM created by Angular and assigns it to the <code class=\"language-text\">_eGui</code> property of the wrapper component. The <code class=\"language-text\">DynamicAgNg2Component</code> component also implements the <code class=\"language-text\">getGui</code> method that ag-Grid uses to obtain the DOM from a customization component. Here we simply returned the DOM retrieved from a dynamic Angular component.</p>\n<p>Here’s how it all looks in code. The <code class=\"language-text\">DynamicAgNg2Component</code> component extends the <a href=\"https://github.com/ag-grid/ag-grid/blob/5372a42fa6042c7ddc3c7c13b94eebcc348715d3/packages/ag-grid-angular/src/ng2FrameworkComponentWrapper.ts#L62\">BaseGuiComponent</a> it delegates all work to the <code class=\"language-text\">init</code> method of the class:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DynamicAgNg2Component</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseGuiComponent</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n           <span class=\"token class-name\">_super</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n           <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_componentRef<span class=\"token punctuation\">.</span>changeDetectorRef<span class=\"token punctuation\">.</span><span class=\"token function\">detectChanges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Inside the <code class=\"language-text\">init</code> method of the <code class=\"language-text\">BaseGuiComponent</code> is where a dynamic component is initialized and the DOM is retrieved. Once everything is setup, we run change detection manually once and forget about it. </p>\n<p>The <code class=\"language-text\">BaseGuiComponent</code> implements a few required methods for the communication with ag-Grid. Particularly, it implements the <code class=\"language-text\">getGui</code> method that ag-Grid uses to obtain the DOM that needs to be rendered inside the grid:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseGuiComponent</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">:</span> <span class=\"token constant\">P</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">getGui</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> HTMLElement <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_eGui<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see, the implementation of the <code class=\"language-text\">getGui</code> is very trivial. We simply return the value of the <code class=\"language-text\">_eGui</code> property. This property holds the DOM created for a dynamic component by Angular. When we dynamically instantiate a component, we obtain its DOM and assign it to the <code class=\"language-text\">_eGui</code> property. This happens in the <code class=\"language-text\">init</code> method.</p>\n<p>Before we take a look at the implementation of the method, let’s remember that to dynamically instantiate components in Angular we need to get a factory for Angular components. The factory can be obtained using a <a href=\"https://angular.io/api/core/ComponentFactoryResolver\">ComponentFactoryResolver</a>. That’s why we inject it to the main <a href=\"https://github.com/ag-grid/ag-grid/blob/c7d34a7bda3bfecdf90a11fd6d9a1ed478cc56e5/packages/ag-grid-angular/src/agGridNg2.ts#L42\">AgGridNg2</a> when the component is initialized:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    selector<span class=\"token punctuation\">:</span> <span class=\"token string\">'ag-grid-angular'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AgGridNg2</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AfterViewInit</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> viewContainerRef<span class=\"token punctuation\">:</span> ViewContainerRef<span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">private</span> frameworkComponentWrapper<span class=\"token punctuation\">:</span> Ng2FrameworkComponentWrapper<span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">private</span> _componentFactoryResolver<span class=\"token punctuation\">:</span> ComponentFactoryResolver<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>frameworkComponentWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">setViewContainerRef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>viewContainerRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>frameworkComponentWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">setComponentFactoryResolver</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_componentFactoryResolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We also inject <a href=\"https://angular.io/api/core/ViewContainerRef\">ViewContainerRef</a> and <a href=\"https://github.com/ag-grid/ag-grid/blob/5372a42fa6042c7ddc3c7c13b94eebcc348715d3/packages/ag-grid-angular/src/ng2FrameworkComponentWrapper.ts#L7\">Ng2FrameworkComponentWrapper</a> services. The latter is used to wrap an original customization component provided by a developer into the <code class=\"language-text\">DynamicAgNg2Component</code>. The view container is used to render DOM and make change detection automatic. We run change detection manually only once in the init method of the <code class=\"language-text\">DynamicAgNg2Component</code> once the component is rendered. By injecting <code class=\"language-text\">ViewContainerRef</code> into the <code class=\"language-text\">AgGridNg2</code> we turn this top level component a container and all dynamic customization components are attached to this container. When Angular checks the top-level <code class=\"language-text\">AgGridNg2</code> component, all customization components are checked automatically as <a href=\"https://blog.angularindepth.com/everything-you-need-to-know-about-change-detection-in-angular-8006c51d206f\">part of change detection process</a>.</p>\n<p>Let’s now take a closer look at the <code class=\"language-text\">init</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseGuiComponent</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">:</span> <span class=\"token constant\">P</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_params <span class=\"token operator\">=</span> params<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_componentRef <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_agAwareComponent <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_componentRef<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_frameworkComponentInstance <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_componentRef<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_eGui <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_componentRef<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>nativeElement<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_agAwareComponent<span class=\"token punctuation\">.</span><span class=\"token function\">agInit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Basically, inside the <code class=\"language-text\">createComponent</code> we delegate the call to the <code class=\"language-text\">createComponent</code> method of the <code class=\"language-text\">Ng2FrameworkComponentWrapper</code>. As you remember, this service keeps the references to the <code class=\"language-text\">ViewContainerRef</code> and <code class=\"language-text\">componentFactoryResolver</code> that were attached to it during the instantiation of <code class=\"language-text\">AgGridNg2</code>. In the <code class=\"language-text\">createComponent</code> method it uses them to resolve a factory for the customization component and instantiate the component:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Ng2FrameworkComponentWrapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token keyword\">public</span> createComponent<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>componentType<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">:</span> any<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> ComponentRef<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>componentFactoryResolver<span class=\"token punctuation\">.</span><span class=\"token function\">resolveComponentFactory</span><span class=\"token punctuation\">(</span>componentType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>viewContainerRef<span class=\"token punctuation\">.</span><span class=\"token function\">createComponent</span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then using the component reference we get the DOM and attach it to the <code class=\"language-text\">eGui</code> private property:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_componentRef <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_agAwareComponent <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_componentRef<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_frameworkComponentInstance <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_componentRef<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_eGui <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_componentRef<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>nativeElement<span class=\"token punctuation\">;</span></code></pre></div>\n<p>And that’s it. If you’re interested to learn how we implemented the component resolution process, continue reading.</p>\n<h2>Component resolution process</h2>\n<p><a href=\"https://www.youtube.com/watch?v=rT0vQejPcrs\">ag-Grid is a very complex piece of software</a>. To simplify things internally we’ve designed and implemented our own Dependency Injection (IoC) system that’s modeled after <a href=\"https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/beans.html\">Spring’s IoC container and beans</a>. The component resolution process requires a bunch of services that are registered in this DI system. The most important ones are <a href=\"https://github.com/ag-grid/ag-grid/blob/04cd73b3716d9da66b9187f5450ecf4911158075/packages/ag-grid-community/src/ts/components/framework/componentResolver.ts#L71\">ComponentResolver</a> and <a href=\"https://github.com/ag-grid/ag-grid/blob/56d1d66b7d50f3f4093a9f82c4c89be1f658edc9/packages/ag-grid-community/src/ts/components/framework/componentProvider.ts#L56\">ComponentProvider</a>. Also, we need the <code class=\"language-text\">Ng2FrameworkComponentWrapper</code> service that is specific for ag-Grid used as Angular wrapper. It’s registered in the DI system using <code class=\"language-text\">frameworkComponentWrapper</code> token.</p>\n<p>Resolution is performed through the <code class=\"language-text\">ComponentResolver</code> service. When the resolver is instantiated, the <code class=\"language-text\">frameworkComponentWrapper</code> and <code class=\"language-text\">componentProvider</code> services are attached to the resolver through the DI system and are available on the class instance:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">'componentResolver'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ComponentResolver</span> <span class=\"token punctuation\">{</span>\n    @<span class=\"token function\">Autowired</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gridOptions\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> gridOptions<span class=\"token punctuation\">:</span> GridOptions<span class=\"token punctuation\">;</span>\n\n    @<span class=\"token function\">Autowired</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"componentProvider\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> componentProvider<span class=\"token punctuation\">:</span> ComponentProvider<span class=\"token punctuation\">;</span>\n\n    @<span class=\"token function\">Optional</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"frameworkComponentWrapper\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> frameworkComponentWrapper<span class=\"token punctuation\">:</span> FrameworkComponentWrapper<span class=\"token punctuation\">;</span>\n\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>When the grid needs to instantiate a particular type of a component, e.g. a cell renderer, it calls <code class=\"language-text\">ComponentResolver.createAgGridComponent</code> method. The method uses a descriptor of a column to obtain the name of a component that needs to be created. For the cell renderer component the property that contains the name of a component is <code class=\"language-text\">cellRenderer</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> columnDefs <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        headerName<span class=\"token punctuation\">:</span> <span class=\"token string\">'Price'</span><span class=\"token punctuation\">,</span>\n        field<span class=\"token punctuation\">:</span> <span class=\"token string\">'price'</span><span class=\"token punctuation\">,</span>\n        editable<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        cellRenderer<span class=\"token punctuation\">:</span> <span class=\"token string\">'numberFormatterComponent'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Once the name is obtained, it is used to <a href=\"https://github.com/ag-grid/ag-grid/blob/04cd73b3716d9da66b9187f5450ecf4911158075/packages/ag-grid-community/src/ts/components/framework/componentResolver.ts#L239\">retrieve the component class</a> and metadata from the <code class=\"language-text\">componentProvider</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ComponentResolver</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token function\">resolveByName</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">propertyName<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> componentName <span class=\"token operator\">=</span> componentNameOpt <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">?</span> componentNameOpt <span class=\"token punctuation\">:</span> propertyName<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> registeredComponent <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>componentProvider<span class=\"token punctuation\">.</span><span class=\"token function\">retrieve</span><span class=\"token punctuation\">(</span>componentName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">retrieve</code> method returns the following descriptor of a component:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n    component<span class=\"token punctuation\">:</span> NumberFormatterComponent\n    dynamicParams<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n    source<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    type<span class=\"token punctuation\">:</span> Component_Type<span class=\"token punctuation\">.</span>Framework\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The type of a component denotes that it’s a framework specific component. All framework components are wrapped into the <code class=\"language-text\">DynamicAgNg2Component</code> as explained the first section of the article. Once the component is wrapped, it contains the <code class=\"language-text\">getGui</code> method common to all customization components and ag-Grid can work with it as if it’s a plain JavaScript component.</p>","frontmatter":{"author":"maxim_koretskyi","title":"Dynamic Angular components inside custom widgets","imageUrl":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADFklEQVQoz2NQ1tBV1zdT1zNV0zNV1zeXUtKqrW/5+/ffly/fv379gYm+fQMjIPvLDwZmTm4uESluURkeUVk+CQVWfvHk1Mzb1299+vztMxB9+fbl6zeoBgzEoK5nrGlgqmVormNsaWBuq2VkUVfXeOf69V8/f/37++//v/9/fv/9+vX79+8/0RBI84XjR88fP3Lx5PFLp45fPnPq0umT186duXHx/NVzZ66cO332+JG7N2/8+fsPUzMQMcjLK8grKElJyUhISIqKiEpISotJSgkLi4iIiAkKCknJKJiYWV66eOn///9Aq378+AVECM2GZtaG5jY2jq4Wto5BoeG7t245tGfX0f17Tx4+eOrwoesXzq1esWzKlKnImkHoOxABNRsa6xsYGRgY6OroGhoY+np5e7p7ODnaW1taAUWNTc18/PwvXbwI1Ay06seP3xDNP8H6GcqKCqsrKmrKy5rr64ry8yTklCVklUQk5YKCw6ZPnLBo7tyezs7Gxiag5h9Au0AAqvknUPOC2bPmTJ82Y/LEqRP6gfp9fP09vXyCg0MKc3NaG+oK8ws62to2rN/w4vmLX7+B1v74CQHfQYhBRUVZS0tLR0vL0MDAwszUzdXdzzdAUlqOgYFRTFQiLiY+MTGpsb7u66dPQMt//foF1P0LZPtPoB8YLpw4cvbYIWBsnTt25PTRQ0f37j62b3dtTXVoeGRdTc2B7VsO7t29Y+vW1qam7q6uJ08e//v79+d3oI9B+hn4+PgFhUTY2NgYIICRCYjYOTh5ePhYWVjYOLhVNbQaamtqq6uLi4rOnz3378/fH9++QzUf2r39wonDQFlrB1ffwBAvvyBP34CQiOigsKiU1PTM9Iyuzo5Vy5clxMXnZGdfOHsO6PjfP39BEIO1laW9vZ2FqYmBnq62prqcrJysrLyUpJSkJAjLySvY2toB/Tx9ypSJfb1rV6/et2cP0NlQzWmJiXJKalwCInwi4qqaOhO7OmdPmTJ32pQFM6cvmjVz+YL5R/ftjomNU9TUjY6KbmtqmjRh4qcPH//+/gN0NgAEKhPSENzLZAAAAABJRU5ErkJggg==","aspectRatio":1.3333333333333333,"src":"/static/2cbc1441fc8a572cd22637cca76585ca/57090/dynamic-angular-components-inside-custom-widgets.png","srcSet":"/static/2cbc1441fc8a572cd22637cca76585ca/d9446/dynamic-angular-components-inside-custom-widgets.png 158w,\n/static/2cbc1441fc8a572cd22637cca76585ca/2f6e7/dynamic-angular-components-inside-custom-widgets.png 315w,\n/static/2cbc1441fc8a572cd22637cca76585ca/57090/dynamic-angular-components-inside-custom-widgets.png 630w,\n/static/2cbc1441fc8a572cd22637cca76585ca/bba84/dynamic-angular-components-inside-custom-widgets.png 712w","sizes":"(max-width: 630px) 100vw, 630px"}}},"date":"11 March 2019","summary":"Learn how and why you want to use dynamic Angular components inside your custom widgets.","categories":["angular"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/angular/2019/03/11/using-dynamic-angular-components-inside-your-custom-widgets.html","previous":{"fields":{"slug":"/announcements/2018/04/12/rxjs-master-class-and-courseware-updates.html"},"frontmatter":{"date":"2018/04/12","title":"RxJS Master Class and courseware updates","categories":["announcements"]}},"next":{"fields":{"slug":"/announcements/2019/07/28/angular-master-class-coming-to-malaga.html"},"frontmatter":{"date":"2019/07/28","title":"Angular Master Class coming to Málaga","categories":["announcements"]}}}}}