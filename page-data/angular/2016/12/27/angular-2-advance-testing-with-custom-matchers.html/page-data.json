{"componentChunkName":"component---src-templates-blog-post-js","path":"/angular/2016/12/27/angular-2-advance-testing-with-custom-matchers.html","webpackCompilationHash":"0c5d630095500f933ccd","result":{"data":{"site":{"siteMetadata":{"title":"Articles by thoughtram","authors":[{"id":"pascal_precht","name":"Pascal Precht","twitter":"PascalPrecht","img":"https://avatars2.githubusercontent.com/u/445106?s=460&v=4"},{"id":"christoph_burgdorf","name":"Christoph Burgdorf","twitter":"cburgdorf","img":"https://avatars0.githubusercontent.com/u/521109?s=460&v=4"},{"id":"dominic_elm","name":"Dominic Elm","twitter":"d3lm","img":"https://avatars0.githubusercontent.com/u/12571019?s=400&v=4"},{"id":"thomas_burleson","name":"Thomas Burleson","twitter":"thomasburleson","img":"https://avatars3.githubusercontent.com/u/210413?s=400&v=4"},{"id":"elvira_eulitz","name":"Elvira Eulitz","twitter":"ElviraEulitz","img":"https://avatars3.githubusercontent.com/u/29247040?s=400&v=4"},{"id":"maxim_koretskyi","name":"Maxim Koretskyi","twitter":"maxim_koretskyi","img":"https://avatars3.githubusercontent.com/u/6124091?s=400&v=4"}]}},"markdownRemark":{"id":"546690c9-883f-5ef8-88f2-c9671b7fdff4","excerpt":"Preface A few weeks ago, Pascal Precht wrote a blog article on \nTesting Services with HTTP with Angular.\nIn this article, we want to discuss more advanced…","html":"<h2>Preface</h2>\n<p>A few weeks ago, Pascal Precht wrote a blog article on\n<a href=\"http://blog.thoughtram.io/angular/2016/11/28/testing-services-with-http-in-angular-2.html\">Testing Services with HTTP with Angular</a>.\nIn this article, we want to discuss more advanced topics on DRY Angular testing techniques\nusing <strong>Custom Matchers</strong> and <strong>Special Helpers</strong>.</p>\n<p>These are techniques to make your unit-tests incredibly easy to read and to maintain. And to achieve\nour learning goals, there are three (3) important testing topics that we want to cover:</p>\n<ul>\n<li>(1) <a href=\"#testing-directives\">Testing custom Angular <strong>Directives</strong></a></li>\n<li>(2) <a href=\"#testing-with-helpers\">Building reusable, DRY TestBed <strong>Helper</strong> methods</a></li>\n<li>(3) <a href=\"#custom-matchers\">Using Typescript Jasmine <strong>Custom Matchers</strong></a></li>\n</ul>\n<blockquote>\n<p>These techniques are practically undocumented… yet they dramatically improve the quality of\nour tests.</p>\n</blockquote>\n<p>To whet your appetite, here are some sample DRY tests that we will be showing you how to write:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.80000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB5iBezk//xAAZEAACAwEAAAAAAAAAAAAAAAAAARARMRL/2gAIAQEAAQUCFr7i6NP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAACAQUAAAAAAAAAAAAAAAAAATEQITJxkf/aAAgBAQAGPwIsYrlIT2Qf/8QAGhAAAwADAQAAAAAAAAAAAAAAAAERITGBQf/aAAgBAQABPyHrNEV0S8q4LBb+ANprCviP/9oADAMBAAIAAwAAABAgH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQEAAgMBAAAAAAAAAAAAAAERACExQXFh/9oACAEBAAE/ELzdH3Nj0qDEXxwWxTrNVA6cqVbqUMQd2jA8z//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Unit Test with Matchers and Helpers\"\n        title=\"Unit Test with Matchers and Helpers\"\n        src=\"/static/e2c7232dc0a42035fe23169d13b38803/a66cd/example1.jpg\"\n        srcset=\"/static/e2c7232dc0a42035fe23169d13b38803/f544b/example1.jpg 200w,\n/static/e2c7232dc0a42035fe23169d13b38803/41689/example1.jpg 400w,\n/static/e2c7232dc0a42035fe23169d13b38803/a66cd/example1.jpg 750w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 749px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.80774365821095%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB5sqxGon/xAAaEAACAgMAAAAAAAAAAAAAAAABAgAQMTJB/9oACAEBAAEFAp0gUmz5/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAgMBAAAAAAAAAAAAAAAAADEBEBFR/9oACAEBAAY/Ajg9tQf/xAAbEAEAAwADAQAAAAAAAAAAAAABABExIUFxUf/aAAgBAQABPyE12ANFB9YB4PgY7M7B9hK0HHRP/9oADAMBAAIAAwAAABBz3//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB0QAQACAgIDAAAAAAAAAAAAAAEAETFBIVFxkbH/2gAIAQEAAT8QS2W8MNpGha9Q0DVkH0maATA54AmOmBoDQTb1P//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Testing Nested DOM Styles\"\n        title=\"Testing Nested DOM Styles\"\n        src=\"/static/b06d232ad362dd0ce6f2da7e43b805a0/bbc52/example2.jpg\"\n        srcset=\"/static/b06d232ad362dd0ce6f2da7e43b805a0/f544b/example2.jpg 200w,\n/static/b06d232ad362dd0ce6f2da7e43b805a0/41689/example2.jpg 400w,\n/static/b06d232ad362dd0ce6f2da7e43b805a0/bbc52/example2.jpg 749w\"\n        sizes=\"(max-width: 749px) 100vw, 749px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2>Background</h2>\n<p>There a several excellent resources already available that developers can read to\nlearn about Angular testing:</p>\n<ul>\n<li><a href=\"https://medium.com/google-developer-experts/angular-2-testing-guide-a485b6cb1ef0#.2ytwy9k9w\">Angular 2 - Testing Guide</a> (by <a href=\"https://twitter.com/gerardsans\">Gerard Sans</a>)</li>\n<li><a href=\"https://medium.com/google-developer-experts/angular-2-unit-testing-with-jasmine-defe20421584#.cmk3cg9bc\">Angular 2 - Unit Testing Recipes</a> (by <a href=\"https://twitter.com/gerardsans\">Gerard Sans</a>)</li>\n<li><a href=\"https://www.sitepoint.com/angular-2-tutorial/?utm_campaign=NG-Newsletter&#x26;utm_medium=email&#x26;utm_source=NG-Newsletter_180\">Testing with the Angular CLI</a>\n(by <a href=\"https://twitter.com/toddmotto\">Todd Motto</a>, <a href=\"https://twitter.com/jvandemo\">Jurgen Van de Moere</a>)</li>\n<li><a href=\"http://chariotsolutions.com/blog/post/testing-angular-2-components-unit-tests-testcomponentbuilder/\">Testing Angular 2 Components</a> (by <a href=\"https://twitter.com/krimple\">Ken Rimple</a>)</li>\n</ul>\n<p>The biggest take-aways from these articles is the singular concept that instead of manually\ninstantiating and testing classes, Angular developers <u>should consider using</u>\nthe <code class=\"language-text\">TestBed.configureTestingModule()</code> to prepare an entire test Angular DI <strong>environment</strong> for each\ntest module (*.spec.ts).</p>\n<blockquote>\n<p>We would not use <code class=\"language-text\">TestBed.configureTestingModule()</code> when we are testing a service that\ndoesn’t have any dependencies. It’d be easier and less verbose to just instantiate using <code class=\"language-text\">new</code>. The\n<strong>TestBed</strong> is for useful for dependencies and injections.</p>\n</blockquote>\n<h2>Traditional Testing</h2>\n<p>Consider the traditional approach of manually instantiating and testing a Service or component:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ServiceA <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./services/ServiceA'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ServiceA'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should emit greeting event'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> inst <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServiceA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    inst<span class=\"token punctuation\">.</span>greeting<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">g</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n       <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>g<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>greeting<span class=\"token punctuation\">:</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    inst<span class=\"token punctuation\">.</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It’s fine to do it this way, because <strong>ServiceA</strong> obviously does not need anything\nelse to be instantiated; it is a self-contained service without external dependencies. </p>\n<blockquote>\n<p>So assuming that this service won’t get any dependencies in the future, this test is the one we want to write.  </p>\n</blockquote>\n<h2>Introducing Angular TestBed</h2>\n<p>The Angular <strong>TestBed</strong> allows developers to configure <strong>ngModules</strong> that provide instances/values and use\nDependency Injection. This is the same approach developers use in their regular Angular applications. </p>\n<p>With the <strong>TestBed</strong> and its support for for component-lifecycle features, Angular components can be\neasily instantiated and tested. Here is an example - shown below - that we will continue to\nuse in this article:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MyComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./viewer/MyComponent'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Configure testbed to register components and prepare services\n */</span>\n<span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  TestBed<span class=\"token punctuation\">.</span><span class=\"token function\">configureTestingModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> FlexLayoutModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    declarations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>MyComponent<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    \n    <span class=\"token comment\">// 'MatchMedia' construction requires BreakPointRegistry</span>\n    <span class=\"token comment\">// 'MyComponent' construction requires MatchMedia parameter</span>\n    \n    providers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      BreakPointRegistry<span class=\"token punctuation\">,</span>\n      BreakPointsProvider<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        provide<span class=\"token punctuation\">:</span> MatchMedia<span class=\"token punctuation\">,</span>\n        useClass<span class=\"token punctuation\">:</span> MockMatchMedia\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Helper function to easily build a component Fixture using the specified template\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createTestComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">template<span class=\"token punctuation\">:</span> string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> ComponentFixture<span class=\"token operator\">&lt;</span>Type<span class=\"token operator\">&lt;</span>any<span class=\"token operator\">>></span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> TestBed\n    <span class=\"token punctuation\">.</span><span class=\"token function\">overrideComponent</span><span class=\"token punctuation\">(</span>MyComponent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>template<span class=\"token punctuation\">:</span> template<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">createComponent</span><span class=\"token punctuation\">(</span>MyComponent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Before each test, we want configure a new, fresh testing module with <u>only</u> the providers,\ncomponents, and directives we <u>need for the current test module</u>. </p>\n<blockquote>\n<p>And notice that we just created a reusable <strong>Helper</strong> function: <code class=\"language-text\">createTestComponent()</code>.\nThis cool utility function will construct an instance of MyComponent [using the configured TestBed]\nusing any custom HTML template you specify. </p>\n</blockquote>\n<p>At first, this complexity may seem like overkill. But let’s consider two critical requirements\nshown in the sample above:</p>\n<ul>\n<li><strong>MatchMedia</strong> instantiation requires an injected <strong>BreakPointRegistry</strong> instance</li>\n<li><strong>MyComponent</strong> instantiation requires an injected <strong>MatchMedia</strong> instance</li>\n</ul>\n<p>Even with these requirements, testing developers should NOT have to worry about all those internals just\nto test <strong>MyComponent</strong>. Using ngModule, DI, and Angular… we now don’t have to worry about those\ndetails.</p>\n<p>This is just like those real-world scenarios where our components, directives, and services will\nhave complex dependencies upon providers and non-trivial construction processes. </p>\n<p>And this is where <strong>TestBed</strong> demonstrates its real value!</p>\n<blockquote>\n<p>We are not using external templates nor any other resources or services that are asynchronous.\nSo we do not discuss the <code class=\"language-text\">async()</code> nor the the <code class=\"language-text\">TestBed::compileComponents()</code> functions. </p>\n</blockquote>\n<h2>1) Testing Directives</h2>\n<p>With relative ease, developers can find literature on testing Angular Services and Components.\nYet the <u>How-to’s for testing Directives</u> is oddly not well documented.</p>\n<p>Unlike Components with their associated templates, Directives do not have templates. This means\nthat we <strong>cannot</strong> simply import a Directive and manually instantiate it. </p>\n<p>The solution is rather easy! We only need to:</p>\n<ul>\n<li>configure a TestBed that imports and declares the directive(s),</li>\n<li>prepare a shell test Component, and</li>\n<li>use a custom template which uses the Directive selector(s) as attribute(s).</li>\n</ul>\n<p>Since Directives usually affect the <strong>host element</strong>, our tests will check if those changes to the host\nelement are present and valid.</p>\n<p>So let’s use the Angular <a href=\"http://github.com/angular/flex-layout\">Flex-Layout</a> library as the basis\nfor the following discussions on Directives, Matchers, and TestBed Helpers.</p>\n<blockquote>\n<p>Real-world solutions often provide great examples for reusable techniques.</p>\n</blockquote>\n<p>We will be using both the <strong>fxLayout</strong> directive and excerpts from the unit test for that directive\nto explore testing ideas, techniques, and solutions that we can also use in our own tests.</p>\n<p>First, let’s import the FlexLayout library into our own tests and prepare to test the <em>fxLayout</em>\ndirective.</p>\n<blockquote>\n<p>You can see the actual testing code in <a href=\"https://github.com/angular/flex-layout/blob/master/src/lib/flexbox/api/layout.spec.ts\">layout.spec.ts</a>.\n<br/>But <strong>don’t</strong> jump there yet! Wait until you have finished reading this article.</p>\n</blockquote>\n<h3>Configuring the TestBed</h3>\n<p>Very similar to the TestBed sample shown above, we will configure a testing module but we will\nnot <em>import</em> an external test component. My test component <code class=\"language-text\">TestLayoutComponent</code> is itself defined\nwithin our test (*.spec.ts) module.</p>\n<blockquote>\n<p>Using an internal test component enables each test module <br/>e.g. <br/><code class=\"language-text\">&lt;directive&gt;.spec.ts</code><br/> to define\nand use its own custom test component with custom properties.</p>\n</blockquote>\n<p>Here is the initial configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>Component<span class=\"token punctuation\">,</span> OnInit<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>ComponentFixture<span class=\"token punctuation\">,</span> TestBed <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core/testing'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  FlexLayoutModule<span class=\"token punctuation\">,</span>\n  MockMatchMedia<span class=\"token punctuation\">,</span>\n  MatchMedia<span class=\"token punctuation\">,</span>\n  BreakPointsProvider<span class=\"token punctuation\">,</span>\n  BreakPointRegistry\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/flex-layout'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'layout directive'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// Configure testbed to prepare services</span>\n    TestBed<span class=\"token punctuation\">.</span><span class=\"token function\">configureTestingModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>FlexLayoutModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      declarations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>TestLayoutComponent<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      providers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n        BreakPointRegistry<span class=\"token punctuation\">,</span> BreakPointsProvider<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>provide<span class=\"token punctuation\">:</span> MatchMedia<span class=\"token punctuation\">,</span> useClass<span class=\"token punctuation\">:</span> MockMatchMedia<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should add correct styles for default `fxLayout` usage'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token comment\">// TEST LOGIC HERE</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\n * Shell component with property 'direction' that will be used\n * with our tests\n */</span>\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token punctuation\">:</span> <span class=\"token string\">'test-layout'</span><span class=\"token punctuation\">,</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;span>PlaceHolder HTML to be Replaced&lt;/span></span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestLayoutComponent</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">OnInit</span> <span class=\"token punctuation\">{</span>\n  direction <span class=\"token operator\">=</span> <span class=\"token string\">\"column\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>   <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">ngOnInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/*\n * Custom Helper function to quickly create a `fixture` instance based on\n * the 'TestLayoutComponent' class\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createTestComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">template<span class=\"token punctuation\">:</span> string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> ComponentFixture<span class=\"token operator\">&lt;</span>TestLayoutComponent<span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> TestBed\n    <span class=\"token punctuation\">.</span><span class=\"token function\">overrideComponent</span><span class=\"token punctuation\">(</span>TestLayoutComponent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>template<span class=\"token punctuation\">:</span> template<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">createComponent</span><span class=\"token punctuation\">(</span>TestLayoutComponent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We now have everything we need to write a Directive test quickly.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should compile with custom directives'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> fixture <span class=\"token operator\">=</span> <span class=\"token function\">createTestComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;div fxLayout>&lt;/div>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span> fixture <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Wow! That is pretty easy. </p>\n<blockquote>\n<p>The component has been constructed and prepared with the same\nprocesses and DI that your real world application will use.</p>\n</blockquote>\n<p>Let’s first write our test using the traditional long-form… one without custom matchers and the\nmore advanced helper methods.</p>\n<p>Since the <strong>fxLayout</strong> directive will add custom flexbox CSS to the host element, our test logic\nhere will confirm that the initial CSS is correctly assigned.</p>\n<h3>Non-DRY Testing</h3>\n<p>The traditional approach would probably implement something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should add correct styles for `fxLayout` with template bindings'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> template <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;div [fxLayout]=\"direction\">&lt;/div>'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> fixture <span class=\"token operator\">=</span> <span class=\"token function\">createTestComponent</span><span class=\"token punctuation\">(</span>template<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> el <span class=\"token operator\">=</span> fixture<span class=\"token punctuation\">.</span>debugElement<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>nativeElement<span class=\"token punctuation\">;</span>\n  \n    fixture<span class=\"token punctuation\">.</span><span class=\"token function\">detectChanges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span> el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span><span class=\"token string\">'display'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'flex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span> el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span><span class=\"token string\">'box-sizing'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'border-box'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span> el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span><span class=\"token string\">'flex-direction'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'column'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n    fixture<span class=\"token punctuation\">.</span>componentInstance<span class=\"token punctuation\">.</span>direction <span class=\"token operator\">=</span> <span class=\"token string\">'row'</span><span class=\"token punctuation\">;</span>\n    fixture<span class=\"token punctuation\">.</span><span class=\"token function\">detectChanges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span> el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span><span class=\"token string\">'flex-direction'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'row'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In the code above, we </p>\n<ul>\n<li>defined a custom template with bindings to the component property <code class=\"language-text\">direction</code>, </li>\n<li>use deeply nested references to get access to the native element,</li>\n<li>test each style individually.</li>\n</ul>\n<p>All this in one (1) single test. And truly it is not easily read. </p>\n<p>Now imagine that our test module has more than 20 individual <code class=\"language-text\">it(...)</code> tests!</p>\n<blockquote>\n<p>That would be a lot of duplicate code. <br/> And there is certainly nothing DRY (“do not repeat yourself”) about\nsuch code! </p>\n</blockquote>\n<h2>2) Testing with Helpers</h2>\n<p>Above we explored the standard approach to implementing unit tests… an approach which resulted\nin verbose, non-reusable code.</p>\n<p>Let’s contrast that with the DRY version that we want:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 748px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.3475935828877%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUBAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABWFdSBiJ//8QAGxAAAgEFAAAAAAAAAAAAAAAAAAMCARASITH/2gAIAQEAAQUCOmNLK2ySoH//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwFX/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAgMAAAAAAAAAAAAAAAAAAAECEDL/2gAIAQEABj8CrcaimZP/xAAaEAEBAQADAQAAAAAAAAAAAAABABEhUWHx/9oACAEBAAE/Id9jli4ds/QtgGNFgJgv/9oADAMBAAIAAwAAABBz7//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QH//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/EEf/xAAdEAEAAgICAwAAAAAAAAAAAAABABEhQTFxkaHh/9oACAEBAAE/ENrUQJWeVo8QbhuvmKHDBRUiO8SijZfuf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Testing Directives - DRY Code\"\n        title=\"Testing Directives - DRY Code\"\n        src=\"/static/45aad0c3439bbd0a58bf296298d6b730/9ae42/example3.jpg\"\n        srcset=\"/static/45aad0c3439bbd0a58bf296298d6b730/f544b/example3.jpg 200w,\n/static/45aad0c3439bbd0a58bf296298d6b730/41689/example3.jpg 400w,\n/static/45aad0c3439bbd0a58bf296298d6b730/9ae42/example3.jpg 748w\"\n        sizes=\"(max-width: 748px) 100vw, 748px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Now this test is much more readable, maintainable, and DRY. We hide all the\ncomplexities of:</p>\n<ul>\n<li>forcing change detection, </li>\n<li>accessing the native element, and </li>\n<li>confirming  1…n DOM CSS styles </li>\n</ul>\n<p>Those complexities are now encapsulated in a Helper function and a Custom Matcher (respectively). </p>\n<p>The custom Helper function <strong>expectNativeEl( )</strong> is similar to the standard <strong>expect( )</strong> function.\nIn fact, it is wrapper function that internalizes the <code class=\"language-text\">expect( )</code> call. </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * Note: this helper only accesses the 1st-level child within a component\n *       A different helper method is need to access deep-level DOM nodes\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">expectNativeEl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fixture<span class=\"token punctuation\">:</span> ComponentFixture<span class=\"token operator\">&lt;</span>any<span class=\"token operator\">></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> any <span class=\"token punctuation\">{</span>\n  fixture<span class=\"token punctuation\">.</span><span class=\"token function\">detectChanges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Return response of `expect(...)`</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fixture<span class=\"token punctuation\">.</span>debugElement<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>nativeElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>It is important to note that these helper methods always return the value of an <code class=\"language-text\">expect(...)</code> call!</p>\n</blockquote>\n<p>And the resulting code change uses a similar notation to our standard training. So</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">expect(...).toBe</code></pre></div>\n<p>becomes</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">expectNativeEl(...).toBe</code></pre></div>\n<h3>Testing Nested DOM</h3>\n<p>For more complex DOM access, we can use the DebugElement’s query feature to select nested DOM nodes. </p>\n<p>Angular’s <strong>DebugElement</strong> has several query features:</p>\n<ul>\n<li><code class=\"language-text\">query(predicate: Predicate&lt;DebugElement&gt;): DebugElement;</code></li>\n<li><code class=\"language-text\">queryAll(predicate: Predicate&lt;DebugElement&gt;): DebugElement[];</code></li>\n<li><code class=\"language-text\">queryAllNodes(predicate: Predicate&lt;DebugNode&gt;): DebugNode[];</code></li>\n</ul>\n<blockquote>\n<p>Please note that all debugging apis are currently experimental.</p>\n</blockquote>\n<p>Consider the following helper function <strong>expectDomForQuery( )</strong>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 749px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.80774365821095%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB5sqxGon/xAAaEAACAgMAAAAAAAAAAAAAAAABAgAQMTJB/9oACAEBAAEFAp0gUmz5/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAgMBAAAAAAAAAAAAAAAAADEBEBFR/9oACAEBAAY/Ajg9tQf/xAAbEAEAAwADAQAAAAAAAAAAAAABABExIUFxUf/aAAgBAQABPyE12ANFB9YB4PgY7M7B9hK0HHRP/9oADAMBAAIAAwAAABBz3//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB0QAQACAgIDAAAAAAAAAAAAAAEAETFBIVFxkbH/2gAIAQEAAT8QS2W8MNpGha9Q0DVkH0maATA54AmOmBoDQTb1P//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pic6\"\n        title=\"pic6\"\n        src=\"/static/b06d232ad362dd0ce6f2da7e43b805a0/bbc52/example2.jpg\"\n        srcset=\"/static/b06d232ad362dd0ce6f2da7e43b805a0/f544b/example2.jpg 200w,\n/static/b06d232ad362dd0ce6f2da7e43b805a0/41689/example2.jpg 400w,\n/static/b06d232ad362dd0ce6f2da7e43b805a0/bbc52/example2.jpg 749w\"\n        sizes=\"(max-width: 749px) 100vw, 749px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>In this example, we actually want to test the <u>nested DOM node</u> that hosts the attribute <strong>fxFlex</strong>.\nUsing another helper method <strong>expectDomForQuery( )</strong> makes that easy.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * Create component instance using custom template, the query for the native DOM node\n * based on the query selector\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">expectDomForQuery</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">template<span class=\"token punctuation\">:</span>string<span class=\"token punctuation\">,</span> selector<span class=\"token punctuation\">:</span>string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> any <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> fixture <span class=\"token operator\">=</span> <span class=\"token function\">createTestComponent</span><span class=\"token punctuation\">(</span>template<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      fixture<span class=\"token punctuation\">.</span><span class=\"token function\">detectChanges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Return response of `expect(...)`</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span> <span class=\"token function\">queryFor</span><span class=\"token punctuation\">(</span>fixture<span class=\"token punctuation\">,</span>selector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>nativeElement <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Don't forget to import the `By` utilities\n */</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>By<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/platform-browser'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Reusable Query helper function\n */</span>\n<span class=\"token keyword\">function</span>  <span class=\"token function\">queryFor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fixture<span class=\"token punctuation\">:</span>ComponentFixture<span class=\"token operator\">&lt;</span>any<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> selector<span class=\"token punctuation\">:</span>string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>any <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> fixture<span class=\"token punctuation\">.</span>debugElement<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And the resulting code change is again a similar notation to our standard training:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>toBe</code></pre></div>\n<p>becomes</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">expectDomForQuery</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>toBe</code></pre></div>\n<h3>More Special Helpers</h3>\n<p>Earlier, we showed a code snapshot that had a <em>special helper</em> <code class=\"language-text\">activateMediaQuery( )</code>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.80000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB5iBezk//xAAZEAACAwEAAAAAAAAAAAAAAAAAARARMRL/2gAIAQEAAQUCFr7i6NP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAACAQUAAAAAAAAAAAAAAAAAATEQITJxkf/aAAgBAQAGPwIsYrlIT2Qf/8QAGhAAAwADAQAAAAAAAAAAAAAAAAERITGBQf/aAAgBAQABPyHrNEV0S8q4LBb+ANprCviP/9oADAMBAAIAAwAAABAgH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQEAAgMBAAAAAAAAAAAAAAERACExQXFh/9oACAEBAAE/ELzdH3Nj0qDEXxwWxTrNVA6cqVbqUMQd2jA8z//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Unit Test with Matchers and Helpers\"\n        title=\"Unit Test with Matchers and Helpers\"\n        src=\"/static/e2c7232dc0a42035fe23169d13b38803/a66cd/example1.jpg\"\n        srcset=\"/static/e2c7232dc0a42035fe23169d13b38803/f544b/example1.jpg 200w,\n/static/e2c7232dc0a42035fe23169d13b38803/41689/example1.jpg 400w,\n/static/e2c7232dc0a42035fe23169d13b38803/a66cd/example1.jpg 750w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The Flex-Layout library has a responsive engine that supports change detection when a mediaQuery\nactivates (<em>aka</em> when the viewport size changes). The API uses selectors with dot-notation to\nindicate which values should be used for which mediaQuery:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">fxLayout</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">fxLayout.md</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>column<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Testing these features presents several additional requirements:</p>\n<ul>\n<li>mock the window API <code class=\"language-text\">window.matchMedia(...)</code></li>\n<li>simulate a mediaQuery activation</li>\n<li>trigger fixture.detectChange() after a simulated activation</li>\n<li>hide all these details from individual tests (DRY)</li>\n</ul>\n<p>Thankfully the Flex-Layout library actually publishes a MockMatchMedia class. And we use this class\nin our TestBed configuration below:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> fixture<span class=\"token punctuation\">:</span> ComponentFixture<span class=\"token operator\">&lt;</span>any<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Special Helper\n */</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">activateMediaQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">alias</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> injector <span class=\"token operator\">=</span> fixture<span class=\"token punctuation\">.</span>debugElement<span class=\"token punctuation\">.</span>injector<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> matchMedia <span class=\"token punctuation\">:</span> MockMatchMedia <span class=\"token operator\">=</span> injector<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>MatchMedia<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token comment\">// simulate mediaQuery change and trigger fxLayout changes</span>\n  matchMedia<span class=\"token punctuation\">.</span><span class=\"token function\">activate</span><span class=\"token punctuation\">(</span>alias<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Configure testbed to prepare services</span>\n  TestBed<span class=\"token punctuation\">.</span><span class=\"token function\">configureTestingModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>FlexLayoutModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    declarations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>TestLayoutComponent<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    providers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      BreakPointRegistry<span class=\"token punctuation\">,</span> BreakPointsProvider<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>provide<span class=\"token punctuation\">:</span> MatchMedia<span class=\"token punctuation\">,</span> useClass<span class=\"token punctuation\">:</span> MockMatchMedia<span class=\"token punctuation\">}</span>   <span class=\"token comment\">//Special mock config</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Let’s explore three (3) very interesting things are happening in this code: </p>\n<ul>\n<li>configure Dependency Injection providers to override a class with a mock, </li>\n<li>dynamic injection using <code class=\"language-text\">injector.get(MatchMedia)</code>, and</li>\n<li>use special helper <strong>activateMediaQuery( )</strong> function that hides all these details</li>\n</ul>\n<p><strong>(1) Overriding DI Providers</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span> provide<span class=\"token punctuation\">:</span> MatchMedia<span class=\"token punctuation\">,</span> useClass<span class=\"token punctuation\">:</span> MockMatchMedia <span class=\"token punctuation\">}</span></code></pre></div>\n<p>tells the TestBed DI system to provide an instance of the <code class=\"language-text\">MockMatchMedia</code> <strong>whenever</strong> any code\nasks for an instance of the <code class=\"language-text\">MatchMedia</code> token to be injected via DI.</p>\n<blockquote>\n<p>You can read more about the Angular DI systems here:<br/> <a href=\"http://blog.thoughtram.io/angular/2015/05/18/dependency-injection-in-angular-2.html\">Dependency Injection in Angular</a></p>\n</blockquote>\n<p><strong>(2) Dynamic Injection</strong></p>\n<p>Our special helper <code class=\"language-text\">activateMediaQuery()</code> needs a dynamic injected instance of the MatchMedia token.\nUsing the <code class=\"language-text\">fixture</code> instance, we can access the injector service for our components. With the injector,\nwe can dynamically get a <strong>MockMatchMedia</strong> instance using the provider token <strong>MatchMedia</strong>.</p>\n<blockquote>\n<p>In this case, <strong>MatchMedia</strong> is both a class and a provider token used for D-injection. </p>\n</blockquote>\n<p>Notice that all this complexity [and construction details] on preparing a MockMatchMedia instance is\nencapsulated in our TestBed… and the use of the injector is hidden within our special helper. </p>\n<p>Now our individual tests simply use the easy special helper function <strong>activateMediaQuery( )</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">activateMediayQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">'md'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That is very, very cool!</p>\n<h2>3) Custom Matchers</h2>\n<p>We have only one more tool [in our testing toolkit] to discuss: <strong>Custom Jasmine Matchers</strong>.</p>\n<p>For those developers not familiar with the concepts of Jasmine <em>matchers</em>, we recommend the online\nJasmine documentation:</p>\n<a href=\"https://jasmine.github.io/2.0/custom_matcher.html\" title=\"Jasmine Matchers Documentation\">\n![pic9](https://cloud.githubusercontent.com/assets/210413/21524374/334a2f68-ccdb-11e6-816c-5059fc91d806.png)\n</a>\n<p>Remember that matchers are used <strong>after</strong> the <code class=\"language-text\">expect()</code> call and should encapsulate complex logic\nand reduce code-clutter in our test code.</p>\n<blockquote>\n<p>This allows our test(s) to remain terse, concise, readable, maintainable, and DRY.</p>\n</blockquote>\n<p>And we should always give our custom matcher functions clear, readable names. E.g. <strong>toHaveCssStyles()</strong>.</p>\n<h3>Building a TypeScript Matcher</h3>\n<p>Similar to <code class=\"language-text\">expect(...).toBeTruthy()</code>, we want a custom matcher <code class=\"language-text\">toHaveCSSStyle( )</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">expectNativeEl</span><span class=\"token punctuation\">(</span>fixture<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveCssStyle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'display'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'flex-direction'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'row'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'box-sizing'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'border-box'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Creating a matcher in JavaScript is documented on the Jasmine site. Our challenge is the harder\ngoal of creating a <em>custom matcher</em> implemented in TypeScript using well-defined types.</p>\n<ul>\n<li>we need to enhance the <code class=\"language-text\">expect()</code> API, and </li>\n<li>we need to implement custom matchers.</li>\n</ul>\n<p>The global Jasmine <code class=\"language-text\">expect()</code> method normally returns <code class=\"language-text\">&lt;any&gt;</code> value. To use custom matchers\n(with types), we want the <strong>expect( )</strong> function to support returning either a standard matcher or\na custom matcher.</p>\n<p>Here is a teaser that shows how that is done:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">expect</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">actual<span class=\"token punctuation\">:</span> any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> NgMatchers <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>any<span class=\"token operator\">></span> _global<span class=\"token punctuation\">.</span>expect<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">NgMatchers</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">jasmine<span class=\"token punctuation\">.</span>Matchers</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* ... */</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We assigned the global <em>expect</em> function reference to a new export that states that <code class=\"language-text\">expect()</code> calls\nnow return references to a <strong>NgMatchers</strong> interface.</p>\n<p>Here are the full implementation details of our <code class=\"language-text\">custom-matchers.ts</code> module:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">declare <span class=\"token keyword\">var</span> global<span class=\"token punctuation\">:</span> any<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> _global <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>any<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> window <span class=\"token operator\">===</span> <span class=\"token string\">'undefined'</span> <span class=\"token operator\">?</span> global <span class=\"token punctuation\">:</span> window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Extend the API to support chaining with custom matchers\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">expect</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">actual<span class=\"token punctuation\">:</span> any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> NgMatchers <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>any<span class=\"token operator\">></span> _global<span class=\"token punctuation\">.</span>expect<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Jasmine matchers that support checking custom CSS conditions.\n * !! important to add your custom matcher to the interface\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">NgMatchers</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">jasmine<span class=\"token punctuation\">.</span>Matchers</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">toHaveCssStyle</span><span class=\"token punctuation\">(</span>expected<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">}</span><span class=\"token operator\">|</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> boolean<span class=\"token punctuation\">;</span>\n  not<span class=\"token punctuation\">:</span> NgMatchers<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Implementation of 1...n custom matchers\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> customMatchers<span class=\"token punctuation\">:</span> jasmine<span class=\"token punctuation\">.</span>CustomMatcherFactories <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Here is our custom matcher; cloned from @angular/core</span>\n  <span class=\"token function-variable function\">toHaveCssStyle</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">compare</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">actual<span class=\"token punctuation\">:</span> any<span class=\"token punctuation\">,</span> styles<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">}</span><span class=\"token operator\">|</span>string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> allPassed<span class=\"token punctuation\">:</span> boolean<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> styles <span class=\"token operator\">===</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          allPassed <span class=\"token operator\">=</span> <span class=\"token function\">getDOM</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasStyle</span><span class=\"token punctuation\">(</span>actual<span class=\"token punctuation\">,</span> styles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          allPassed <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>styles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n          Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>styles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prop</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            allPassed <span class=\"token operator\">=</span> allPassed <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">getDOM</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasStyle</span><span class=\"token punctuation\">(</span>actual<span class=\"token punctuation\">,</span> prop<span class=\"token punctuation\">,</span> styles<span class=\"token punctuation\">[</span>prop<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n          pass<span class=\"token punctuation\">:</span> allPassed<span class=\"token punctuation\">,</span>\n          <span class=\"token keyword\">get</span> <span class=\"token function\">message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> expectedValueStr <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> styles <span class=\"token operator\">===</span> <span class=\"token string\">'string'</span> <span class=\"token operator\">?</span> styles <span class=\"token punctuation\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>styles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Expected </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>actual<span class=\"token punctuation\">.</span>outerHTML<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token operator\">!</span>allPassed <span class=\"token operator\">?</span> <span class=\"token string\">' '</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'not '</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">to contain the\n                      CSS </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">typeof</span> styles <span class=\"token operator\">===</span> <span class=\"token string\">'string'</span> <span class=\"token operator\">?</span> <span class=\"token string\">'property'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'styles'</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>expectedValueStr<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With the above definitions, we can now use <code class=\"language-text\">expect(...).toHaveCssStyles(...)</code> without any\nTypeScript complaints.</p>\n<p>Wait! </p>\n<p>We need one to discuss one more addition to our custom-matcher code. Did you notice the call to\n<strong>getDOM()</strong>.hasStyle() ? But where does <code class=\"language-text\">getDOM</code> come from? </p>\n<p>After some inspection of the <strong>@angular/core</strong> code, we were able to\nget a reference to the special Angular DOM Adapter:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>__platform_browser_private__<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/platform-browser'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> getDOM <span class=\"token operator\">=</span> __platform_browser_private__<span class=\"token punctuation\">.</span>getDOM<span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>Please note that the <strong>getDOM()</strong> is a private Angular API and may change in the future.</p>\n</blockquote>\n<h3>Using a Custom Matcher</h3>\n<p>Now we are <em>golden</em> with features. Let’s import and use our custom Jasmine matcher.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>customMatchers<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../utils/testing/custom-matchers'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'layout directive'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    jasmine<span class=\"token punctuation\">.</span><span class=\"token function\">addMatchers</span><span class=\"token punctuation\">(</span>customMatchers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// TestBed stuff here...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Notice that we must register the custom matchers in a <code class=\"language-text\">beforeEach()</code> call to configure the\nmatchers for each subsequent test. And now everything is ready for the individual tests:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveCssStyle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'display'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'flex-direction'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'row'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'box-sizing'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'border-box'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Protractor + e2e</h2>\n<p>It should be noted that the above sample tests confirm whether CSS styles have been applied\ncorrectly to the DOM element. Unit tests perform tests logic and state… but those same\ntests cannot easily test how those values affect renderings in the UI.</p>\n<p>Jasmine unit tests <strong>do not</strong> test whether the CSS styles or states render the elements in the\nbrowser as expected. Nor do they test renderings across different browsers. Those types of visual\ntests are best performed in e2e testing with Protractor and visual differencing tools.</p>\n<h2>Summary</h2>\n<p>Perhaps you will say: “Wow, this is cool… but totally overkill!”  If you are tempted to say that,\nthen look at all the DRY tests here:\n<a href=\"https://github.com/angular/flex-layout/blob/master/src/lib/flexbox/api/layout.spec.ts#L45\">layout.spec.ts</a>.\nYou will quickly see the value of using helpers and custom matchers.</p>\n<p>You now have the techniques and tools to create your own custom matchers and deliver quality, terse\nunit tests.</p>\n<p>Enjoy!</p>\n<h2>Resources</h2>\n<ul>\n<li><a href=\"https://github.com/angular/flex-layout/blob/master/src/lib/utils/testing/custom-matchers.ts\">Custom Matchers</a>: a full set of custom Jasmine Matchers</li>\n<li><a href=\"https://github.com/angular/flex-layout/blob/master/src/lib/utils/testing/helpers.ts\">Special Helpers</a>: a reusable, importable set of Helpers</li>\n<li><a href=\"https://github.com/angular/flex-layout/blob/master/src/lib/flexbox/api/layout.spec.ts#L45\">Usage Samples</a>: a full DRY set of usages.</li>\n</ul>\n<blockquote>\n<p>The Flex-Layout Helper functions are actually partial applications (function currying). Here is\n<a href=\"https://github.com/angular/flex-layout/blob/master/src/lib/flexbox/api/layout.spec.ts#L16-L17\">How to use</a> them.</p>\n</blockquote>","frontmatter":{"author":"thomas_burleson","title":"Testing Angular Directives with Custom Matchers","imageUrl":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFdMjRJhX//xAAZEAACAwEAAAAAAAAAAAAAAAACIQABAxL/2gAIAQEAAQUCyBcQheZK7hW//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEhIP/aAAgBAQAGPwKFef/EABgQAQEBAQEAAAAAAAAAAAAAAAERACFR/9oACAEBAAE/IaYQQlfcd5jjJZl3/9oADAMBAAIAAwAAABB7D//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EGf/xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhQVH/2gAIAQEAAT8QTk6FzMmPHRsmKRE+7tU55gSUDsuub//Z","aspectRatio":1.4842578710644678,"src":"/static/9633e131aa37bdc19daab3031453bfae/30037/testing-directives-with-custom-matchers2.jpg","srcSet":"/static/9633e131aa37bdc19daab3031453bfae/10bdc/testing-directives-with-custom-matchers2.jpg 158w,\n/static/9633e131aa37bdc19daab3031453bfae/f4ab0/testing-directives-with-custom-matchers2.jpg 315w,\n/static/9633e131aa37bdc19daab3031453bfae/30037/testing-directives-with-custom-matchers2.jpg 630w,\n/static/9633e131aa37bdc19daab3031453bfae/9810d/testing-directives-with-custom-matchers2.jpg 945w,\n/static/9633e131aa37bdc19daab3031453bfae/ccfd2/testing-directives-with-custom-matchers2.jpg 990w","sizes":"(max-width: 630px) 100vw, 630px"}}},"date":"27 December 2016","summary":"Deliver terse, DRY, self-documenting unit tests with Angular using custom Jasmine Matchers and  Helper functions.","categories":["angular"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/angular/2016/12/27/angular-2-advance-testing-with-custom-matchers.html","previous":{"fields":{"slug":"/angular/2016/11/28/testing-services-with-http-in-angular-2.html"},"frontmatter":{"date":"2016/11/28","title":"Testing Services with Http in Angular","categories":["angular"]}},"next":{"fields":{"slug":"/angular/2017/01/09/a-revamped-angular-master-class.html"},"frontmatter":{"date":"2017/01/09","title":"A revamped Angular Master Class","categories":["angular"]}}}}}