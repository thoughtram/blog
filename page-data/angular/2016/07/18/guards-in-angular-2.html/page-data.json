{"componentChunkName":"component---src-templates-blog-post-js","path":"/angular/2016/07/18/guards-in-angular-2.html","webpackCompilationHash":"0c5d630095500f933ccd","result":{"data":{"site":{"siteMetadata":{"title":"Articles by thoughtram","authors":[{"id":"pascal_precht","name":"Pascal Precht","twitter":"PascalPrecht","img":"https://avatars2.githubusercontent.com/u/445106?s=460&v=4"},{"id":"christoph_burgdorf","name":"Christoph Burgdorf","twitter":"cburgdorf","img":"https://avatars0.githubusercontent.com/u/521109?s=460&v=4"},{"id":"dominic_elm","name":"Dominic Elm","twitter":"d3lm","img":"https://avatars0.githubusercontent.com/u/12571019?s=400&v=4"},{"id":"thomas_burleson","name":"Thomas Burleson","twitter":"thomasburleson","img":"https://avatars3.githubusercontent.com/u/210413?s=400&v=4"},{"id":"elvira_eulitz","name":"Elvira Eulitz","twitter":"ElviraEulitz","img":"https://avatars3.githubusercontent.com/u/29247040?s=400&v=4"},{"id":"maxim_koretskyi","name":"Maxim Koretskyi","twitter":"maxim_koretskyi","img":"https://avatars3.githubusercontent.com/u/6124091?s=400&v=4"}]}},"markdownRemark":{"id":"087d243d-c0f0-59e2-8e41-ac45a8559538","excerpt":"In our last article, Routing in Angular revisited, we talked about the latest changes in the router APIs. While we covered how to set up basic routes, access…","html":"<p>In our last article, <a href=\"/angular/2016/06/14/routing-in-angular-2-revisited.html\">Routing in Angular revisited</a>, we talked about the latest changes in the router APIs. While we covered how to set up basic routes, access parameters and link to other components, we haven’t really talked about more sophisticated use cases like protecting routes.</p>\n<p>Protecting routes is a very common task when building applications, as we want to prevent our users from accessing areas that they’re not allowed to access, or, we might want to ask them for confirmation when leaving a certain area. Angular’s router provides a feature called <strong>Navigation Guards</strong> that try to solve exactly that problem. In this article, we’d like to take a look at the different types of guards and how to implement them for actual use cases.</p>\n<h2>Guard Types</h2>\n<p>There are four different guard types we can use to protect our routes:</p>\n<ul>\n<li><strong>CanActivate</strong> - Decides if a route can be activated</li>\n<li><strong>CanActivateChild</strong> - Decides if children routes of a route can be activated</li>\n<li><strong>CanDeactivate</strong> - Decides if a route can be deactivated</li>\n<li><strong>CanLoad</strong> - Decides if a module can be loaded lazily</li>\n</ul>\n<p>Depending on what we want to do, we might need to implement one or the other guard. In some cases, we even need to implement all of them. Let’s take a look at how to define guards.</p>\n<h2>Defining Guards</h2>\n<p>Guards can be implemented in different ways, but after all it really boils down to a function that returns either <code class=\"language-text\">Observable&lt;boolean&gt;</code>, <code class=\"language-text\">Promise&lt;boolean&gt;</code> or <code class=\"language-text\">boolean</code>. In addition, guards are registered using providers, so they can be injected by Angular when needed.</p>\n<h3>As Functions</h3>\n<p>To register a guard we need to define a token and the guard function. Here’s what a super simple guard implementation could look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  providers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    provide<span class=\"token punctuation\">:</span> <span class=\"token string\">'CanAlwaysActivateGuard'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">useValue</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>As we can see, it’s really just a provider with some made up token that resolves to a guard function that returns <code class=\"language-text\">true</code> (if <code class=\"language-text\">provider</code> doesn’t mean anything to you, go and check out our article on <a href=\"/angular/2015/05/18/dependency-injection-in-angular-2.html\">Dependency Injection in Angular</a>). Since it’s always returning <code class=\"language-text\">true</code>, this guard is not protecting anything, as it will always activate the route that uses it. However, this is really just to demonstrate a guard implementation. We also notice that we’re using a string token, which works fine but what we really want is an <a href=\"/angular/2016/05/23/opaque-tokens-in-angular-2.html\"><code class=\"language-text\">OpaqueToken</code></a> to not run into name collisions.</p>\n<p>Once a guard is registered with a token, we can use it in our route configuration. The following route configuration has the <code class=\"language-text\">CanAlwaysActivateGuard</code> attached, which gets executed when routing to that specific route.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> AppRoutes<span class=\"token punctuation\">:</span>RouterConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> \n    path<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n    component<span class=\"token punctuation\">:</span> SomeComponent<span class=\"token punctuation\">,</span>\n    canActivate<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'CanAlwaysActivateGuard'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As we can see, all we need to do is to define a list of guard tokens that should be called. This also implies that we can have multiple guards protecting a single route. Guards are executed in the order they are defined on the route.</p>\n<h3>As Classes</h3>\n<p>Sometimes, a guard needs dependency injection capabilities. In these cases, it makes sense to define a guard as a class, because dependencies can then be simply injected. Let’s say we want to protect a route and have the user authenticate first. We might want to inject an <code class=\"language-text\">AuthService</code> to determine if the user is authenticated or not. A class guard would be a perfect fit.</p>\n<p>When creating a guard class, we implement either the <code class=\"language-text\">CanActivate</code>, <code class=\"language-text\">CanDeactivate</code>, or <code class=\"language-text\">CanActivateChild</code> interface, which requires us to have a method <code class=\"language-text\">canActivate()</code>, <code class=\"language-text\">canActivateChild()</code>, or <code class=\"language-text\">canDeactivate()</code> respectively. Those methods are pretty much the equivalent of a guard function in the previous scenario. The following snippet shows a simple <code class=\"language-text\">CanActivate</code> guard implementation using classes.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CanActivate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/router'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./auth.service'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CanActivateViaAuthGuard</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">CanActivate</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> authService<span class=\"token punctuation\">:</span> AuthService</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">canActivate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span><span class=\"token function\">isLoggedIn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Pretty straight forward. An <a href=\"/angular/2015/09/17/resolve-service-dependencies-in-angular-2.html\">injectable class</a> with a <code class=\"language-text\">canActivate()</code> method that now has access to injected dependencies. Angular will call that method for us when a guard is implemented as a class. Just like the previous guard, this one needs to be registered as a provider:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  providers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    AuthService<span class=\"token punctuation\">,</span>\n    CanActivateViaAuthGuard\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>And can then be used on a route:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span> \n  path<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  component<span class=\"token punctuation\">:</span> SomeComponent<span class=\"token punctuation\">,</span>\n  canActivate<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'CanAlwaysActivateGuard'</span><span class=\"token punctuation\">,</span>\n    CanActivateViaAuthGuard\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Deactivating Routes</h2>\n<p>We’ve now seen how <code class=\"language-text\">CanActivate</code> can work in different scenarios, but as mentioned earlier, we have a few more guard interfaces we can take advantage of. <code class=\"language-text\">CanDeactivate</code> gives us a chance to decide if we really want to navigate <strong>away</strong> from a route. This can be very useful, if for example we want to prevent our users from losing unsaved changes when filling out a form and accidently clicking on a button to cancel the process.</p>\n<p>The <code class=\"language-text\">CanDeactivate</code> guard also has access to the instance of the active component. With this we can take the user experience even to a higher level. Instead of asking an (unwanted) user confirmation every time, we can do this conditionally by checking if change were made. In the sample below the <code class=\"language-text\">CanDeactivateComponent</code> implements a methods <code class=\"language-text\">hasChanges()</code>. This returns a boolean value indicating if the components has detected any changes. This can be done by checking the dirty state of the form, keeping track of the previous model and compare it with the current one, … What ever fits your needs. </p>\n<p>Implementing a <code class=\"language-text\">CanDeactivate</code> guard is very similar to implementing a <code class=\"language-text\">CanActivate</code> guard. All we have to do is to create again, either a function, or a class that implements the <code class=\"language-text\">CanDeactivate</code> interface.  We can implement a super simple safety net for our users like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CanDeactivate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/router'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CanDeactivateComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app/can-deactivate'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ConfirmDeactivateGuard</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">CanDeactivate</span><span class=\"token operator\">&lt;</span>CanDeactivateComponent<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">canDeactivate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target<span class=\"token punctuation\">:</span> CanDeactivateComponent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span><span class=\"token function\">hasChanges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Do you really want to cancel?'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Even though, this is a very trivial implementation, there’s one thing that we didn’t see in the previous example. <code class=\"language-text\">CanDeactivate&lt;T&gt;</code> uses a generic, so we need to specify what component type we want to deactivate. Honestly, we’re not sure if this is a bug or not. But other than that, it’s very clear what’s going on here. We implement a method <code class=\"language-text\">canDeactivate()</code>, that is called by Angular’s router internally if needed. Last but not least, also this guard needs to be registered accordingly:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  providers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token operator\">...</span>\n    ConfirmDeactivateGuard\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Conclusion</h2>\n<p>Guards are great. They enable us to protect certain routes or even protect the user from losing data. In addition, we can have multiple guards protecting a single route, which helps us implementing sophisticated use cases, where a chain of different checks is needed.</p>","frontmatter":{"author":"pascal_precht","title":"Protecting Routes using Guards in Angular","imageUrl":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAgb/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB27y9GLwoJ//EABoQAQEAAgMAAAAAAAAAAAAAAAIBABEDBCH/2gAIAQEAAQUC6/Psly3Cqc3Q4/P/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAAQEQACIZH/2gAIAQEABj8CVuxDD//EABoQAAMBAAMAAAAAAAAAAAAAAAABESEQQfH/2gAIAQEAAT8h7TmIONauND0SY6OH/9oADAMBAAIAAwAAABCs/wD/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQH/2gAIAQMBAT8QmI//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCn/8QAGhABAQADAQEAAAAAAAAAAAAAAREAIUFhMf/aAAgBAQABPxBKdQnrwffcFRpJih3EFDRsdgeOFgQCK7ifLixQU1bn/9k=","aspectRatio":1.5,"src":"/static/52b18ff2fc740950139e2058b9de89fe/30037/protecting-routes-using-guards-in-angular-2.jpg","srcSet":"/static/52b18ff2fc740950139e2058b9de89fe/10bdc/protecting-routes-using-guards-in-angular-2.jpg 158w,\n/static/52b18ff2fc740950139e2058b9de89fe/f4ab0/protecting-routes-using-guards-in-angular-2.jpg 315w,\n/static/52b18ff2fc740950139e2058b9de89fe/30037/protecting-routes-using-guards-in-angular-2.jpg 630w,\n/static/52b18ff2fc740950139e2058b9de89fe/9810d/protecting-routes-using-guards-in-angular-2.jpg 945w,\n/static/52b18ff2fc740950139e2058b9de89fe/ff2e4/protecting-routes-using-guards-in-angular-2.jpg 1260w,\n/static/52b18ff2fc740950139e2058b9de89fe/ad7c9/protecting-routes-using-guards-in-angular-2.jpg 4896w","sizes":"(max-width: 630px) 100vw, 630px"}}},"date":"18 July 2016","summary":"Angular's router enables protecting routes using guards and in this article we're going to discuss how to implement them.","categories":["angular"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/angular/2016/07/18/guards-in-angular-2.html","previous":{"fields":{"slug":"/announcements/2016/06/23/updates-and-announcements.html"},"frontmatter":{"date":"2016/06/23","title":"Updates and announcements","categories":["announcements"]}},"next":{"fields":{"slug":"/angular/2016/07/27/custom-form-controls-in-angular-2.html"},"frontmatter":{"date":"2016/07/27","title":"Custom Form Controls in Angular","categories":["angular"]}}}}}