{"componentChunkName":"component---src-templates-blog-post-js","path":"/angular/2016/06/16/cold-vs-hot-observables.html","webpackCompilationHash":"0c5d630095500f933ccd","result":{"data":{"site":{"siteMetadata":{"title":"Articles by thoughtram","authors":[{"id":"pascal_precht","name":"Pascal Precht","twitter":"PascalPrecht","img":"https://avatars2.githubusercontent.com/u/445106?s=460&v=4"},{"id":"christoph_burgdorf","name":"Christoph Burgdorf","twitter":"cburgdorf","img":"https://avatars0.githubusercontent.com/u/521109?s=460&v=4"},{"id":"dominic_elm","name":"Dominic Elm","twitter":"d3lm","img":"https://avatars0.githubusercontent.com/u/12571019?s=400&v=4"},{"id":"thomas_burleson","name":"Thomas Burleson","twitter":"thomasburleson","img":"https://avatars3.githubusercontent.com/u/210413?s=400&v=4"},{"id":"elvira_eulitz","name":"Elvira Eulitz","twitter":"ElviraEulitz","img":"https://avatars3.githubusercontent.com/u/29247040?s=400&v=4"},{"id":"maxim_koretskyi","name":"Maxim Koretskyi","twitter":"maxim_koretskyi","img":"https://avatars3.githubusercontent.com/u/6124091?s=400&v=4"}]}},"markdownRemark":{"id":"14fa32b5-9a6b-5356-86d8-709007285df4","excerpt":"One of the most exciting topics around Angular is its relationship to Observables. It’s such an essential part of the framework that we cover a fair amount of…","html":"<p>One of the most exciting topics around Angular is its relationship to Observables. It’s such an essential part of the framework that we cover a fair amount of Observable knowledge in our <a href=\"http://thoughtram.io/angular2-master-class.html\">Angular Master Class</a>. That said, the topic is so big that one could easily run a 3-day workshop on Observables itself.</p>\n<p>There’s one particular area of Observables that we don’t explicitly touch on in our workshop but that keeps coming up in questions every single time that we teach them.</p>\n<h2>Hot vs Cold Observables</h2>\n<p>Understanding the nature of hot and cold Observables is a crucial part to master Observables. Before we try to explore the topic through some practical examples, let’s read through the <a href=\"https://github.com/Reactive-Extensions/RxJS/blob/master/doc/gettingstarted/creating.md#cold-vs-hot-observables\">definition</a> from the RxJS project itself:</p>\n<blockquote>\n<p>Cold observables start running upon subscription, i.e., the observable sequence only starts pushing values to the observers when Subscribe is called. (…) This is different from hot observables such as mouse move events or stock tickers which are already producing values even before a subscription is active.</p>\n</blockquote>\n<p>Ok, so far so good. Let’s see what that means in practice.</p>\n<p>We start with a basic Observable that simply emits the number <code class=\"language-text\">1</code>. We make two independent subscriptions to the same Observable and print out the output with a prefix so that we can tell them apart.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> obs <span class=\"token operator\">=</span> Rx<span class=\"token punctuation\">.</span>Observable<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">observer</span> <span class=\"token operator\">=></span> observer<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nobs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1st subscriber: \"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nobs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2nd subscriber: \"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>When we <a href=\"http://jsbin.com/mihoyifiku/1/edit?js,console\">run this code</a> we’ll see the following output in the console.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1st subscriber: 1\n2nd subscriber: 1</code></pre></div>\n<p>Ok, cool. But the interesting question remains: is <code class=\"language-text\">obs</code> cold or hot? Let’s forget for a moment that we know how <code class=\"language-text\">obs</code> was created and imagine we would have obtained a reference to <code class=\"language-text\">obs</code> by calling <code class=\"language-text\">getObservableFromSomewhere()</code> instead. If that was the case, we wouldn’t be able to tell whether it’s cold or hot. And that’s one important thing to understand. It’s not always possible from the subscriber side to know whether you are dealing with a cold or hot Observable.</p>\n<p>If we turn back to the definition that we cited in the beginning and think about what makes an Observable cold or hot, we can read between the lines and notice that if <code class=\"language-text\">obs</code> was cold it should produce <em>fresh</em>  values upon subscription. But the pity is, with a value such as <code class=\"language-text\">1</code> we can’t easily tell whether it was created freshly upon subscription or not. So let’s replace <code class=\"language-text\">1</code> with <code class=\"language-text\">Date.now()</code> and see what happens.</p>\n<p>If we <a href=\"http://jsbin.com/xosipocoza/1/edit?js,console\">run that code</a> again we’ll notice that we actually get different output per subscription. Notice the change in the last digit.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token number\">1</span>st subscriber<span class=\"token punctuation\">:</span> <span class=\"token number\">1465990942935</span>\n<span class=\"token number\">2</span>nd subscriber<span class=\"token punctuation\">:</span> <span class=\"token number\">1465990942936</span></code></pre></div>\n<p>With this output it is clear that there must have been two calls to <code class=\"language-text\">observer.next(Date.now())</code>. In other words, the Observable <em>started producing</em> the values upon each subscription which makes it cold by definition.</p>\n<h2>Making Cold Observables Hot</h2>\n<p>Now that we know that our Observable is clearly cold, let’s try to warm it up a little.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> obs <span class=\"token operator\">=</span> Rx<span class=\"token punctuation\">.</span>Observable\n            <span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">observer</span> <span class=\"token operator\">=></span> observer<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">publish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nobs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1st subscriber: \"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nobs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2nd subscriber: \"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nobs<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Let’s ignore the <code class=\"language-text\">publish</code> and <code class=\"language-text\">connect</code> operators for a moment and solely focus on the <a href=\"http://jsbin.com/pupoledehi/1/edit?js,console\">output</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token number\">1</span>st subscriber<span class=\"token punctuation\">:</span> <span class=\"token number\">1465994477014</span>\n<span class=\"token number\">2</span>nd subscriber<span class=\"token punctuation\">:</span> <span class=\"token number\">1465994477014</span></code></pre></div>\n<p>Clearly we can see that there must have been only one call to <code class=\"language-text\">observer.next(Date.now())</code> with this setup as the numbers are identical. So, is it hot now? Well, kind of. Let’s put it that way: it’s warmer than a cold one but colder than a really hot one. It’s hot in the sense that there’s no new <em>value producer/source</em> (the thing calling <code class=\"language-text\">observer.next(val)</code>) created upon subscription. But it’s cold in the sense that it doesn’t start producing values <em>before</em> the subscriptions exist.</p>\n<p>We can fix that by moving the <code class=\"language-text\">connect</code> call before the subscriptions.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> obs <span class=\"token operator\">=</span> Rx<span class=\"token punctuation\">.</span>Observable\n            <span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">observer</span> <span class=\"token operator\">=></span> observer<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">publish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nobs<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nobs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1st subscriber: \"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nobs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2nd subscriber: \"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>However, when we <a href=\"http://jsbin.com/sokayofise/1/edit?js,console\">run this code</a> we don’t see any output at all. And that’s expected behaviour because now <code class=\"language-text\">obs</code> is really really hot as in <em>it produces values no matter if anyone listens or not</em>. So by the time that our two subscribers start listening the value has long been pumped through.</p>\n<p>In order to be able to understand the purpose of <code class=\"language-text\">publish</code> better, let’s use an Observable that will produce infinite values instead of just a single one.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> obs <span class=\"token operator\">=</span> Rx<span class=\"token punctuation\">.</span>Observable\n            <span class=\"token punctuation\">.</span><span class=\"token function\">interval</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">publish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">refCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nobs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1st subscriber:\"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// delay for a little more than a second and then add second subscriber</span>\n  <span class=\"token operator\">=></span> obs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2nd subscriber:\"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The setup we use is slightly more complex from what we had before, so let’s break it down.</p>\n<ol>\n<li>We use <code class=\"language-text\">interval(1000)</code> to create an Observable that emits every second with an increasing index value starting at <code class=\"language-text\">0</code>.</li>\n<li>We use <code class=\"language-text\">publish</code> to share the <em>value producer</em> across several subscriptions (one indicator of being hot!)</li>\n<li>We defer the second subscription by one second.</li>\n</ol>\n<p>Let’s just ignore <code class=\"language-text\">refCount</code> for now as we’re going to explain it later.</p>\n<p>We see the following output as we <a href=\"http://jsbin.com/kosavihiru/edit?js,console\">run the script</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1st subscriber:0\n1st subscriber:1\n2nd subscriber:1\n1st subscriber:2\n2nd subscriber:2\n...</code></pre></div>\n<p>Clearly, we can see that the second subscriber is not starting over at <code class=\"language-text\">0</code>. But that would have been the case if we didn’t use <code class=\"language-text\">publish</code> to share the value producing source across subscribers.</p>\n<h2>Understanding <code class=\"language-text\">publish</code>, <code class=\"language-text\">refCount</code> and <code class=\"language-text\">connect</code></h2>\n<p>But how hot is <code class=\"language-text\">obs</code> in this scenario? Let’s make it visible by defering both subscriptions by another 2 seconds. If it’s really hot we shouldn’t see the numbers <code class=\"language-text\">0</code> and <code class=\"language-text\">1</code> at all because they would have been emitted <em>before</em>  we start to listen, right?</p>\n<p>Let’s try out and <a href=\"http://jsbin.com/nujokuwava/edit?js,console\">run this code</a> instead.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> obs <span class=\"token operator\">=</span> Rx<span class=\"token punctuation\">.</span>Observable\n            <span class=\"token punctuation\">.</span><span class=\"token function\">interval</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">publish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">refCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// delay both subscriptions by 2 seconds</span>\n  obs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1st subscriber:\"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// delay for a little more than a second and then add second subscriber</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> obs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>\n          <span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2nd subscriber:\"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Interestingly we see exactly the same output as in the previous experiment which means we are dealing with an Observable that is rather warm than really hot. And that’s because of the way <code class=\"language-text\">refCount</code> works. The <code class=\"language-text\">publish</code> operator creates an <code class=\"language-text\">ConnectableObservable</code> which means it creates an Observable that shares one single subscription to the underlying source. However, the <code class=\"language-text\">publish</code> operator doesn’t subscribe to the underlying source just yet. It’s more like a gatekeeper that makes sure that subscriptions aren’t made to the underlying source but to the <code class=\"language-text\">ConnectableObservable</code> instead.</p>\n<p>It’s the job of the <code class=\"language-text\">connect</code> operator to actually cause the <code class=\"language-text\">ConnectableObservable</code> to subscribe to the underlying source (the thing that produces values). In our case we’re using <code class=\"language-text\">refCount</code> which is an operator that builds up on <code class=\"language-text\">connect</code> and causes the <code class=\"language-text\">ConnectableObservable</code> to subscribe to the underlying source as soon as there is a first subscriber and to unsubscribe from it as soon as there’s no subscriber anymore. It simply keeps track of how many subscriptions are made to the <code class=\"language-text\">ConnectableObservable</code>.</p>\n<p>And this explains why we see values starting at <code class=\"language-text\">0</code> with our last experiment. It’s because the subscription to the underlying source is only made once that we have a first subscriber to the <code class=\"language-text\">ConnectableObservable</code>.</p>\n<p>If we want <code class=\"language-text\">obs</code> to be truly hot, we have to call <code class=\"language-text\">connect</code> ourselves early on.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> obs <span class=\"token operator\">=</span> Rx<span class=\"token punctuation\">.</span>Observable\n            <span class=\"token punctuation\">.</span><span class=\"token function\">interval</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">publish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nobs<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  obs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1st subscriber:\"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> obs<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2nd subscriber:\"</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Notice how we get values starting from <code class=\"language-text\">2</code> when we <a href=\"http://jsbin.com/cumukoyana/1/edit?js,console\">run this code</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1st subscriber:2\n1st subscriber:3\n2nd subscriber:3</code></pre></div>\n<p>This means we now have a truly hot Observable that produces values no matter if someone listens or not.</p>\n<h2>When to use what</h2>\n<p>As we’ve seen the question whether an Observable is hot or cold is everything but black and white. In fact there are several strategies how values may be pushed to subscribers that we didn’t even touch on yet. In general we can say that we should be dealing with a hot Observable whenever we subscribe to something that is generating values no matter if someone is listening or not. When we subscribe to such a hot Observable, we don’t see past values but only new ones that were generated after our subscription.</p>\n<p>A typical example of a hot observable are <code class=\"language-text\">mousemove</code> events. The mouse moves happen regardless if someone is listening or not. When we start listening for them, we only get future events.</p>\n<p>Cold Observables on the other hand are the lazy ones. They only start producing values when someone subscribes. But then again, it’s really not a black and white thing. An iced cold Observable starts reproducing the values it emits independently with every new subscriber as we’ve seen in the examples above. But how should we call an Observable that only starts generating values as the first subscriber subscribes and then shares and reemits the exact same values to every new subscriber? Things get blurry and categorizing only by cold and hot doesn’t really cut it for every possible use case.</p>\n<p>As a rule of thumb, when you have a cold Observable and you want multiple subscribers to it, and you don’t want them to cause regenerating the values but rather reusing existing values, you need to start thinking about <code class=\"language-text\">publish</code> and friends.</p>\n<h2>Caveat: Http with Observables</h2>\n<p>The <code class=\"language-text\">Http</code> service in Angular >= 2.x returns cold Observables and the implications may surprise us.</p>\n<p>Consider this <a href=\"http://plnkr.co/edit/Vq9fHqfTIo6OU746LW1c?p=preview\">simple component</a> that requests a <code class=\"language-text\">contacts.json</code> file from a server and renders the contacts as a list in the template.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">...</span>\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;ul>\n      &lt;li *ngFor=\"let contact of contacts | async\">{{contact.name}}&lt;/li>\n    &lt;/ul>\n    </span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppComponent</span> <span class=\"token punctuation\">{</span>\n  contacts<span class=\"token punctuation\">:</span> Observable<span class=\"token operator\">&lt;</span>Array<span class=\"token operator\">&lt;</span>any<span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">http<span class=\"token punctuation\">:</span> Http</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>contacts <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'contacts.json'</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As we can see above, we’re exposing an <code class=\"language-text\">Observable&lt;Array&lt;any&gt;&gt;</code> to the template and subscribe to it from the template using the <code class=\"language-text\">AsyncPipe</code>.</p>\n<p>The <code class=\"language-text\">contacts.json</code> contains a simple object with an <code class=\"language-text\">items</code> property holding the collection of contacts.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"items\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"John Conner\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Arnold Schwarzenegger\"</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now the interesting question is: What happens if we’d subscribe to it twice by adding another list to our template?</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">1st List\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">*ngFor</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>let contact of contacts | async<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{contact.name}}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n2st List\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">*ngFor</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>let contact of contacts | async<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{contact.name}}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>If we <a href=\"http://plnkr.co/edit/E21Vv1L2H3KiOYqLgr6m?p=preview\">run that code</a> and take a look at the network tab of our browser, we’ll notice that the browser fetches <code class=\"language-text\">contacts.json</code> twice! And that’s in stark contrast to what we’re used to when working with Promises for example. In fact, simply importing the <code class=\"language-text\">toPromise</code> operator and adding it as the last operator to our Observable causes the second request to <a href=\"http://plnkr.co/edit/RXGyYPB4c3pL2bk6m2l2?p=preview\">vanish</a>.</p>\n<p>But let’s not fall back to Promises just yet. With all our knowledge regarding cold and hot Observables we should be able to simply fix our Observable so that it shares one single subscription to the underlying source - the Observable that issues the HTTP call.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>contacts <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'contacts.json'</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">publish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">refCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a href=\"http://plnkr.co/edit/RvnMFxtl58SRgGW8eamC?p=preview\">That</a> should do it, right? Well, almost. We can see that there’s no second request anymore. But there’s still a big issue that makes the code behave quite differently from what we are used with Promises.</p>\n<p>Consider we’d want the second list to show up after a delay of 500ms. We could change the code to this.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    1st List\n    &lt;ul>\n      &lt;li *ngFor=\"let contact of contacts | async\">{{contact.name}}&lt;/li>\n    &lt;/ul>\n    2st List\n    &lt;ul>\n      &lt;li *ngFor=\"let contact of contacts2 | async\">{{contact.name}}&lt;/li>\n    &lt;/ul>\n    </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppComponent</span> <span class=\"token punctuation\">{</span>\n  contacts<span class=\"token punctuation\">:</span> Observable<span class=\"token operator\">&lt;</span>Array<span class=\"token operator\">&lt;</span>any<span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n  contacts2<span class=\"token punctuation\">:</span> Observable<span class=\"token operator\">&lt;</span>Array<span class=\"token operator\">&lt;</span>any<span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">http<span class=\"token punctuation\">:</span> Http</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>contacts <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'contacts.json'</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">publish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">refCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>contacts2 <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>contacts<span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Notice that we are still using our one and only Observable but we are reexposing it as <code class=\"language-text\">contacts2</code> after 500ms. But when we <a href=\"http://plnkr.co/edit/coxJ88q0F0HON06kpYnk?p=preview\">run the code</a>, we notice that our second list isn’t showing up!</p>\n<p>If you think about it, it makes perfect sense. With the use of <code class=\"language-text\">publish</code> we caused the Observable to share a single subscription to the underlying source - we made it hot. But maybe we made it a little too hot. Now when we have a second subscriber starting to listen after 500ms it will only get notified about new values that arrive after its subscription. What we rather want is that new subscribers see exactly the old values that were already emitted earlier. Fortunately we can have exactly that behaviour by using <code class=\"language-text\">publishLast</code> instead of <code class=\"language-text\">publish</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>contacts <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'contacts.json'</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">publishLast</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">refCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now when we <a href=\"http://plnkr.co/edit/nyatJl5qXp8KtyN1TX80?p=preview\">run that code</a> we see our second list after 500ms but we still don’t see a second request. In other words, we created an Observable that emits upon subscription with the data that was fetched with the first request.</p>\n<h2>Useful shortcut</h2>\n<p>Since using publish and refCount together is such a useful pattern there is an operator that combines them, and it’s called <code class=\"language-text\">.share()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>contacts <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'contacts.json'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">share</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>Note: When using multiple async pipes on streams with default values, the <code class=\"language-text\">.share()</code> operator might cause problems:</strong></p>\n<p>The <code class=\"language-text\">share()</code> will publish the first value of the stream on the first subscription. The first async pipe will trigger that subscription and get that initial value. The second async pipe however will subscribe after that value has already been emitted and therefore miss that value.</p>\n<p>The solution for this problem is the <code class=\"language-text\">.shareReplay(1)</code> operator, which will keep track of the previous value of the stream. That way all the async pipes will get the last value. Just like the <code class=\"language-text\">share()</code> operator is a shortcut for <code class=\"language-text\">publish().refCount()</code>, the <code class=\"language-text\">shareReplay(1)</code> operator is a shortcut for <code class=\"language-text\">publishReplay(1).refCount()</code>. We can see the difference between <code class=\"language-text\">share()</code> and <code class=\"language-text\">shareReplay(1)</code> in <a href=\"http://plnkr.co/edit/PATRQvsWYWmwvcPiaOZJ?p=preview\">the following plunk</a>.\nWe should always pass <code class=\"language-text\">1</code> as the parameter value to the shareReplay function. Otherwise RxJS will keep track of all the values of that observable, when we only need the last one.</p>\n<p>It’s important to note that this problem will only occur when using streams with initial values.\nThe share operator would not pose problems with regular http requests for instance.</p>\n<p>Whew! We came a long way. We hope this gives you a clearer picture of what the term hot vs cold actually means when it comes to Observables.</p>","frontmatter":{"author":"christoph_burgdorf","title":"Cold vs Hot Observables","imageUrl":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABx0dAFLlv/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAECEyES/9oACAEBAAEFAuEVRKoj0i8Wn//EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAwEBPwGMv//EABYRAAMAAAAAAAAAAAAAAAAAAAABEv/aAAgBAgEBPwGmUz//xAAYEAACAwAAAAAAAAAAAAAAAAABEAAxYf/aAAgBAQAGPwKmYcX/xAAcEAADAAMAAwAAAAAAAAAAAAAAAREhMWFBcZH/2gAIAQEAAT8hSXHHsT7vmTo/o+zxRlKMFZ//2gAMAwEAAgADAAAAEH/P/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EEDkC//EABcRAQADAAAAAAAAAAAAAAAAAAARQWH/2gAIAQIBAT8Qltu//8QAHhABAAIBBAMAAAAAAAAAAAAAAQARITFBUXFhgdH/2gAIAQEAAT8QyFjCO67l2slWjB8SrUvSZUXYHJVfYMWgUdw3JvwT/9k=","aspectRatio":1.5,"src":"/static/d550940c5a72ca3cbffb5c5023027172/30037/hot-vs-cold-observables.jpg","srcSet":"/static/d550940c5a72ca3cbffb5c5023027172/10bdc/hot-vs-cold-observables.jpg 158w,\n/static/d550940c5a72ca3cbffb5c5023027172/f4ab0/hot-vs-cold-observables.jpg 315w,\n/static/d550940c5a72ca3cbffb5c5023027172/30037/hot-vs-cold-observables.jpg 630w,\n/static/d550940c5a72ca3cbffb5c5023027172/9810d/hot-vs-cold-observables.jpg 945w,\n/static/d550940c5a72ca3cbffb5c5023027172/ff2e4/hot-vs-cold-observables.jpg 1260w,\n/static/d550940c5a72ca3cbffb5c5023027172/2a5e2/hot-vs-cold-observables.jpg 1500w","sizes":"(max-width: 630px) 100vw, 630px"}}},"date":"16 June 2016","summary":"In this article we are going to demystify what the term hot vs cold means when it comes to Observables.","categories":["angular"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/angular/2016/06/16/cold-vs-hot-observables.html","previous":{"fields":{"slug":"/angular/2016/06/14/routing-in-angular-2-revisited.html"},"frontmatter":{"date":"2016/06/14","title":"Routing in Angular revisited","categories":["angular"]}},"next":{"fields":{"slug":"/angular/2016/06/22/model-driven-forms-in-angular-2.html"},"frontmatter":{"date":"2016/06/22","title":"Reactive Forms in Angular","categories":["angular"]}}}}}