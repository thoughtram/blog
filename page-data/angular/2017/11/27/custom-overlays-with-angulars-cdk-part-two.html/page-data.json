{"componentChunkName":"component---src-templates-blog-post-js","path":"/angular/2017/11/27/custom-overlays-with-angulars-cdk-part-two.html","webpackCompilationHash":"0c5d630095500f933ccd","result":{"data":{"site":{"siteMetadata":{"title":"Articles by thoughtram","authors":[{"id":"pascal_precht","name":"Pascal Precht","twitter":"PascalPrecht","img":"https://avatars2.githubusercontent.com/u/445106?s=460&v=4"},{"id":"christoph_burgdorf","name":"Christoph Burgdorf","twitter":"cburgdorf","img":"https://avatars0.githubusercontent.com/u/521109?s=460&v=4"},{"id":"dominic_elm","name":"Dominic Elm","twitter":"d3lm","img":"https://avatars0.githubusercontent.com/u/12571019?s=400&v=4"},{"id":"thomas_burleson","name":"Thomas Burleson","twitter":"thomasburleson","img":"https://avatars3.githubusercontent.com/u/210413?s=400&v=4"},{"id":"elvira_eulitz","name":"Elvira Eulitz","twitter":"ElviraEulitz","img":"https://avatars3.githubusercontent.com/u/29247040?s=400&v=4"},{"id":"maxim_koretskyi","name":"Maxim Koretskyi","twitter":"maxim_koretskyi","img":"https://avatars3.githubusercontent.com/u/6124091?s=400&v=4"}]}},"markdownRemark":{"id":"adcfe913-d96a-549b-987c-25566c0fcf4e","excerpt":"In a previous post we have layed the foundation for our custom overlay. To recap, we wanted to build a Google Drive-like custom overlay that looks and feels…","html":"<p>In a <a href=\"/angular/2017/11/20/custom-overlays-with-angulars-cdk.html\">previous post</a> we have layed the foundation for our custom overlay. To recap, we wanted to build a Google Drive-like custom overlay that looks and feels much like the one built for <a href=\"https://machinelabs.ai/editor/rJQrQ5wjZ/1506415557004-HkTTQ5Dob?file=ml.yaml&#x26;tab=outputs&#x26;preview=-KuyslgjIn7kSpuc6pDZ\">MachineLabs</a>. Let’s have a look at a preview:</p>\n<p><img src=\"/8b38e48e2375ae32088cc955d25ef223/overlay_preview.gif\" alt=\"overlay preview\"></p>\n<p>In the first part of this series we learned how to use Angular’s CDK to create our very first custom overlay. On top of that we made it configurable, implemented a “handle” to control (e.g. close) an opened overlay and made it possible to share data with the overlay component.</p>\n<p>In this post, we’ll pick up from where we left off and implement a few additional features that will take our overlay to the next level. More specifically, we’ll implement keyboard support, image preloading and add animations in order to make our overlay more engaging and provide better feedback. In the end, we’ll complete this post by adding a toolbar component to fully match Google Drive’s look and feel.</p>\n<p>Let’s dive right into it!</p>\n<h2>Adding keyboard support</h2>\n<p>Adding keyboard support is easy. All we need to do is to use the <code class=\"language-text\">@HostListener()</code> decorator. This decorator is a <strong>function decorator</strong> that accepts an <strong>event name</strong> as an argument. Let’s use it inside our <code class=\"language-text\">FilePreviewOverlayComponent</code> to listen to <code class=\"language-text\">keydown</code> events on the HTML Document, so that we can close the overlay whenever the escape button was pressed.</p>\n<p>Closing the dialog from within the overlay component is only possible because the <code class=\"language-text\">FilePreviewOverlayRef</code> is now available via the DI system. Remember that we created our own custom injector and defined custom injection tokens for the remote control and the data that we want to share with the component.</p>\n<p>Let’s have a look at the code:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span> HostListener <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Keycode for ESCAPE</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">ESCAPE</span> <span class=\"token operator\">=</span> <span class=\"token number\">27</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayComponent</span> <span class=\"token punctuation\">{</span>\n<span class=\"token operator\">...</span>\n<span class=\"token comment\">// Listen on keydown events on a document level</span>\n@<span class=\"token function\">HostListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'document:keydown'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'$event'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> <span class=\"token function\">handleKeydown</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">:</span> KeyboardEvent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>keyCode <span class=\"token operator\">===</span> <span class=\"token constant\">ESCAPE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dialogRef<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">public</span> dialogRef<span class=\"token punctuation\">:</span> FilePreviewOverlayRef<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Using the host listener we decorate a class method that is called on every <code class=\"language-text\">keydown</code> event. The function itself gets the <code class=\"language-text\">KeyboardEvent</code> that we can use to check whether it’s the <strong>escape</strong> key and only then call <code class=\"language-text\">close()</code> on the <code class=\"language-text\">dialogRef</code>.</p>\n<p>That’s it already for adding keyboard support. Go ahead and try it out. Open a file preview and then press the escape button.</p>\n<iframe style=\"height: 500px\" src=\"https://stackblitz.com/edit/custom-overlay-step-6?embed=1&file=app/file-preview-overlay.component.ts&ctl=1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n<h2>Preloading images</h2>\n<p>Instant app response is without any doubt the best, but there are cases when our apps won’t be able to deliver the content immediately, e.g. slow internet connection or even latency issues. In those cases it’s extremely important to provide users with feedback and indicate that progress is being made. It’s crucial to let the user know what is happening in contrast to keep them guessing. One of the most common forms of such feedback is a progress indicator. It reduces the user’s uncertainty, perception of time and offers a reason to wait.</p>\n<p>Looking at our overlay, we are facing the exact same problems. When we click to preview an image, depending on the internet connection, the image is fetched by the browser and progressively rendered onto the screen. If the connection is really bad it may take a while. Also, it doesn’t really look that nice if we display image data as it is received, resulting in a top-down filling in of the image.</p>\n<p>To solve this, we can use a progress indicator. The good thing is we don’t need to write one from scratch because Angular Material already provides a nice set of loading indicators, one of which is the <code class=\"language-text\">&lt;mat-spinner&gt;</code>. In order to use it, we need to add the <code class=\"language-text\">MatProgressSpinnerModule</code> from <code class=\"language-text\">@angular/material</code> to the imports of our application:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span> MatProgressSpinnerModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/material'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span>\n    MatProgressSpinnerModule\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Note that the <code class=\"language-text\">&lt;mat-spinner&gt;</code> component is an alias for <code class=\"language-text\">&lt;mat-progress-spinner mode=&quot;indeterminate&quot;&gt;</code>. As we can see, the progress-spinner supports different modes, <strong>determinate</strong> and <strong>indeterminate</strong>.</p>\n<p>The difference is that determinate progress indicators are used to indicate how long an operation will take, whereas indeterminate indicators request that the user needs to wait while something finishes. The latter is used when it’s not necessary to indicate how long it will take or to convey a discrete progress. This is perfect for preloading images because we have no idea how long it may take to fetch the image.</p>\n<p>Ok, now that we have added the respective module to our imports we can go ahead and update the template of the <code class=\"language-text\">FilePreviewOverlayComponent</code> as well as the component class:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;div class=\"overlay-content\">\n      &lt;div class=\"spinner-wrapper\" *ngIf=\"loading\">\n        &lt;mat-spinner>&lt;/mat-spinner>\n      &lt;/div>\n\n      &lt;img (load)=\"onLoad($event)\" [style.opacity]=\"loading ? 0 : 1\" [src]=\"image.url\">\n    &lt;/div>\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayComponent</span> <span class=\"token punctuation\">{</span>\n\n  loading <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token operator\">...</span>\n\n  <span class=\"token function\">onLoad</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">:</span> Event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loading <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>First off, we introduce a new property <code class=\"language-text\">loading</code> and initialize it with a meaningful value, e.g. <code class=\"language-text\">false</code>. This will show our spinner until the image is loaded. Also note that we are using a property binding to set the <code class=\"language-text\">opacity</code> of the <code class=\"language-text\">&lt;img&gt;</code> element to 0 when it’s loading and 1 when it’s finished. If we didn’t do this, we’d still see the image being rendered or filled in from top to bottom. This is just a temporary solution that we will replace with a proper solution using Angular’s Animation DSL in just a moment. Last but not least, we define a success callback as a method on our class that is called when the image is loaded. The callback is hooked up in the template via an event binding. In this particular case we are listening for the <code class=\"language-text\">load</code> event and when fired, we call the <code class=\"language-text\">onLoad()</code> method.</p>\n<p>One more thing to mention is that we needed to wrap the spinner in another element. The reason for this is that we want the spinner to be vertically and horizontally centered. To achieve this we would leverage the CSS <code class=\"language-text\">transform</code> property to apply a transformation to the spinner element. The problem is that the <code class=\"language-text\">&lt;mat-spinner&gt;</code> component is animated with CSS transforms meaning every transformation we set on the element is overridden. Therefore we use a container that wraps the spinner, so that we can savely apply transformation and center it on the screen.</p>\n<p>Here’s the image preloading in action. To better demonstrate the loading, you can throttle your connection in the “Network” tab of Chrome’s DevTools.</p>\n<iframe style=\"height: 500px\" src=\"https://stackblitz.com/edit/custom-overlay-step-7?embed=1&file=app/file-preview-overlay.component.ts&ctl=1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n<h2>Animating the overlay</h2>\n<p>With animations we aim to guide users between views so they feel comfortable using the site, draw focused-attention to some parts of our application, increase spacial awareness, indicate if data is being loaded, and probably the most important point - <strong>smoothly transition users between states</strong>.</p>\n<p>The problem with our overlay is that it still pops right into our faces. The backdrop is already animated for us, but having an animation only for the backdrop is not enough. We also want to add a little bit of motion to the overlay component, so that it’s less surprising for the user.</p>\n<p>If you are completely new to animations in Angular, please check out our post on the <a href=\"/angular/2016/09/16/angular-2-animation-important-concepts.html\">Foundation Concepts</a> or have a look at our <a href=\"angular/2017/07/26/a-web-animations-deep-dive-with-angular.html\">Web Animations Deep Dive with Angular</a>.</p>\n<p>Let’s start off by importing the <code class=\"language-text\">BrowserAnimationsModule</code> into our application’s <code class=\"language-text\">NgModule</code> like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BrowserAnimationsModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/platform-browser/animations'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span>\n    BrowserAnimationsModule\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>With this in place, we can go ahead and define our animations with Angular’s Animation DSL and add it to the component via the <code class=\"language-text\">animations</code> metadata property in the <code class=\"language-text\">@Component()</code> decorator:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Reusable animation timings</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">ANIMATION_TIMINGS</span> <span class=\"token operator\">=</span> <span class=\"token string\">'400ms cubic-bezier(0.25, 0.8, 0.25, 1)'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  animations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fade'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fadeOut'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> opacity<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fadeIn'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> opacity<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">transition</span><span class=\"token punctuation\">(</span><span class=\"token string\">'* => fadeIn'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ANIMATION_TIMINGS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'slideContent'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token string\">'void'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> transform<span class=\"token punctuation\">:</span> <span class=\"token string\">'translate3d(0, 25%, 0) scale(0.9)'</span><span class=\"token punctuation\">,</span> opacity<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token string\">'enter'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> transform<span class=\"token punctuation\">:</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">,</span> opacity<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token string\">'leave'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> transform<span class=\"token punctuation\">:</span> <span class=\"token string\">'translate3d(0, 25%, 0)'</span><span class=\"token punctuation\">,</span> opacity<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">transition</span><span class=\"token punctuation\">(</span><span class=\"token string\">'* => *'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ANIMATION_TIMINGS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see we created two animations, one for fading in the image (<code class=\"language-text\">fade</code>) and the other one to slide up the content (<code class=\"language-text\">slideContent</code>). The fade animation will mostly be visible in combination with a spinner. Remember how we used the property binding to temporarily make the image invisible while loading? With the fade animation we can now replace our temporary solution with proper one that leverages the animation DSL.</p>\n<p>Next, we define an <code class=\"language-text\">animationState</code> property that represents the current animation state, e.g. <code class=\"language-text\">void</code>, <code class=\"language-text\">enter</code> or <code class=\"language-text\">leave</code>. By default it’s set to <code class=\"language-text\">enter</code> that will cause the content of the file preview to always slide up when it’s opened.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  animationState<span class=\"token punctuation\">:</span> <span class=\"token string\">'void'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'enter'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'leave'</span> <span class=\"token operator\">=</span> <span class=\"token string\">'enter'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we can connect the pieces and set it up in the template:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;div class=\"overlay-content\" [@slideContent]=\"animationState\">\n      &lt;div class=\"spinner-wrapper\" *ngIf=\"loading\">\n        &lt;mat-spinner>&lt;/mat-spinner>\n      &lt;/div>\n\n      &lt;img [@fade]=\"loading ? 'fadeOut' : 'fadeIn'\" (load)=\"onLoad($event)\" [src]=\"image.url\">\n    &lt;/div>\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We can see that the entire content, including the spinner as well as the image, is wrapped in a container <code class=\"language-text\">div</code>. That’s because we only want the content to slide up. Later we’ll introduce a toolbar component which comes with its own set of animations. This also implies that it wouldn’t make any sense to use a <code class=\"language-text\">@HostBinding()</code> and apply the animation to the host element.</p>\n<p>Done! Here’s a live demo with all the code above:</p>\n<iframe style=\"height: 500px\" src=\"https://stackblitz.com/edit/custom-overlay-step-8?embed=1&file=app/file-preview-overlay.component.ts&ctl=1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n<p>Animations guide our users and the overlay smoothly animates in. This is already much more engaging compared to what we had before but we can do even better. What about closing it? That’s right, we also want it to animate out.</p>\n<p>At the moment we simply call <code class=\"language-text\">this.overlayRef.dispose()</code> which will detach the portal from the host, eventually removing it from the DOM. With this straightforward approach there’s no way we can execute animations before it is disposed.</p>\n<p>What we can do instead is to leverage <strong>animation callbacks</strong> and introduce event streams that we can subscribe to. Angular provides animation callbacks that are fired when an animation is started and also when it is done.</p>\n<p>Let’s start with the animation callbacks and hook them in the template of our <code class=\"language-text\">FilePreviewOverlayComponent</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;div class=\"overlay-content\"\n      [@slideContent]=\"animationState\"\n      (@slideContent.start)=\"onAnimationStart($event)\"\n      (@slideContent.done)=\"onAnimationDone($event)\">\n      ...\n    &lt;/div>\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The animation callbacks alone are not very useful, at least not for animating the overlay out. What’s missing is an event bus that we can use to broadcast animation events. That’s needed because when we close an overlay, we have to wait until the <em>leaving</em> animation is done before we can dispose the overlay. We’ll see in just a second how to use this but first let’s define a new <code class=\"language-text\">EventEmitter</code> inside the overlay component class:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span> EventEmitter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  animationStateChanged <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EventEmitter</span><span class=\"token operator\">&lt;</span>AnimationEvent<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">EventEmitter</code> is an abstraction around a the <code class=\"language-text\">Subject</code> type from RxJS.</p>\n<p>Cool, now let’s wire up the animation callbacks. To do this, we’ll define the two missing methods <code class=\"language-text\">onAnimationStart()</code> and <code class=\"language-text\">onAnimationDone()</code>. Every time one of the animation callbacks is fired, we broadcast the animation event using <code class=\"language-text\">animationStateChanged</code>. Moreover, we need a way to start the <code class=\"language-text\">leave</code> animation once we close an overlay. Therefore we’ll also add a method called <code class=\"language-text\">startExitAnimation()</code> that sets the <code class=\"language-text\">animationState</code> to <code class=\"language-text\">leave</code>. This will then trigger the corresponding animation.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token function\">onAnimationStart</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">:</span> AnimationEvent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>animationStateChanged<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">onAnimationDone</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">:</span> AnimationEvent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>animationStateChanged<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">startExitAnimation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>animationState <span class=\"token operator\">=</span> <span class=\"token string\">'leave'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We know that we programatically close an overlay using the remote control aka <code class=\"language-text\">FilePreviewOverlayRef</code>. So far we have no access to the overlay component from within the <code class=\"language-text\">FilePreviewOverlayRef</code>. To fix this we define a property <code class=\"language-text\">componentInstance</code> on the remote control.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayRef</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  componentInstance<span class=\"token punctuation\">:</span> FilePreviewOverlayComponent<span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We simply set the <code class=\"language-text\">componentInstance</code> when an overlay is opened.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">:</span> FilePreviewDialogConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token comment\">// Instantiate remote control</span>\n    <span class=\"token keyword\">const</span> dialogRef <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FilePreviewOverlayRef</span><span class=\"token punctuation\">(</span>overlayRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> overlayComponent <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">attachDialogContainer</span><span class=\"token punctuation\">(</span>overlayRef<span class=\"token punctuation\">,</span> dialogConfig<span class=\"token punctuation\">,</span> dialogRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Pass the instance of the overlay component to the remote control</span>\n    dialogRef<span class=\"token punctuation\">.</span>componentInstance <span class=\"token operator\">=</span> overlayComponent<span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we can go ahead and introduce two event streams on the <code class=\"language-text\">FilePreviewOverlayRef</code>. The first one emits values <strong>before</strong> the overlay is closed and the other one <strong>after</strong> is was closed. For the streams we’ll use the <code class=\"language-text\">Subject</code> type from RxJS and also expose public methods for each of the event streams.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayRef</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">private</span> _beforeClose <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Subject</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">private</span> _afterClosed <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Subject</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token operator\">...</span>\n\n  <span class=\"token function\">afterClosed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Observable<span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_afterClosed<span class=\"token punctuation\">.</span><span class=\"token function\">asObservable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">beforeClose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Observable<span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_beforeClose<span class=\"token punctuation\">.</span><span class=\"token function\">asObservable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>From there we can use the component instance and subscribe to the animation events and act accordingly. This means that when an animation was started we detach the backdrop and call <code class=\"language-text\">next()</code> on <code class=\"language-text\">_beforeClose</code>. When an animation is finished we broadcast on <code class=\"language-text\">_afterClosed</code>. This also means we can dispose the overlay and remove it from the DOM.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> filter<span class=\"token punctuation\">,</span> take <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'rxjs/operators'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayRef</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Listen for animation 'start' events</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>componentInstance<span class=\"token punctuation\">.</span>animationStateChanged<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> event<span class=\"token punctuation\">.</span>phaseName <span class=\"token operator\">===</span> <span class=\"token string\">'start'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_beforeClose<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_beforeClose<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlayRef<span class=\"token punctuation\">.</span><span class=\"token function\">detachBackdrop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Listen for animation 'done' events</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>componentInstance<span class=\"token punctuation\">.</span>animationStateChanged<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> event<span class=\"token punctuation\">.</span>phaseName <span class=\"token operator\">===</span> <span class=\"token string\">'done'</span> <span class=\"token operator\">&amp;&amp;</span> event<span class=\"token punctuation\">.</span>toState <span class=\"token operator\">===</span> <span class=\"token string\">'leave'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlayRef<span class=\"token punctuation\">.</span><span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_afterClosed<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_afterClosed<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Make sure to also clear the reference to the</span>\n      <span class=\"token comment\">// component instance to avoid memory leaks</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>componentInstance <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Start exit animation</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>componentInstance<span class=\"token punctuation\">.</span><span class=\"token function\">startExitAnimation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That’s it. Here’s a live demo:</p>\n<iframe style=\"height: 500px\" src=\"https://stackblitz.com/edit/custom-overlay-step-9?embed=1&file=app/file-preview-overlay-ref.ts&ctl=1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n<h2>Adding a toolbar component</h2>\n<p>To finish this up we will create a toolbar component, add animations and also make use of the events streams exposed by the remote control to animate the toolbar out <strong>before</strong> the overlay is closed.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token punctuation\">:</span> <span class=\"token string\">'tm-file-preview-overlay-toolbar'</span><span class=\"token punctuation\">,</span>\n  templateUrl<span class=\"token punctuation\">:</span> <span class=\"token string\">'./file-preview-overlay-toolbar.component.html'</span><span class=\"token punctuation\">,</span>\n  styleUrls<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'./file-preview-overlay-toolbar.component.scss'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  animations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'slideDown'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token string\">'void'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> transform<span class=\"token punctuation\">:</span> <span class=\"token string\">'translateY(-100%)'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token string\">'enter'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> transform<span class=\"token punctuation\">:</span> <span class=\"token string\">'translateY(0)'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token string\">'leave'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> transform<span class=\"token punctuation\">:</span> <span class=\"token string\">'translateY(-100%)'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">transition</span><span class=\"token punctuation\">(</span><span class=\"token string\">'* => *'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'400ms cubic-bezier(0.25, 0.8, 0.25, 1)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayToolbarComponent</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">OnInit</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// Apply animation to the host element</span>\n  @<span class=\"token function\">HostBinding</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@slideDown'</span><span class=\"token punctuation\">)</span> slideDown <span class=\"token operator\">=</span> <span class=\"token string\">'enter'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Inject remote control</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> dialogRef<span class=\"token punctuation\">:</span> FilePreviewOverlayRef</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">ngOnInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Animate toolbar out before overlay is closed</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dialogRef<span class=\"token punctuation\">.</span><span class=\"token function\">beforeClose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>slideDown <span class=\"token operator\">=</span> <span class=\"token string\">'leave'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The template is very straightforward and leverages content projection to project content into the template of the toolbar component.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- file-preview-overlay-toolbar.component.html --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>toolbar-wrapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ng-content</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ng-content</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Finally we have to use the toolbar inside the template of the overlay component:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;tm-file-preview-overlay-toolbar>\n      &lt;mat-icon>description&lt;/mat-icon>\n      {{ image.name }}\n    &lt;/tm-file-preview-overlay-toolbar>\n\n    &lt;div class=\"overlay-content\"\n      ...\n    &lt;/div>\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That’s pretty much! Let’s have a look at our final solution:</p>\n<iframe style=\"height: 500px\" src=\"https://stackblitz.com/edit/custom-overlay-step-10?embed=1&file=app/file-preview-overlay.component.ts&ctl=1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>","frontmatter":{"author":"dominic_elm","title":"Custom Overlays with Angular's CDK - Part 2","imageUrl":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAGbBmGUUj//xAAYEAADAQEAAAAAAAAAAAAAAAABAhIiIf/aAAgBAQABBQKczwjquYrLHX//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAACAwAAAAAAAAAAAAAAAAABEAARcf/aAAgBAQAGPwIayJS//8QAGxAAAgMBAQEAAAAAAAAAAAAAAAERITFRQZH/2gAIAQEAAT8hVhKtfC6QLwMdHo4RLCRn0//aAAwDAQACAAMAAAAQQz//xAAWEQADAAAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8QqHT/xAAWEQADAAAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QkYj/xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhUTFB8KH/2gAIAQEAAT8QsMmIc4sn0lHEvFB35Jc4GzTqAGhBWnrY9RCH4tVtbn//2Q==","aspectRatio":1.4998366546880104,"src":"/static/57fc7daee845f1ca729c21982ddbde98/30037/custom_overlays_2.jpg","srcSet":"/static/57fc7daee845f1ca729c21982ddbde98/10bdc/custom_overlays_2.jpg 158w,\n/static/57fc7daee845f1ca729c21982ddbde98/f4ab0/custom_overlays_2.jpg 315w,\n/static/57fc7daee845f1ca729c21982ddbde98/30037/custom_overlays_2.jpg 630w,\n/static/57fc7daee845f1ca729c21982ddbde98/9810d/custom_overlays_2.jpg 945w,\n/static/57fc7daee845f1ca729c21982ddbde98/ff2e4/custom_overlays_2.jpg 1260w,\n/static/57fc7daee845f1ca729c21982ddbde98/ba972/custom_overlays_2.jpg 4591w","sizes":"(max-width: 630px) 100vw, 630px"}}},"date":"27 November 2017","summary":"In this follow-up post we demonstrate how to use Angular's CDK to build a custom overlay that looks and feels much like the Google Drive file preview overlay. We'll pick up from where we left off and implement keyboard support, image preloading and add animations in order to make our overlay more engaging.","categories":["angular"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/angular/2017/11/27/custom-overlays-with-angulars-cdk-part-two.html","previous":{"fields":{"slug":"/angular/2017/11/20/custom-overlays-with-angulars-cdk.html"},"frontmatter":{"date":"2017/11/20","title":"Custom Overlays with Angular's CDK","categories":["angular"]}},"next":{"fields":{"slug":"/announcements/machine-learning/2017/12/20/machine-learning-jump-start-online-course.html"},"frontmatter":{"date":"2017/12/20","title":"Machine Learning Jump Start - Online Course","categories":["announcements","machine-learning"]}}}}}