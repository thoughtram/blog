{"componentChunkName":"component---src-templates-blog-post-js","path":"/angular/2017/11/20/custom-overlays-with-angulars-cdk.html","webpackCompilationHash":"0c5d630095500f933ccd","result":{"data":{"site":{"siteMetadata":{"title":"Articles by thoughtram","authors":[{"id":"pascal_precht","name":"Pascal Precht","twitter":"PascalPrecht","img":"https://avatars2.githubusercontent.com/u/445106?s=460&v=4"},{"id":"christoph_burgdorf","name":"Christoph Burgdorf","twitter":"cburgdorf","img":"https://avatars0.githubusercontent.com/u/521109?s=460&v=4"},{"id":"dominic_elm","name":"Dominic Elm","twitter":"d3lm","img":"https://avatars0.githubusercontent.com/u/12571019?s=400&v=4"},{"id":"thomas_burleson","name":"Thomas Burleson","twitter":"thomasburleson","img":"https://avatars3.githubusercontent.com/u/210413?s=400&v=4"},{"id":"elvira_eulitz","name":"Elvira Eulitz","twitter":"ElviraEulitz","img":"https://avatars3.githubusercontent.com/u/29247040?s=400&v=4"},{"id":"maxim_koretskyi","name":"Maxim Koretskyi","twitter":"maxim_koretskyi","img":"https://avatars3.githubusercontent.com/u/6124091?s=400&v=4"}]}},"markdownRemark":{"id":"60966b70-a1ae-5cae-88a4-af6f3a4ed0b6","excerpt":"You have probably heared of Angular Material haven‚Äôt you? If you haven‚Äôt, it‚Äôs a library that provides you with high-quality Material Design components for‚Ä¶","html":"<p>You have probably heared of <a href=\"https://material.angular.io/\">Angular Material</a> haven‚Äôt you? If you haven‚Äôt, it‚Äôs a library that provides you with high-quality Material Design components for Angular. Material Design itself is a visual design language that aims for consistency of user experience across all platforms and device sizes. That‚Äôs cool but what if your company has its own opinions about styles and the overall look and feel of the UI? How do we get the best of Angular Material without adopting the Material Design visual language?</p>\n<p>Tada üéâ! That‚Äôs where Angular Material‚Äôs Component Dev Kit (CDK for short) comes into play. The CDK provides us with tools to build awesome and high-quality Angular components without adopting the Material Design visual language. Its goal is to make our life as developers easier and extract common behaviors and patterns shared between multiple Angular Material components. For instance, the datepicker, snackbar, or tooltip have something in common; they need to dynamically open up some floating panel on the screen. But that‚Äôs just the tip of the ice berg. There are many different packages for all sorts of things such as <code class=\"language-text\">a11y</code> that helps us improve the accessibility of our UI components. There‚Äôs even a <code class=\"language-text\">layout</code> package with utilities to build responsive UIs that react to screen-size changes. For a more complete list, please check out the official <a href=\"https://material.angular.io/cdk/categories/component-composition\">documentation</a>.</p>\n<p>Over at <a href=\"https://www.machinelabs.ai\">MachineLabs</a>, we thought it would be useful to provide a way to preview generated output files (mostly images), so users don‚Äôt have to download it every single time just to take a quick look. So we sat down to build a Google Drive like overlay with the CDK. This post is meant to share our knowledge with the community and to make you comfortable using the CDK for your own purposes.</p>\n<p>In this post, we‚Äôll use the CDK to build a Google Drive-like custom overlay that looks and feels much like the one built for <a href=\"https://machinelabs.ai/editor/rJQrQ5wjZ/1506415557004-HkTTQ5Dob?file=ml.yaml&#x26;tab=outputs&#x26;preview=-KuyslgjIn7kSpuc6pDZ\">MachineLabs</a>. Here‚Äôs how it looks like:</p>\n<p><img src=\"/8b38e48e2375ae32088cc955d25ef223/overlay_preview.gif\" alt=\"overlay preview\"></p>\n<h2>The building blocks</h2>\n<p>Let‚Äôs start simple and work our way up to the final, fully-fledged solution which will have a very similar API as the <code class=\"language-text\">MatDialog</code> service provided by Angular Material. It‚Äôs not important to know exactly how the <code class=\"language-text\">MatDialog</code> works but it‚Äôs definitely helpful. If this is new to you, we recommend to check out our post on <a href=\"/angular/2017/11/13/easy-dialogs-with-angular-material.html\">Easy Dialogs with Angular Material</a>.</p>\n<p>Our solution will be a little less flexible but specifically made for showing a file preview inspired by Google Drive. That said, we‚Äôd like to have a nice toolbar at the top and the image being rendered in the middle of the screen.</p>\n<p>In general, the <code class=\"language-text\">MatDialog</code> is great for showing content in a dialog box but as soon as we want a little bit of a custom look and feel, something that does not look like a white box with content inside, we would need to roll our own overlay. Luckily, we can use the <code class=\"language-text\">overlay</code> package from the CDK that has most of the core logic for opening floating panels already baked in. More on that in just a second.</p>\n<p>Here are the core building blocks of our application:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d24fe3da67b214dcf1448cdfb69d571/32fff/custom_overlays_architecture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.89400116482236%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQoz01R2ZKDIBD0/39uK7tRUx7RMqVxDQrIIQoh25ijtouHsZlmptso3yGl3N6w1q7rqqQUQoBH7Z6w1lncfhq3iFKaZVlRFLs+yIBZiKwoT3mWV+VIJ8Y4nSYqNFvu3Dh3fyEaxxHKsiy7rlu00kqBIWQcKducNXe3bCvnTGstcWlW5x8fRPM813V9/AlIzpeiasjtBlIpta1BJrXZrEMrRmFlFGofECaj6vv++3A4HuOv7BJnZylmY0xVVbCTpmnbtdY5OCTkhk7sj9dPaQp3EaxCD+eMMcoFZdyYBUCKECdJ0l+vCAnR5WUNe+3wOynJg0Mdoc+9I3h4j4NP5IzJcRw3TYMtkDubRSv9YoPjp2ukEOHHfALACpiA53AxDEPbtpxz8HaH96+QfTgeTEQIQTx8xzRNSAIFLJCQOGIPAP8k/wPMH0nd/DB1WM7xAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"custom overlays architecture\"\n        title=\"custom overlays architecture\"\n        src=\"/static/3d24fe3da67b214dcf1448cdfb69d571/8ff1e/custom_overlays_architecture.png\"\n        srcset=\"/static/3d24fe3da67b214dcf1448cdfb69d571/9ec3c/custom_overlays_architecture.png 200w,\n/static/3d24fe3da67b214dcf1448cdfb69d571/c7805/custom_overlays_architecture.png 400w,\n/static/3d24fe3da67b214dcf1448cdfb69d571/8ff1e/custom_overlays_architecture.png 800w,\n/static/3d24fe3da67b214dcf1448cdfb69d571/6ff5e/custom_overlays_architecture.png 1200w,\n/static/3d24fe3da67b214dcf1448cdfb69d571/2f950/custom_overlays_architecture.png 1600w,\n/static/3d24fe3da67b214dcf1448cdfb69d571/32fff/custom_overlays_architecture.png 3434w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As we can see, we have two components, one service and a class that represents a remote control to an opened overlay. The <code class=\"language-text\">AppComponent</code> is the root (or entry point) of our application. This component contains a toolbar and the list of files that we can preview. In addition, it has access to a <code class=\"language-text\">FilePreviewOverlayService</code> which provides us with the core logic for opening an overlay. At the same time it‚Äôs an abstraction for some ‚Äúheavy‚Äù lifting that should be implemented in a resuable manner. Don‚Äôt be scared, it‚Äôs not going to be super heavy and we‚Äôll break it down into comprehensible chunks. Last but not least, there‚Äôs a <code class=\"language-text\">FilePreviewOverlayRef</code> which, as mentioned, is a <em>handle</em> used to control (e.g. close) a particular overlay.</p>\n<p>For the overlay we choose to render a component, so we can attach some logic and also add animations to our overlay to engage our users and make them happy. We call this component <code class=\"language-text\">FilePreviewOverlayComponent</code>.</p>\n<p>That‚Äôs about it. Now that we have the basic structure in place, we‚Äôre ready to look at some code.</p>\n<p><strong>Note that this post is the first part out of two in which we lay the foundation for our custom overlay. We‚Äôll build on top of this in the next part and add keyboard support, image preloading and animations.</strong></p>\n<h2>Setup</h2>\n<p>Before we can start implementing the custom overlay we need to install the CDK. Simply run <code class=\"language-text\">npm install @angular/cdk</code> and we‚Äôre all set!</p>\n<h2>Our first overlay</h2>\n<p>From the <code class=\"language-text\">MatDialog</code> we know that when we open an overlay we must specify a component type that is then created dynamically at runtime. This means it is not created by using the component tags inside an HTML template. Also, we know that whenever a component is created at runtime, we <strong>must add it to our application module‚Äôs <code class=\"language-text\">entryComponents</code></strong>.</p>\n<p>Let‚Äôs do that and add the <code class=\"language-text\">FilePreviewOverlayComponent</code> to the array of <code class=\"language-text\">entryComponents</code>. In addition, we need to add the <code class=\"language-text\">OverlayModule</code> to the <code class=\"language-text\">imports</code> list of the root <code class=\"language-text\">AppModule</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> OverlayModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/cdk/overlay'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  declarations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span> FilePreviewOverlayComponent <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  bootstrap<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> AppComponent <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  providers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  entryComponents<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// Needs to be added here because otherwise we can't</span>\n    <span class=\"token comment\">// dynamically render this component at runtime</span>\n    FilePreviewOverlayComponent\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>From there, creating an overlay is easy. First, we inject the <code class=\"language-text\">Overlay</code> service. This service has a <code class=\"language-text\">create()</code> function that we need to call in order to create a <code class=\"language-text\">PortalHost</code> for our <code class=\"language-text\">FilePreviewOverlayComponent</code>. Finally we need to create a <code class=\"language-text\">ComponentPortal</code> from this component and attach it to the <code class=\"language-text\">PortalHost</code>. Wait, what? Let‚Äôs give it a moment and look at some code before taking it apart:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// Inject overlay service</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> overlay<span class=\"token punctuation\">:</span> Overlay</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Returns an OverlayRef (which is a PortalHost)</span>\n    <span class=\"token keyword\">const</span> overlayRef <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlay<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Create ComponentPortal that can be attached to a PortalHost</span>\n    <span class=\"token keyword\">const</span> filePreviewPortal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ComponentPortal</span><span class=\"token punctuation\">(</span>FilePreviewOverlayComponent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Attach ComponentPortal to PortalHost</span>\n    overlayRef<span class=\"token punctuation\">.</span><span class=\"token function\">attach</span><span class=\"token punctuation\">(</span>filePreviewPortal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The first step is to create a <code class=\"language-text\">PortalHost</code>. We do that by calling <code class=\"language-text\">create()</code> on the <code class=\"language-text\">Overlay</code> service. This will return an <code class=\"language-text\">OverlayRef</code> instance which is basically a remote control for the overlay. One unique attribute of this <code class=\"language-text\">OverlayRef</code> is that it‚Äôs a <code class=\"language-text\">PortalHost</code>, and once created, we can attach or detach <code class=\"language-text\">Portal</code>s. We can think of a <code class=\"language-text\">PortalHost</code> as a placeholder for a component or template. So in our scenario, we are creating a <code class=\"language-text\">ComponentPortal</code> that takes a component type as its fist argument. In order to actually display this component we need to attach the portal to the host.</p>\n<blockquote>\n<p>Ok, but where does the overlay get rendered?</p>\n</blockquote>\n<p>Good question. There‚Äôs an <code class=\"language-text\">OverlayContainer</code> service which creates a container <code class=\"language-text\">div</code> under the hood that gets appended to the <code class=\"language-text\">body</code> of the HTML Document. There are a few more wrapper elements created but our component eventually ends up in a <code class=\"language-text\">div</code> with a class of <code class=\"language-text\">cdk-overlay-pane</code>. Here‚Äôs what the DOM structure looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>cdk-overlay-container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>cdk-overlay-0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>cdk-overlay-pane<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dir</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>ltr<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- Component goes here --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Done. That‚Äôs all we need to create our very first custom overlay using the CDK. Let‚Äôs try it out and see what we got so far:</p>\n<iframe style=\"height: 500px\" src=\"https://stackblitz.com/edit/custom-overlay-step-1?embed=1&file=app/file-preview-overlay.service.ts&ctl=1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n<p>Our service only exposes <strong>one</strong> public method <code class=\"language-text\">open()</code> that will take care of creating a custom overlay. For now, the service is quite simple but it gets more complicated as we implement a more sophisticated and complete (functional-wise) overlay. Therefore it‚Äôs a good idea to extract the common logic into a service to stay <strong>DRY</strong>. Imagine we would have the same logic defined in each component we want to show an overlay. No good, right?</p>\n<p>Now that we have layed the foundation for our custom overlay, let‚Äôs take it one step further and improve on what we have so far. Let‚Äôs add a backdrop and specify a scroll and position strategy. Don‚Äôt worry if it‚Äôs unclear what scroll and position strategy is all about. We‚Äôll cover that in a second.</p>\n<h2>Configuring the overlay</h2>\n<p>When creating an overlay, we can pass an optional configuration object to <code class=\"language-text\">create()</code> to set the desired options, e.g. whether it has backdrop, the position or scroll strategy, width, height and many more. Here‚Äôs an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Example configuration</span>\noverlay<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  width<span class=\"token punctuation\">:</span> <span class=\"token string\">'400px'</span><span class=\"token punctuation\">,</span>\n  height<span class=\"token punctuation\">:</span> <span class=\"token string\">'600px'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>First of all, we allow the consumer of our API to override certain options. Therefore, we update the signature for <code class=\"language-text\">open()</code> to also take a configuration object. In addition, we define an interface that describes the shape of the configuration from a consumer perspective:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Each property can be overridden by the consumer</span>\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">FilePreviewDialogConfig</span> <span class=\"token punctuation\">{</span>\n  panelClass<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">;</span>\n  hasBackdrop<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> boolean<span class=\"token punctuation\">;</span>\n  backdropClass<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">:</span> FilePreviewDialogConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next, we define some initial values for the config, so that, by default, every overlay has a backdrop alongside a <code class=\"language-text\">backdropClass</code> and <code class=\"language-text\">panelClass</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">DEFAULT_CONFIG</span><span class=\"token punctuation\">:</span> FilePreviewDialogConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  hasBackdrop<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  backdropClass<span class=\"token punctuation\">:</span> <span class=\"token string\">'dark-backdrop'</span><span class=\"token punctuation\">,</span>\n  panelClass<span class=\"token punctuation\">:</span> <span class=\"token string\">'tm-file-preview-dialog-panel'</span>\n<span class=\"token punctuation\">}</span>\n\n@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With that in place, we can define a new method <code class=\"language-text\">getOverlayConfig()</code> which takes care of creating a new <code class=\"language-text\">OverlayConfig</code> for the custom overlay. Remember, it‚Äôs better to break down the logic into smaller parts instead of implementing everything in one giant function. This ensures better maintainability but also readability of our code.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token operator\">...</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">getOverlayConfig</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">:</span> FilePreviewDialogConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> OverlayConfig <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> positionStrategy <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlay<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">global</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">centerHorizontally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">centerVertically</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> overlayConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OverlayConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      hasBackdrop<span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">.</span>hasBackdrop<span class=\"token punctuation\">,</span>\n      backdropClass<span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">.</span>backdropClass<span class=\"token punctuation\">,</span>\n      panelClass<span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">.</span>panelClass<span class=\"token punctuation\">,</span>\n      scrollStrategy<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlay<span class=\"token punctuation\">.</span>scrollStrategies<span class=\"token punctuation\">.</span><span class=\"token function\">block</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      positionStrategy\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> overlayConfig<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Our method is quite simple. It takes a <code class=\"language-text\">FilePreviewDialogConfig</code> and creates a new <code class=\"language-text\">OverlayConfig</code> with the values from the given configuration. However, there are two important things to mention. One is the <code class=\"language-text\">scrollStrategy</code> and the other one is the <code class=\"language-text\">positionStrategy</code>.</p>\n<h3>Scroll strategy</h3>\n<p>The scroll strategy is a way of defining how our overlay should behave if the user scrolls while the overlay is open. There are several strategies available as part of the CDK, such as</p>\n<ul>\n<li><code class=\"language-text\">NoopScrollStrategy</code>: does nothing</li>\n<li><code class=\"language-text\">CloseScrollStrategy</code>: automatically closes the overlay when scrolling</li>\n<li><code class=\"language-text\">BlockScrollStrategy</code>: blocks page scrolling</li>\n<li><code class=\"language-text\">RepositionScrollStrategy</code>: will reposition the overlay element on scroll</li>\n</ul>\n<p>For our file preview overlay, we are going to use the <code class=\"language-text\">BlockScrollStrategy</code> because we don‚Äôt want the user to be scrolling in the background while the overlay is open.</p>\n<p>The <code class=\"language-text\">scrollStrategy</code> takes a function that returns a scroll strategy. All strategies are provided by the <code class=\"language-text\">Overlay</code> service and can be accessed via the <code class=\"language-text\">scrollStrategies</code> property:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> overlayConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OverlayConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token comment\">// Other strategies are .noop(), .reposition(), or .close()</span>\n  scrollStrategy<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlay<span class=\"token punctuation\">.</span>scrollStrategies<span class=\"token punctuation\">.</span><span class=\"token function\">block</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If we don‚Äôt specify a strategy explicitly, all overlays will use the <code class=\"language-text\">NoopScrollStrategy</code>.</p>\n<h3>Position strategy</h3>\n<p>The position strategy allows us to configure how our overlay is positioned on the screen. There are two position strategies available as part of the CDK:</p>\n<ul>\n<li><code class=\"language-text\">GlobalPositionStrategy</code>: used for overlays that need to be positioned unrelated to other elements on the screen. This strategy is mostly used for modals or root-level notifications.</li>\n<li><code class=\"language-text\">ConnectedPositionStrategy</code>: used for overlays that are positioned relative to other elements. This is commonly used for menus or tooltips.</li>\n</ul>\n<p>We‚Äôll be using the <code class=\"language-text\">GlobalPositionStrategy</code> for our overlay because it‚Äôs supposed to be positioned globally on screen, unrelated to other elements.</p>\n<p>Similar to the <code class=\"language-text\">scrollStrategy</code> we can access all position strategies through the <code class=\"language-text\">Overlay</code> service like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> positionStrategy <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlay<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">global</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">centerHorizontally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">centerVertically</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> overlayConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OverlayConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  positionStrategy\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With the configuration in place, we go ahead and define another method <code class=\"language-text\">createOverlay()</code> that hides the complexity of creating an overlay with a given configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token keyword\">private</span> <span class=\"token function\">createOverlay</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">:</span> FilePreviewDialogConfig</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Returns an OverlayConfig</span>\n    <span class=\"token keyword\">const</span> overlayConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getOverlayConfig</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Returns an OverlayRef</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlay<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>overlayConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We now refactor our <code class=\"language-text\">open()</code> method to generate a default config and utilize <code class=\"language-text\">createOverlay()</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">:</span> FilePreviewDialogConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Override default configuration</span>\n    <span class=\"token keyword\">const</span> dialogConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span><span class=\"token constant\">DEFAULT_CONFIG</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>config <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> overlayRef <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createOverlay</span><span class=\"token punctuation\">(</span>dialogConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here‚Äôs what it looks like in action:</p>\n<iframe style=\"height: 500px\" src=\"https://stackblitz.com/edit/custom-overlay-step-2?embed=1&file=app/file-preview-overlay.service.ts&ctl=1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n<p>Our overlay looks much more like an overlay as we have imagined it in the beginning. The good thing is that most of the heavy lifting is taken care of by the CDK, such as dynamically creating a component, block page scrolling, or positioning.</p>\n<p>So far, so good, but we are still missing some very fundamental functionality. We can open an overlay but what about closing it? This it not yet possible, so let‚Äôs go ahead and add this feature.</p>\n<h2>Closing overlays with a remote control</h2>\n<p>Just like we use remote controls to snap between television channels, we want a remote control to close our overlays. It will provide an API for modifying, closing, and listening to events on the overlay instance. Especially if we want to be able to close the dialog from within the overlay component, and optionally return a value to the consumer.</p>\n<p>Our remote control will be a simple class that exposes only one public method - <code class=\"language-text\">close()</code>. For now we keep simple and extend it as we introduce more features. Here‚Äôs what it looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> OverlayRef <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/cdk/overlay'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayRef</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> overlayRef<span class=\"token punctuation\">:</span> OverlayRef</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlayRef<span class=\"token punctuation\">.</span><span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>When implementing the remote control, the only thing we have to make sure is that we need access to the <code class=\"language-text\">OverlayRef</code>. It‚Äôs a reference to the overlay (portal host) that allows us to detach the portal. Note that, there‚Äôs no <code class=\"language-text\">@Injectable</code> decorator attached to the class which means that we can‚Äôt leverage the DI system for this service. This, however, is no big deal because we will manually create an instance for every overlay and therefore we don‚Äôt need to register a provider either. Theoretically, we could open multiple overlays stacked on top of each other where each overlay has its own remote control. The DI system creates singletons by default. That‚Äôs not what we want in this case.</p>\n<p>What‚Äôs left to do is to update our <code class=\"language-text\">open()</code> method to create a remote control and return it to the consumer of our API:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">:</span> FilePreviewDialogConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token keyword\">const</span> overlayRef <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createOverlay</span><span class=\"token punctuation\">(</span>dialogConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Instantiate remote control</span>\n    <span class=\"token keyword\">const</span> dialogRef <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FilePreviewOverlayRef</span><span class=\"token punctuation\">(</span>overlayRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token comment\">// Return remote control</span>\n    <span class=\"token keyword\">return</span> dialogRef<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Notice how we pass in the <code class=\"language-text\">overlayRef</code> when creating a new <code class=\"language-text\">FilePreviewOverlayRef</code>? That‚Äôs how we get a hold of the <code class=\"language-text\">PortalHost</code> inside the remote. Instead of implementing a class that represents a reference to the open overlay, we could have returned the <code class=\"language-text\">OverlayRef</code> directly. However, it‚Äôs not a good idea to expose lower-level APIs because users could mess with the overlay and detach the backdrop for instance. Also, we need a little bit more logic later on when we introduce animations. A remote control is a good way of limiting the access to the underlying APIs and expose only those that we want to be publicly available.</p>\n<p>From a consumer perspective we now get a handle to the overlay that allows us to programatically close it at some point. Let‚Äôs go ahead and update <code class=\"language-text\">AppComponent</code> accordingly:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppComponent</span>  <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token function\">showPreview</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Returns a handle to the open overlay</span>\n    <span class=\"token keyword\">let</span> dialogRef<span class=\"token punctuation\">:</span> FilePreviewOverlayRef <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>previewDialog<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Close overlay after 2 seconds</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      dialogRef<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here‚Äôs our code in action. Remember, once we open an overlay it will automatically close after 2 seconds:</p>\n<iframe style=\"height: 500px\" src=\"https://stackblitz.com/edit/custom-overlay-step-3?embed=1&file=app/file-preview-overlay.service.ts&ctl=1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n<p>Awesome! We are making serious progress and it‚Äôs not far until we reach the top of the mountain.</p>\n<h2>Improving ergonomics</h2>\n<p>In the previous sections we have mainly improved the overlay under the hood and layed a foundation for upcoming features. In this section we want to focus on improving the overlay‚Äôs ergonomics. This means that we want to be able to close the dialog when we click on the backdrop.</p>\n<p>Turns out that the backdrop logic is extremely easy with the CDK. All we have to do is to subscribe to a stream that emits a value when the backdrop was clicked:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">:</span> FilePreviewDialogConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token comment\">// Subscribe to a stream that emits when the backdrop was clicked</span>\n    overlayRef<span class=\"token punctuation\">.</span><span class=\"token function\">backdropClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_</span> <span class=\"token operator\">=></span> dialogRef<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> dialogRef<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That‚Äôs it! Imagine how much work this would be without the CDK.</p>\n<iframe style=\"height: 500px\" src=\"https://stackblitz.com/edit/custom-overlay-step-4?embed=1&file=app/file-preview-overlay.service.ts&ctl=1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n<p>From here we could take it one step further and also close the overlay when a user naviagtes back in the browser history. For our application, however, this doesn‚Äôt make much sense because we are not using the router and there‚Äôs only one page that we render out to the screen. But feel free to give it a shot! Hint: use the <code class=\"language-text\">Location</code> service and subscribe to the browser‚Äôs <code class=\"language-text\">popState</code> events.</p>\n<h2>Sharing data with the overlay component</h2>\n<p>The goal of this post was to implement a <strong>generic</strong> file preview dialog rather than a static one. At the moment the overlay is quite static and there‚Äôs no way we can share data with the overlay component. Sharing data means we want to be able to provide an image that will be available within the component. After all it‚Äôs supposed to be a file preview. Therefore, we need to think about how we can <strong>share</strong> data with the component that is dynamically created.</p>\n<p>Luckily, Angular has a hierarchical dependency injection system (DI for short) that we can leverage for our purpose. For more information on Angular‚Äôs DI system, check out <a href=\"/angular/2015/05/18/dependency-injection-in-angular-2\">this</a> post.</p>\n<p>In a nutshell, the DI system is flexible enough that we can reconfigure the injectors at any level of the component tree. That said, there is no such thing as <em>the injector</em>. An application may have multiple injectors and each component instance has its own injector. You hear the bells ring? Right, we can create our own <strong>custom injector</strong> and provide it with a list of <strong>custom injection tokens</strong>. It sounds more complicated than it actually is.</p>\n<p>Turns out, the CDK already has a class <code class=\"language-text\">PortalInjector</code> that that we can use to provide custom injection tokens to components inside a portal. This is exactly what we need. Let‚Äôs break ground and implement a function <code class=\"language-text\">createInjector()</code> that creates a new <code class=\"language-text\">PortalInjector</code> and defines a list of custom injection tokens.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token keyword\">private</span> <span class=\"token function\">createInjector</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">:</span> FilePreviewDialogConfig<span class=\"token punctuation\">,</span> dialogRef<span class=\"token punctuation\">:</span> FilePreviewOverlayRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> PortalInjector <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Instantiate new WeakMap for our custom injection tokens</span>\n    <span class=\"token keyword\">const</span> injectionTokens <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WeakMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Set custom injection tokens</span>\n    injectionTokens<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>FilePreviewOverlayRef<span class=\"token punctuation\">,</span> dialogRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    injectionTokens<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token constant\">FILE_PREVIEW_DIALOG_DATA</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Instantiate new PortalInjector</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PortalInjector</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>injector<span class=\"token punctuation\">,</span> injectionTokens<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>In the code above we create a new <code class=\"language-text\">WeakMap</code>, set our custom injection tokens that we want to be available (injectable) in the overlay component, and finally instantiate a new <code class=\"language-text\">PortalInjector</code>. The important part though is that we also specify a parent injector (first argument) which is mandatory. Also notice the second argument where we pass in our injection tokens.</p>\n<p>There are two things that we are providing. The first token is the <code class=\"language-text\">FilePreviewDialogRef</code>. Having the remote control at hand, allows the overlay component to close itself. This is very useful because there will definitely be a close button somewhere. The second token is a custom <code class=\"language-text\">InjectionToken</code> that stores the data that we want to share with the component.</p>\n<p>For the <code class=\"language-text\">InjectionToken</code> we create new file <code class=\"language-text\">file-preview-overlay.tokens</code> and instantiate a new <code class=\"language-text\">InjectionToken</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> InjectionToken <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Image <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./file-preview-overlay.service'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">FILE_PREVIEW_DIALOG_DATA</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InjectionToken</span><span class=\"token operator\">&lt;</span>Image<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token string\">'FILE_PREVIEW_DIALOG_DATA'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Next, let‚Äôs update our <code class=\"language-text\">FilePreviewDialogConfig</code> so that the user can specify an image that will be used by the overlay component:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Image</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">;</span>\n  url<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">FilePreviewDialogConfig</span> <span class=\"token punctuation\">{</span>\n  panelClass<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">;</span>\n  hasBackdrop<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> boolean<span class=\"token punctuation\">;</span>\n  backdropClass<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">;</span>\n  data<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> Image<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>For better readability we‚Äôll also refactor our <code class=\"language-text\">open()</code> method and create a new <code class=\"language-text\">attachDialogContainer()</code> function that now takes care of creating the injector and component portal, as well as attaching the portal to the host.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token keyword\">private</span> <span class=\"token function\">attachDialogContainer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">overlayRef<span class=\"token punctuation\">:</span> OverlayRef<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">:</span> FilePreviewDialogConfig<span class=\"token punctuation\">,</span> dialogRef<span class=\"token punctuation\">:</span> FilePreviewOverlayRef</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> injector <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createInjector</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> dialogRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> containerPortal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ComponentPortal</span><span class=\"token punctuation\">(</span>FilePreviewOverlayComponent<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> injector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> containerRef<span class=\"token punctuation\">:</span> ComponentRef<span class=\"token operator\">&lt;</span>FilePreviewOverlayComponent<span class=\"token operator\">></span> <span class=\"token operator\">=</span> overlayRef<span class=\"token punctuation\">.</span><span class=\"token function\">attach</span><span class=\"token punctuation\">(</span>containerPortal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> containerRef<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With that in place, we can now update our <code class=\"language-text\">FilePreviewOverlayComponent</code> and inject the tokens that we have defined on a component level with the help of a custom injector.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilePreviewOverlayComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\"><span class=\"token keyword\">public</span> dialogRef<span class=\"token punctuation\">:</span> FilePreviewOverlayRef<span class=\"token punctuation\">,</span>\n    @<span class=\"token function\">Inject</span><span class=\"token punctuation\">(</span><span class=\"token constant\">FILE_PREVIEW_DIALOG_DATA</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> image<span class=\"token punctuation\">:</span> any</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We can now define data that will be passed to the overlay component and render an image onto the screen. Here‚Äôs an example of how we can pass in data:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppComponent</span>  <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token function\">showPreview</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> dialogRef<span class=\"token punctuation\">:</span> FilePreviewOverlayRef <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>previewDialog<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      image<span class=\"token punctuation\">:</span> file\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Finally with a little bit of styling we come much closer to what we‚Äôre trying to achieve.</p>\n<iframe style=\"height: 500px\" src=\"https://stackblitz.com/edit/custom-overlay-step-5?embed=1&file=app/file-preview-overlay.service.ts&ctl=1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n<h2>Where to go from here</h2>\n<p>This is it. Although creating custom overlays is something that‚Äôs more or less tricky to do, this task becomes rather easy with UI libraries like Angular Material that provide us with a common set of tools to build awesome and high-quality Angular components. More specifically, by extracting common behaviors and patterns into a so called Component Dev Kit, it becomes extremely easy to build a custom overlay.</p>\n<p>Where to go from here? As mentioned in the beginning, this was only part one and we haven‚Äôt fully re-built the Google Drive-like file preview yet. In the <a href=\"/angular/2017/11/27/custom-overlays-with-angulars-cdk-part-two.html\">next post</a> we will build on top of this and implement keyboard support, image preloading and add animations in order to make our overlay more engaging.</p>","frontmatter":{"author":"dominic_elm","title":"Custom Overlays with Angular's CDK","imageUrl":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBBP/EABUBAQEAAAAAAAAAAAAAAAAAAAED/9oADAMBAAIQAxAAAAGvHTZUkB//xAAYEAEAAwEAAAAAAAAAAAAAAAABAAIREv/aAAgBAQABBQLWDdmTpG1nK3ef/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AW1//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BR//EABkQAAMAAwAAAAAAAAAAAAAAAAABEBEhMf/aAAgBAQAGPwJ4NxnZ/8QAGRABAQEBAQEAAAAAAAAAAAAAAREAQTFR/9oACAEBAAE/IaFazvcjCAfBxXNRC08zYU6Vv//aAAwDAQACAAMAAAAQR9//xAAYEQACAwAAAAAAAAAAAAAAAAAAEQEhUf/aAAgBAwEBPxC24MD/xAAZEQADAAMAAAAAAAAAAAAAAAAAAREhMVH/2gAIAQIBAT8Qqynsjp//xAAbEAEBAQEAAwEAAAAAAAAAAAABESEAMVFxof/aAAgBAQABPxBHphppBbm8811iX0b86K0q1VDeQsSUPi9QO9rtnn96wpXWHf/Z","aspectRatio":1.4981273408239701,"src":"/static/d7d23e8392a180b13e3f54495f9752c3/30037/custom_overlays.jpg","srcSet":"/static/d7d23e8392a180b13e3f54495f9752c3/10bdc/custom_overlays.jpg 158w,\n/static/d7d23e8392a180b13e3f54495f9752c3/f4ab0/custom_overlays.jpg 315w,\n/static/d7d23e8392a180b13e3f54495f9752c3/30037/custom_overlays.jpg 630w,\n/static/d7d23e8392a180b13e3f54495f9752c3/9810d/custom_overlays.jpg 945w,\n/static/d7d23e8392a180b13e3f54495f9752c3/ff2e4/custom_overlays.jpg 1260w,\n/static/d7d23e8392a180b13e3f54495f9752c3/989b1/custom_overlays.jpg 1600w","sizes":"(max-width: 630px) 100vw, 630px"}}},"date":"20 November 2017","summary":"The Angular Material CDK provides us with tools to build awesome and high-quality Angular components without adopting the Material Design visual language. Its goal is to make our life as developers easier and extract common behaviors and patterns shared between multiple Angular Material components. In this post, we'll use the CDK to build a custom overlay that looks and feels much like the Google Drive file preview overlay.","categories":["angular"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/angular/2017/11/20/custom-overlays-with-angulars-cdk.html","previous":{"fields":{"slug":"/angular/2017/11/13/easy-dialogs-with-angular-material.html"},"frontmatter":{"date":"2017/11/13","title":"Easy Dialogs with Angular Material","categories":["angular"]}},"next":{"fields":{"slug":"/angular/2017/11/27/custom-overlays-with-angulars-cdk-part-two.html"},"frontmatter":{"date":"2017/11/27","title":"Custom Overlays with Angular's CDK - Part 2","categories":["angular"]}}}}}