{"componentChunkName":"component---src-templates-blog-post-js","path":"/angular/2017/02/21/using-zones-in-angular-for-better-performance.html","webpackCompilationHash":"0c5d630095500f933ccd","result":{"data":{"site":{"siteMetadata":{"title":"Articles by thoughtram","authors":[{"id":"pascal_precht","name":"Pascal Precht","twitter":"PascalPrecht","img":"https://avatars2.githubusercontent.com/u/445106?s=460&v=4"},{"id":"christoph_burgdorf","name":"Christoph Burgdorf","twitter":"cburgdorf","img":"https://avatars0.githubusercontent.com/u/521109?s=460&v=4"},{"id":"dominic_elm","name":"Dominic Elm","twitter":"d3lm","img":"https://avatars0.githubusercontent.com/u/12571019?s=400&v=4"},{"id":"thomas_burleson","name":"Thomas Burleson","twitter":"thomasburleson","img":"https://avatars3.githubusercontent.com/u/210413?s=400&v=4"},{"id":"elvira_eulitz","name":"Elvira Eulitz","twitter":"ElviraEulitz","img":"https://avatars3.githubusercontent.com/u/29247040?s=400&v=4"},{"id":"maxim_koretskyi","name":"Maxim Koretskyi","twitter":"maxim_koretskyi","img":"https://avatars3.githubusercontent.com/u/6124091?s=400&v=4"}]}},"markdownRemark":{"id":"abe7f2c6-bf0e-5fa5-8f51-a4bd1cca5fc8","excerpt":"In our latest article, we talked about how to make our Angular apps fast by exploring Angular’s  APIs as well as tricks on how to detach change detectors and…","html":"<p>In our latest article, we talked about <a href=\"/angular/2017/02/02/making-your-angular-app-fast.html\">how to make our Angular apps fast</a> by exploring Angular’s <code class=\"language-text\">ChangeDetectionStrategy</code> APIs as well as tricks on how to detach change detectors and many more. While we were covering many different options to improve the demo application’s performance, we certainly haven’t talked about <strong>all</strong> possible options.</p>\n<p>That’s why <a href=\"https://twitter.com/galigan\">Jordi Collell</a> pointed out that another option would be to take advantage of <a href=\"/angular/2016/02/01/zones-in-angular-2.html\">Zone APIs</a>, to execute our code outside the Angular zone, which will prevent Angular from running unnecessary change detection tasks. He even put time and energy into creating a demo plunk that shows how to do exactly that.</p>\n<p><strong>We want to say thank you for his contribution</strong> and think that the solution he came up with deserves its own article. So in this article we’re going to explore his plunk and explain how Jordi used Zones to make our demo application perform at almost 60 fps.</p>\n<h2>Seeing it in action</h2>\n<p>Before we jump right into the code, let’s first take a look at the demo plunk with the running application. As a quick recap: The idea was to render 10.000 draggable SVG boxes. Rendering 10.000 boxes is not a super sophisticated task, however, the challenge lies in making the dragging experience as smooth as possible. In other words, we aim for 60 fps (frames per second), which can be indeed challenging, considering that Angular re-renders all 10.000 boxes by default when an event has fired (that we bound to).</p>\n<p>Even though the difference is rather subtle, the optimized version performs much better in terms of JavaScript execution per frame. We’ll take a look at some numbers later, but let’s quickly recap Zones and then dive into the code and discuss how Jordi used Angular’s <code class=\"language-text\">NgZone</code> APIs to achieve this performance first.</p>\n<h2>The idea of Zones</h2>\n<p>Before we can use Zone APIs and specifically the ones from Angular’s <code class=\"language-text\">NgZone</code>, we need to get an understanding of what Zones actually are and how they are useful in the Angular world. We won’t go into too much detail here as we’ve already written two articles on this topic:</p>\n<ul>\n<li><strong><a href=\"/angular/2016/01/22/understanding-zones.html\">Understanding Zones</a></strong> - Discusses the concept of Zones in general and how they can be used to e.g. profile asynchronous code execution</li>\n<li><strong><a href=\"/angular/2016/02/01/zones-in-angular-2.html\">Zones in Angular</a></strong> - Explores how the underlying Zone APIs are used in Angular to create a custom <code class=\"language-text\">NgZone</code>, which enables consumers and Angular itself to run code inside or outside Angular’s Zone</li>\n</ul>\n<p>If you haven’t read these articles yet, we definitely recommend you to do so as they give a very solid understanding of what Zones are and what they do. The bottom line is, however, Zones wrap asynchronous browser APIs, and notify a consumer when an asynchronous task has started or ended. Angular takes advantage of these APIs to get notified when any asynchronous task is done. This includes things like <code class=\"language-text\">XHR</code> calls, <code class=\"language-text\">setTimeout()</code> and pretty much all user events like <code class=\"language-text\">click</code>, <code class=\"language-text\">submit</code>, <code class=\"language-text\">mousedown</code>, … etc.</p>\n<p>Once notified, Angular knows that it has to perform change detection because any of the asynchronous operations might have changed the application state. This, for instance, is always the case when we use Angular’s <code class=\"language-text\">Http</code> service to fetch data from a remote server. The following snippet shows how such a call can change application state:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppComponent</span> <span class=\"token punctuation\">{</span>\n\n  data<span class=\"token punctuation\">:</span> any<span class=\"token punctuation\">;</span> <span class=\"token comment\">// initial application state</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> dataService<span class=\"token punctuation\">:</span> DataService</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">ngOnInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dataService<span class=\"token punctuation\">.</span><span class=\"token function\">fetchDataFromRemoteService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> data <span class=\"token comment\">// application state has changed, change detection needs to run now</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The nice thing about this is that we as developers don’t have to care about notifying Angular to perform change detection, because Zones will do it for us as Angular subscribes to them under the hood.</p>\n<p>Okay, now that we touched on that, let’s take a look at how they can be used to make our demo app fast.</p>\n<h2>Running outside Angular’s Zone</h2>\n<p>We know that change detection is performed whenever an asynchronous event happened and an event handler was bound to that event. This is exactly the reason why our initial demo performs rather jankee. Let’s look at <code class=\"language-text\">AppComponent</code>’s template:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;svg (mousedown)=\"mouseDown($event)\"\n         (mouseup)=\"mouseUp($event)\"\n         (mousemove)=\"mouseMove($event)\">\n\n      &lt;svg:g box *ngFor=\"let box of boxes\" [box]=\"box\">\n      &lt;/svg:g>\n\n    &lt;/svg>\n  </span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AppComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Three (3) event handlers are bound to the outer SVG element. When any of these events fire and their handlers have been executed then change detection is performed. In fact, this means that Angular will run change detection, even when we just move the mouse over the boxes without actually dragging a single box!</p>\n<p>This is where taking advantage of <code class=\"language-text\">NgZone</code> APIs comes in handy. <code class=\"language-text\">NgZone</code> enables us to explicitly run certain code <strong>outside</strong> Angular’s Zone, preventing Angular to run any change detection. So basically, handlers will still be executed, but since they won’t run inside Angular’s Zone, Angular won’t get notified that a task is done and therefore no change detection will be performed. We only want to run change detection once we release the box we are dragging.</p>\n<p>Okay, how do we achieve this? In our article on <a href=\"/angular/2016/02/01/zones-in-angular-2.html#running-code-outside-angulars-zone\">Zones in Angular</a>, we already discussed how to run code outside Angular’s Zone using <code class=\"language-text\">NgZone.runOutsideAngular()</code>. All we have to do is to make sure that the <code class=\"language-text\">mouseMove()</code> event handler is only attached and executed outside Angular’s zone. In addition to that, we know we want to attach that event handler only if a box is being selected for dragging. In other words, we need to change our <code class=\"language-text\">mouseDown()</code> event handler to imperatively add that event listener to the document.</p>\n<p>Here’s what that looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> NgZone <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  element<span class=\"token punctuation\">:</span> HTMLElement<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> zone<span class=\"token punctuation\">:</span> NgZone</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">mouseDown</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>element <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>zone<span class=\"token punctuation\">.</span><span class=\"token function\">runOutsideAngular</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      window<span class=\"token punctuation\">.</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mousemove'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">mouseMove</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">mouseMove</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>element<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">.</span>clientX <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clientX <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>element<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'y'</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">.</span>clientX <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clientY <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We inject <code class=\"language-text\">NgZone</code> and call <code class=\"language-text\">runOutsideAngular()</code> inside our <code class=\"language-text\">mouseDown()</code> event handler, in which we attach an event handler for the <code class=\"language-text\">mousemove</code> event. This ensures that the <code class=\"language-text\">mousemove</code> event handler is really only attached to the document when a box is being selected. In addition, we save a reference to the underlying DOM element of the clicked box so we can update its <code class=\"language-text\">x</code> and <code class=\"language-text\">y</code> attributes in the <code class=\"language-text\">mouseMove()</code> method. We’re working with the DOM element instead of a box object with bindings for <code class=\"language-text\">x</code> and <code class=\"language-text\">y</code>, because bindings won’t be change detected since we’re running the code outside Angular’s Zone. In other words, we <strong>do</strong> update the DOM, so we can see the box is moving, but we aren’t actually updating the box model (yet).</p>\n<p>Also, notice that we removed the <code class=\"language-text\">mouseMove()</code> binding from our component’s template. We could remove the <code class=\"language-text\">mouseUp()</code> handler as well and attach it imperatively, just like we did with the <code class=\"language-text\">mouseMove()</code> handler. However, it won’t add any value performance-wise, so we decided to keep it in the template for simplicity’s sake:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">(mousedown)</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>mouseDown($event)<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">(mouseup)</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>mouseUp($event)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">svg:</span>g</span> <span class=\"token attr-name\">box</span> <span class=\"token attr-name\">*ngFor</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>let box of boxes<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[box]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>box<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">svg:</span>g</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>In the next step, we want to make sure that, whenever we release a box (<code class=\"language-text\">mouseUp</code>), we update the box model, plus, we want to perform change detection so that the model is in sync with the view again. The cool thing about <code class=\"language-text\">NgZone</code> is not only that it allows us to run code outside Angular’s Zone, it also comes with APIs to run code <strong>inside</strong> the Angular Zone, which ultimately will cause Angular to perform change detection again. All we have to do is to call <code class=\"language-text\">NgZone.run()</code> and give it the code that should be executed.</p>\n<p>Here’s the our updated <code class=\"language-text\">mouseUp()</code> event handler:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token function\">mouseUp</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Run this code inside Angular's Zone and perform change detection</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>zone<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateBox</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentId<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">.</span>clientX <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>offsetX<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">.</span>clientY <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>offsetY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentId <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    window<span class=\"token punctuation\">.</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mousemove'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mouseMove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Also notice that we’re removing the event listener for the <code class=\"language-text\">mousemove</code> event <strong>on every mouseUp</strong>. Otherwise, the event handler would still be executed on every mouse move. In other words, the box would keep moving even after the finger was lifted, essentially taking the <em>drop</em> part out of <em>drag and drop</em>. In addition to that, we would pile up event handlers, which could not only cause weird side effects but also blows up our runtime memory.</p>\n<h2>Measuring the performance</h2>\n<p>Alright, now that we know how Jordi implemented this version of our demo application, let’s take a look at some numbers! The following numbers have been recorded using the exact same techniques on the exact same machine as in our <a href=\"/angular/2017/02/02/making-your-angular-app-fast.html\">previous article on performance</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5d2e4eb2da56897f748fb2cf1be1dc55/e326c/dnd-perf-profile-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACgElEQVQ4y5WT2XLTQBBF9ev8Bi/wATzAK1sFCDgJXhPsWCiWtYyW2JItyZIcx5IPLUFSSVWKglbdmlFPz+073TOa53k08P0Ay7Kxfuq4ronrmNjOjIvxgLn5E9ez8GwTa+4wM2b4f/Y1ME3x2za2QFOeasl8z0GfnPLt+zGfOkd8OfvUzk/6HU56Xzk6+cjn0w/owzcSdywJ/JbU9/17GIaBFgiZ6yiUY2EZF3RHXfoXXUaTvsxPGYx7nE+GnA07Mv+OdfmVy/GZEIS0e12XIAhRrkKf6mhJvsIJLGzfIikSVOjgeDZxEqECh+X6miRf4/g2y9WS63WM6Vqt31Jz9NmUKF2grh1JPEJzlY+jPK6XEXG6Yr1J8RchYbQgzTPWRUmcJUKakpUJxS5lu8/lP5HYSHwpxXbHze2eJNugve285v3paybzPg/tcKglMGethtT7krqG80HIsBcz6kdEyy3THwXjSUBXP+Ls8iOG+0MULmc4S4Ng5XJovsNBNh+oqj276paleUwUO6hISW2ncqw5vcEVs5nHoG8zGBlCNGYe6oQrhfZY1R1h3Y6NhTGUN5UkuKWqd+IRqVRtwmZsTvLQHhE+ZVmRClHVzquqejKmOdk9YVmWbLdb8jxns9lQFAVpKg3IGmxIN76s54Kbdq2J/Ru0IAjkhkuNlGpvejNGkRQ9XrFYLEiStCW7S/wQT/m0LMuI45hVvBAFmRCs26Zw2El9pFZ1zf+YVlVNI7aYFza9zqZ1tu/TuOJKntJU19nv94+a9jdoTZ1s64r3Rz1evtBFdkUqKlUo7zT02+PfdfyfCGtReK53ef7uGW8Hr34r9D3CMGyVluX2nuxf7Bcag2sKO+ihsgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dnd perf profile 5\"\n        title=\"dnd perf profile 5\"\n        src=\"/static/5d2e4eb2da56897f748fb2cf1be1dc55/8ff1e/dnd-perf-profile-5.png\"\n        srcset=\"/static/5d2e4eb2da56897f748fb2cf1be1dc55/9ec3c/dnd-perf-profile-5.png 200w,\n/static/5d2e4eb2da56897f748fb2cf1be1dc55/c7805/dnd-perf-profile-5.png 400w,\n/static/5d2e4eb2da56897f748fb2cf1be1dc55/8ff1e/dnd-perf-profile-5.png 800w,\n/static/5d2e4eb2da56897f748fb2cf1be1dc55/e326c/dnd-perf-profile-5.png 884w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>1st Profile, Event (mousemove): <strong>~0.45ms, ~0.50ms (fastest, slowest)</strong></li>\n<li>2nd Profile, Event (mousemove): <strong>~0.39ms, ~0.52ms (fastest, slowest)</strong></li>\n<li>3rd Profile, Event (mousemove): <strong>~0.38ms, ~0.45ms (fastest, slowest)</strong></li>\n</ul>\n<h2>Conclusion</h2>\n<p>Using Zones is a great way to escape Angular’s change detection, without detaching change detectors and making the application code too complex. In fact, it turns out that Zones APIs are super easy to use, especially <code class=\"language-text\">NgZone</code>’s APIs to run code outside or inside Angular. Based on the numbers, we can even say that this version is about as fast as the fastest solution we came up with in our previous article. Considering that the developer experience is much better when using Zones APIs, since they are easier to use than manually detaching and re-attaching change detector references, it’s definitely the most “beautiful” performance improvement we have so far.</p>\n<p>However, we shouldn’t forget that this solution also comes with a couple (probably fixable) downsides. For example, we’re relying on DOM APIs and the global <code class=\"language-text\">window</code> object, which is something we should always try to avoid. If we wanted to use this code with on the server-side then direct access of the window variable would be problematic. We will discus these server-side specific issues in a future article. For the sake of this demo, this isn’t a big deal though.</p>\n<p>Again, a huge shout-out goes to <a href=\"https://twitter.com/galigan\">Jordi Collell</a> who not only made us adding this option, but also taking the time to actually implement a first version of this demo!</p>","frontmatter":{"author":"pascal_precht","title":"Using Zones in Angular for better performance","imageUrl":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAgX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAefpFpSikt//xAAaEAEBAAIDAAAAAAAAAAAAAAABAgADESEx/9oACAEBAAEFAq5sJkcn01gGrr//xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAwEBPwGI/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHRAAAgIBBQAAAAAAAAAAAAAAAAERITECMlGBkf/aAAgBAQAGPwK9KXQ4TzyUn6QZNzP/xAAaEAEAAwADAAAAAAAAAAAAAAABABEhMUFR/9oACAEBAAE/Id56+qXE5dYSsyiieE6AwZmFAQ8k/9oADAMBAAIAAwAAABAM7//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ECH/xAAWEQEBAQAAAAAAAAAAAAAAAAABACH/2gAIAQIBAT8QVLb/xAAcEAACAgMBAQAAAAAAAAAAAAABEQAhMXHRQVH/2gAIAQEAAT8QNSZgijLW4XIiAhK+o2IBY8GiVuswwCoWHmMQ/qrkKGk6XJ//2Q==","aspectRatio":1.4992503748125936,"src":"/static/23a21cff0980f7e8250e4e0789256995/30037/using-zones-in-angular-for-better-performance.jpg","srcSet":"/static/23a21cff0980f7e8250e4e0789256995/10bdc/using-zones-in-angular-for-better-performance.jpg 158w,\n/static/23a21cff0980f7e8250e4e0789256995/f4ab0/using-zones-in-angular-for-better-performance.jpg 315w,\n/static/23a21cff0980f7e8250e4e0789256995/30037/using-zones-in-angular-for-better-performance.jpg 630w,\n/static/23a21cff0980f7e8250e4e0789256995/9810d/using-zones-in-angular-for-better-performance.jpg 945w,\n/static/23a21cff0980f7e8250e4e0789256995/ff2e4/using-zones-in-angular-for-better-performance.jpg 1260w,\n/static/23a21cff0980f7e8250e4e0789256995/883ab/using-zones-in-angular-for-better-performance.jpg 2000w","sizes":"(max-width: 630px) 100vw, 630px"}}},"date":"21 February 2017","summary":"In this article we'll take a look at how to use Zone APIs to improve our app's performance!","categories":["angular"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/angular/2017/02/21/using-zones-in-angular-for-better-performance.html","previous":{"fields":{"slug":"/announcements/2017/02/09/dominic-joins-thoughtram.html"},"frontmatter":{"date":"2017/02/09","title":"Dominic joins thoughtram","categories":["announcements"]}},"next":{"fields":{"slug":"/angular/2017/02/27/three-things-you-didnt-know-about-the-async-pipe.html"},"frontmatter":{"date":"2017/02/27","title":"Three things you didn't know about the AsyncPipe","categories":["angular"]}}}}}