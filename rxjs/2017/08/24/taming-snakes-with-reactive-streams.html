<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/commons.743a077edf8bbf03e9ea.css">/*! normalize.css v7.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}:root{--thtrm-color-darkblue:#456474;--thtrm-color-midblue:#4c91a7;--thtrm-color-blue:#69caff;--thtrm-color-lighterblue:#dbe8ec;--thtrm-color-teal:#42899b;--thtrm-color-lightblue:#72c7df;--thtrm-color-text:#000;--thtrm-color-lighttext:#7d7d7d;--thtrm-color-gray:#eee;--thtrm-color-lightgray:#f8f8f9;--thtrm-color-ultralightgray:#fbfbfb;--thtrm-color-white:#fff;--thtrm-rustforjs-yellow:#ffd45e;--thtrm-amc-red:#dd0031;--thtrm-git-orange:#de4c36;--thtrm-rxjs-pink:#b7178c;--thtrm-border-color:var(--thtrm-color-gray);--thtrm-base-font:Roboto;--thtrm-base-font-stack:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";--thtrm-base-fontweight:500;--thtrm-base-fontsize:19px;--thtrm-small-fontsize:calc(0.85*var(--thtrm-base-fontsize));--thtrm-nav-fontsize:calc(1*var(--thtrm-base-fontsize));--thtrm-h1-fontszize:calc(1.75*var(--thtrm-base-fontsize));--thtrm-h2-fontszize:calc(1.5*var(--thtrm-base-fontsize));--thtrm-h3-fontszize:calc(1.3*var(--thtrm-base-fontsize));--thtrm-h4-fontszize:calc(1.1*var(--thtrm-base-fontsize));--thtrm-page-margin:5vw;--thtrm-page-neg-margin:-5vw;--thtrm-layer-submarine:-1;--thtrm-layer-deco:9;--thtrm-layer-navigation:99;--thtrm-layer-surface:99999999999}@font-face{font-family:Roboto;font-style:normal;font-weight:300;src:local("Roboto"),local("Roboto")}@font-face{font-family:Roboto;font-weight:500;src:local("Roboto Medium"),local("Roboto Medium")}@font-face{font-family:Roboto;font-style:italic;font-weight:500;src:local("Roboto Medium Italic"),local("Roboto-MediumItalic")}*,:after,:before{box-sizing:border-box;margin:0;padding:0}html{font-family:var(--thtrm-base-font),var(--thtrm-base-font-stack);font-size:var(--thtrm-base-fontsize);font-weight:var(--thtrm-base-fontweight);line-height:1.45;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{position:relative}h1,h2,h3,h4{font-weight:var(--thtrm-bold-fontweight);line-height:1.2;letter-spacing:0;margin:0}h1{font-size:var(--thtrm-h1-fontszize)}a{color:var(--thtrm-color-midblue);text-decoration:none}.thtrm-page--yellow a{color:#000}a:after{color:currentColor;content:"\203A";font-weight:400;font-size:1.15em;margin-left:.25em}a[title=Home]:after{display:none}img{width:100%;height:auto}@media screen and (min-width:80em){:root{--thtrm-base-fontsize:25px;--thtrm-small-fontsize:calc(0.75*var(--thtrm-base-fontsize));--thtrm-nav-fontsize:calc(1*var(--thtrm-base-fontsize));--thtrm-h1-fontszize:calc(2.25*var(--thtrm-base-fontsize));--thtrm-h2-fontszize:calc(2*var(--thtrm-base-fontsize));--thtrm-page-margin:10vw;--thtrm-page-neg-margin:-10vw}}@media screen and (min-width:120em){:root{--thtrm-base-fontsize:27px}}.thtrm-page{padding-left:5vw;padding-right:5vw;overflow-x:hidden}.thtrm-page.thtrm-page--yellow{background-color:var(--thtrm-rustforjs-yellow)}.thtrm-banner{display:flex;align-items:center;justify-content:space-between;height:90px}@media screen and (min-width:80em){.thtrm-page{padding-left:10vw;padding-right:10vw}.thtrm-banner{height:160px}}@media screen and (min-width:120em){.thtrm-page{padding-left:10vw;padding-right:10vw}.thtrm-banner{height:260px}}@supports (display:grid){.thtrm-page{display:grid;grid-template-columns:[pad-left] 5vw [center] 90vw [pad-left] 5vw;grid-template-rows:[banner] 90px [main] auto [aside] auto [footer] auto;padding-left:0;padding-right:0}@media screen and (min-width:80em){.thtrm-page{grid-template-columns:[pad-left] 10vw [center] 80vw [pad-left] 10vw;grid-template-rows:[banner] 160px [main] auto [aside] auto [footer] auto}}@media screen and (min-width:120em){.thtrm-page{grid-template-columns:[pad-left] 10vw [center] 80vw [pad-left] 10vw;grid-template-rows:[banner] 260px [main] auto [aside] auto [footer] auto}}.thtrm-banner{height:auto;grid-row-start:1;grid-row-end:1}.thtrm-banner,.thtrm-main{grid-column-start:2;grid-column-end:2}.thtrm-main{grid-row-start:2;grid-row-end:2}.thtrm-aside{grid-row-start:3;grid-row-end:3}.thtrm-aside,.thtrm-footer{grid-column-start:2;grid-column-end:2}.thtrm-footer{grid-row-start:4;grid-row-end:4}}.thtrm-banner{position:relative}.thtrm-footer{border-top:5px solid var(--thtrm-color-text);font-size:var(--thtrm-small-fontsize);padding:2rem 0;margin-top:2rem}.thtrm-footer .thtrm-sitemap{margin-bottom:2rem}.thtrm-footer .thtrm-sitemap__heading{font-size:var(--thtrm-base-fontsize);margin-top:1rem;margin-bottom:.5rem}.thtrm-footer .thtrm-copyright{display:flex;align-items:center;justify-content:space-between}.thtrm-footer .thtrm-sitemap nav ul{list-style:none}.thtrm-footer .thtrm-sitemap nav li a{text-decoration:none}.thtrm-footer .thtrm-sitemap nav li a:after{color:currentColor;content:"\203A";font-weight:400;font-size:1.15em;margin-left:.25em}@media screen and (min-width:31.5em){.thtrm-footer .thtrm-sitemap{display:grid;grid-template-columns:33.33333333333% 33.33333333333% 33.33333333333%;margin-bottom:2rem}.thtrm-footer .thtrm-sitemap__item{-ms-grid-column-span:1}.thtrm-footer .thtrm-sitemap__item:first-of-type{-ms-grid-column:1}.thtrm-footer .thtrm-sitemap__item:nth-of-type(2){-ms-grid-column:2}.thtrm-footer .thtrm-sitemap__item:nth-of-type(3){-ms-grid-column:3}.thtrm-footer .thtrm-sitemap__heading{margin-top:0;margin-bottom:1rem}}.thtrm-box{background-color:var(--thtrm-color-midblue);color:var(--thtrm-color-white);font-size:var(--thtrm-small-fontsize);padding:1.5rem;width:100%}.thtrm-box--light{background-color:var(--thtrm-color-lightblue)}.thtrm-box--red{background-color:var(--thtrm-amc-red)}.thtrm-box--red,.thtrm-box--white{box-shadow:0 2px 24px 0 rgba(0,0,0,.04)}.thtrm-box--white{background-color:var(--thtrm-color-white);color:var(--thtrm-color-text)}.thtrm-box--dark{background-color:var(--thtrm-color-darkblue)}.thtrm-box--mid{background-color:var(--thtrm-color-teal)}.thtrm-box>.thtrm-box__heading{margin-bottom:1rem}.thtrm-box--offset-left,.thtrm-box--offset-right{margin-bottom:.5rem}.thtrm-box>.thtrm-box__more-link{color:var(--thtrm-color-white);display:block;font-size:var(--thtrm-base-fontsize);text-decoration:none;margin-top:1rem}@media screen and (min-width:43.75em){.thtrm-box{padding:2rem}.thtrm-box:not([class*=thtrm-box--offset]){width:auto}.thtrm-box--offset-left,.thtrm-box--offset-right{margin-bottom:1rem;position:absolute;top:2.5rem;width:80%;right:-70%;z-index:var(--thtrm-layer-deco)}.thtrm-box--offset-right{right:-70%}.thtrm-box--offset-left{left:-70%}}.thtrm-button,[class*=thtrm-button],[class^=thtrm-button]{border:none;background-color:var(--thtrm-color-darkblue);color:var(--thtrm-color-white);display:inline-block;font-weight:var(--thtrm-base-fontweight);font-size:inherit;padding:.5rem 1rem;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.thtrm-page--yellow .thtrm-button,.thtrm-page--yellow [class*=thtrm-button],.thtrm-page--yellow [class^=thtrm-button]{background-color:#000}.thtrm-button--bordered{border:4px solid;background-color:transparent}.thtrm-button--ghost{color:inherit;padding:.25rem}.thtrm-button--ghost,.thtrm-page--yellow .thtrm-button--ghost{background-color:transparent}.thtrm-card{background-color:var(--thtrm-color-midblue);color:var(--thtrm-color-white);font-size:var(--thtrm-small-fontsize);padding:1rem;width:100%}.thtrm-card--red{background-color:var(--thtrm-amc-red)}.thtrm-card--black,.thtrm-card--red{box-shadow:0 2px 24px 0 rgba(0,0,0,.04)}.thtrm-card--black{background-color:var(--thtrm-git-orange)}.thtrm-card--pink{background-color:var(--thtrm-rxjs-pink)}.thtrm-card--pink,.thtrm-card--white{box-shadow:0 2px 24px 0 rgba(0,0,0,.04)}.thtrm-card--white{background-color:var(--thtrm-color-white);color:var(--thtrm-color-text)}.thtrm-card>.thtrm-card__heading{margin-bottom:1rem}.thtrm-card__topic{font-size:.625rem;margin-bottom:.5rem;color:var(--thtrm-color-white);text-transform:uppercase;letter-spacing:.02em}.thtrm-card__topic.thtrm-card__topic--red{color:var(--thtrm-amc-red)}.thtrm-card__topic.thtrm-card__topic--pink{color:var(--thtrm-rxjs-pink)}.thtrm-card__topic.thtrm-card__topic--grey{color:var(--thtrm-color-lighttext)}.thtrm-card__topic.thtrm-card__topic--black{color:var(--thtrm-git-orange)}.thtrm-card__list{list-style:none}.thtrm-card__list li{position:relative;padding-left:1rem;margin-top:.5em;line-height:1.2}.thtrm-card__list li:before{content:"\2192   ";margin-left:-1rem;position:absolute}.thtrm-card__paragraph{margin:.5rem 0}.thtrm-card__link{color:inherit}@media screen and (min-width:43.75em){.thtrm-card{padding:1.5rem}}.thtrm-form .thtrm-form__label{display:none}.thtrm-form .thtrm-form__input--text{background-color:var(--thtrm-color-gray);border:none;font-size:inherit;padding:.5rem 1rem;min-width:40%}.thtrm-form__info-text{font-size:.4rem;font-weight:400;max-width:500px;color:#aaa;margin:.4em auto auto}.thtrm-form__info-text a{text-decoration:underline;color:#aaa}.thtrm-form__info-text a:after{display:none}.thtrm-form__row{margin-top:16px}.thtrm-form__column-group{display:grid;grid-column-gap:24px;grid-template-columns:1fr 1fr;grid-template-rows:auto auto}.thtrm-form__column-group label{grid-row:1}.thtrm-form__column-group input{grid-row:2}.thtrm-icon,[class^=thtrm-icon--]{color:inherit;display:inline-block;vertical-align:middle;transition:all .25s linear;height:24px;width:24px}svg.thtrm-icon,svg[class^=thtrm-icon]{fill:currentColor}svg.thtrm-icon path:not([fill=none]),svg.thtrm-icon use,svg[class^=thtrm-icon] path:not([fill=none]),svg[class^=thtrm-icon] use{fill:inherit}.thtrm-image-grid{display:flex;flex-flow:column wrap;align-items:center;justify-content:space-around;z-index:var(--thtrm-layer-submarine);margin-top:-.25rem}.thtrm-image-grid img{text-align:center;-o-object-fit:contain;object-fit:contain;font-family:"object-fit: contain;";width:50%;max-width:200px;max-height:200px}@media screen and (min-width:20em){.thtrm-image-grid{flex-flow:row wrap}}@media screen and (min-width:43.75em){.thtrm-image-grid img{width:25%;max-width:18%;max-height:250px;-o-object-fit:contain;object-fit:contain;font-family:"object-fit: contain;"}}.thtrm-layout{display:grid;grid-gap:1rem;padding:1rem;width:100%}.thtrm-layout.thtrm-layout-fourths,.thtrm-layout.thtrm-layout-halfs,.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr}@media screen and (min-width:43.75em){.thtrm-layout.thtrm-layout-fourths,.thtrm-layout.thtrm-layout-halfs,.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr 1fr}}@media screen and (min-width:50em){.thtrm-layout.thtrm-layout-fourths,.thtrm-layout.thtrm-layout-halfs,.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr 1fr}}@media screen and (min-width:64em){.thtrm-layout.thtrm-layout-halfs,.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr 1fr}.thtrm-layout.thtrm-layout-fourths{grid-template-columns:1fr 1fr 1fr}}@media screen and (min-width:80em){.thtrm-layout{grid-gap:1.5rem;padding:1.5rem}.thtrm-layout.thtrm-layout-halfs{grid-template-columns:1fr 1fr}.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr 1fr 1fr}.thtrm-layout.thtrm-layout-fourths{grid-template-columns:1fr 1fr 1fr 1fr}}@media screen and (min-width:120em){.thtrm-layout{display:grid;grid-gap:1.5rem}.thtrm-layout.thtrm-layout-halfs{grid-template-columns:1fr 1fr}.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr 1fr 1fr}.thtrm-layout.thtrm-layout-fourths{grid-template-columns:1fr 1fr 1fr 1fr 1fr}}.thtrm-logo{max-height:45px;width:160px;margin-top:-1.65rem}@media screen and (min-width:80em){.thtrm-logo{max-height:80px;width:200px;margin-top:-1rem}}@media screen and (min-width:120em){.thtrm-logo{max-height:100px;width:380px}}.thtrm-nav{display:flex;align-items:center;justify-content:space-between;font-size:var(--thtrm-nav-fontsize)}.thtrm-nav .thtrm-nav__list{background-color:var(--thtrm-color-lightgray);box-shadow:0 1px 2px rgba(50,50,50,.1);list-style:none;text-align:left;position:absolute;right:0;top:70%;width:auto;z-index:99;opacity:0;visibility:hidden;transition:.25s;transform:translate3d(0,-10%,0);padding:1rem .5rem}.thtrm-nav .thtrm-nav__list:before{content:"";width:10px;height:10px;border-right:6px solid transparent;border-left:6px solid transparent;border-bottom:6px solid var(--thtrm-color-lightgray);position:absolute;top:-10px;right:10px}.thtrm-nav .thtrm-nav__list li{padding:0 1rem;margin-top:.5rem}.thtrm-nav .thtrm-nav__list a{color:var(--thtrm-color-text);font-weight:var(--thtrm-base-fontweight);text-decoration:none;transition:.25s}.thtrm-nav .thtrm-nav__list a.active{border-bottom:2px solid var(--thtrm-color-text);padding-bottom:.3em}.thtrm-nav .thtrm-nav__list a:hover{color:var(--thtrm-color-blue)}.thtrm-nav .thtrm-nav__list a:after{content:""}.no-js .thtrm-nav .thtrm-nav__button:focus+.thtrm-nav__list,.no-js .thtrm-nav .thtrm-nav__button:hover+.thtrm-nav__list,.no-js .thtrm-nav__list:hover,.thtrm-nav__list.is-visible{opacity:1;pointer-events:all;visibility:visible;transform:translateZ(0)}.thtrm-nav-toc{border-top:3px solid #000;font-size:.75rem}.thtrm-nav-toc li{display:inline-block}.thtrm-nav-toc li:first-child a{padding-left:0}.thtrm-nav-toc li:last-child a{padding-right:0}.thtrm-nav-toc a{color:var(--thtrm-color-text);display:block;padding:.75rem 1rem}.thtrm-nav-toc a.is-active{color:var(--thtrm-color-midblue)}.thtrm-nav-toc a:after{content:""}@media screen and (min-width:50em){.thtrm-nav .thtrm-nav__list li:last-of-type{padding-right:0}.thtrm-nav .thtrm-nav__button,.thtrm-nav .thtrm-nav__list:before{display:none}.thtrm-nav .thtrm-nav__list{background-color:transparent;box-shadow:none;display:flex;flex-flow:row wrap;align-items:center;justify-content:flex-end;opacity:1;pointer-events:all;visibility:visible;transform:translateZ(0);position:static}}[class*=thtrm-ratio--]{position:relative}[class*=thtrm-ratio--]:before{content:"";display:block;width:100%}[class*=thtrm-ratio--]>*{position:absolute;bottom:0;left:0;right:0;top:0}[class*=thtrm-ratio--]>img{height:100%;-o-object-fit:cover;object-fit:cover}.thtrm-ratio--landscape:before{padding-top:75%}.thtrm-ratio--square:before{padding-top:100%}.thtrm-ratio--stripe:before{padding-top:50%}.thtrm-section,[class^=thtrm-section--]{position:relative;margin-bottom:3rem}.thtrm-section .thtrm-section__item,[class^=thtrm-section--] .thtrm-section__item{width:100%}.thtrm-section .thtrm-section__heading,[class^=thtrm-section--] .thtrm-section__heading{width:100%;margin-top:1.5rem;margin-bottom:.75rem}.thtrm-section .thtrm-section__paragraph,[class^=thtrm-section--] .thtrm-section__paragraph{margin-bottom:1rem}.thtrm-section .thtrm-section__paragraph a:after,[class^=thtrm-section--] .thtrm-section__paragraph a:after{display:none}.thtrm-section .thtrm-section__paragraph--small,[class^=thtrm-section--] .thtrm-section__paragraph--small{font-size:.8rem;font-weight:400}.thtrm-section .thtrm-section__link,[class^=thtrm-section--] .thtrm-section__link{display:inline-block;margin-bottom:1rem}.thtrm-section .thtrm-section__link--black,[class^=thtrm-section--] .thtrm-section__link--black{color:#000}.thtrm-section .thtrm-section__link--black .thtrm-section__link,[class^=thtrm-section--] .thtrm-section__link--black .thtrm-section__link{color:var(--thtrm-color-midblue)}.thtrm-section .thtrm-section__link--black .thtrm-section__link:after,[class^=thtrm-section--] .thtrm-section__link--black .thtrm-section__link:after{color:currentColor}.thtrm-section .thtrm-section__heading--unpadded-top,[class^=thtrm-section--] .thtrm-section__heading--unpadded-top{width:100%;margin-top:0;margin-bottom:.75rem}.thtrm-section .thtrm-section__heading--small,[class^=thtrm-section--] .thtrm-section__heading--small{width:100%;margin-bottom:1rem;font-size:1.25rem;line-height:1.3}.thtrm-section--centered{text-align:center}.thtrm-section--unpadded-bottom{margin-bottom:0}.thtrm-section--fullbleed{margin-left:-5vw;margin-right:-5vw;min-height:300px}.thtrm-section--fullbleed-intrinsic{margin-left:-5vw;margin-right:-5vw;margin-top:0}@media screen and (min-width:80em){.thtrm-section--fullbleed-intrinsic{margin-left:-10vw;margin-right:-10vw}}.thtrm-section--privacy-statement li,.thtrm-section--privacy-statement p,.thtrm-section--privacy-statement strong{font-size:.8rem;font-weight:400}.thtrm-section--privacy-statement p,.thtrm-section--privacy-statement ul{margin-bottom:.75rem}.thtrm-section--privacy-statement ul{margin-left:1rem}.thtrm-section--privacy-statement h3,.thtrm-section--privacy-statement h4{margin-bottom:1rem;margin-top:.5rem}.thtrm-stripe--fullwidth{font-weight:700;color:#fff;font-size:1.5rem;height:6rem;text-align:center;display:flex;width:100%;align-items:center;justify-content:center}.thtrm-section__footer,.thtrm-section__header{text-align:center;width:100%;padding:2rem 5vw}.thtrm-section__footer p+a,.thtrm-section__header p+a{display:inline-block;margin-top:2em}.thtrm-section__footer p>a:after,.thtrm-section__header p>a:after{display:none}.thtrm-section__subheading{margin-bottom:1rem}.thtrm-section--offright-white{background-color:var(--thtrm-color-white)}.thtrm-section__item--flushleft,.thtrm-section__item--flushright,.thtrm-section__item--fullwidth,.thtrm-section__item--halfpadded{width:100%}.thtrm-section__item--columns>*{margin-bottom:1rem}.thtrm-section__item--columns{font-size:var(--thtrm-small-fontsize);left:0}.thtrm-section__hero{width:100%;position:relative;margin-top:1rem;padding-top:6.25rem}.thtrm-section__hero .thtrm-section__hero-image{height:6.25rem;width:6.25rem;-o-object-fit:contain;object-fit:contain;position:absolute;left:0;top:0;z-index:var(--thtrm-layer-deco)}@media screen and (min-width:64em){.thtrm-section__hero{padding-left:16rem;margin-top:2rem;padding-top:0}.thtrm-section__hero .thtrm-section__hero-image{height:14rem;width:14rem}}@media screen and (min-width:120em){.thtrm-section__hero{width:75%}}.thtrm-content-box{background-color:var(--thtrm-color-darkblue);color:var(--thtrm-color-white);font-size:var(--thtrm-small-fontsize);padding:2rem;z-index:var(--thtrm-layer-deco)}.thtrm-section-constrained{max-width:800px;margin-left:auto;margin-right:auto;width:100%}@media screen and (min-width:50em){.thtrm-section--fullbleed{margin-left:var(--thtrm-page-neg-margin);margin-right:var(--thtrm-page-neg-margin);height:50vh;min-height:600px}}@media screen and (min-width:43.75em){.thtrm-section,[class^=thtrm-section--]{display:flex;flex-flow:row wrap;position:relative}.thtrm-section .thtrm-section__item,[class^=thtrm-section--] .thtrm-section__item{width:50%}.thtrm-section .thtrm-section__item--halfpadded,[class^=thtrm-section--] .thtrm-section__item--halfpadded{width:calc(50% - 5vw)}.thtrm-section .thtrm-section__item--flushright,[class^=thtrm-section--] .thtrm-section__item--flushright{position:relative;right:var(--thtrm-page-neg-margin);width:calc(50% + 5vw)}.thtrm-section .thtrm-section__item--flushleft,[class^=thtrm-section--] .thtrm-section__item--flushleft{position:relative;left:var(--thtrm-page-neg-margin);width:calc(50% + 5vw)}.thtrm-section .thtrm-section__item--pulldown,[class^=thtrm-section--] .thtrm-section__item--pulldown{position:relative;transform:translateY(50%);z-index:var(--thtrm-layer-deco)}.thtrm-section .thtrm-section__item--flushright-maxed,[class^=thtrm-section--] .thtrm-section__item--flushright-maxed{position:relative;right:var(--thtrm-page-neg-margin);width:calc(50% + 10vw)}.thtrm-section .thtrm-section__item--flushleft-maxed,[class^=thtrm-section--] .thtrm-section__item--flushleft-maxed{position:relative;left:var(--thtrm-page-neg-margin);width:calc(50% + 10vw)}.thtrm-section .thtrm-content-box,[class^=thtrm-section--] .thtrm-content-box{position:absolute;right:0;bottom:0;max-width:70%;transform:translate3d(0,50%,0)}.thtrm-section--undercut-bottom{margin-bottom:-2rem;z-index:var(--thtrm-layer-deco)}.thtrm-section--offright-white{background-color:var(--thtrm-color-white);max-width:70%;position:relative;right:-5%}.thtrm-section--fullbleed{margin-top:6rem}.thtrm-section__item--columns{display:grid;grid-template-columns:50% 50%;font-size:var(--thtrm-small-fontsize)}.thtrm-section__item--columns>*{margin-left:2%;margin-right:2%;-ms-grid-column-span:1}.thtrm-section__item--columns>:nth-child(odd){-ms-grid-column:1}.thtrm-section__item--columns>:nth-child(2n){-ms-grid-column:2}}@media screen and (min-width:64em){.thtrm-section__item--columns{display:grid;grid-template-columns:33% 33% 33%;font-size:var(--thtrm-small-fontsize)}.thtrm-section__item--columns>*{margin-bottom:.75rem}.thtrm-section__item--columns>:nth-child(3n+1){-ms-grid-column:1}.thtrm-section__item--columns>:nth-child(3n+2){-ms-grid-column:2}.thtrm-section__item--columns>:nth-child(3n+3){-ms-grid-column:3}}@media screen and (min-width:80em){.thtrm-section--padded-bottom{margin-bottom:7rem}.thtrm-section--offright-white{max-width:70%}.thtrm-section__footer p{padding-left:4em;padding-right:4em}}@media screen and (min-width:120em){.thtrm-section,[class^=thtrm-section--]{margin-bottom:5rem}.thtrm-section--fullbleed{height:50vh;min-height:700px}.thtrm-section--offright-white{max-width:50%;right:-30%}}.thtrm-stripe{background-color:var(--thtrm-color-lightblue);color:var(--thtrm-color-white);text-align:center;display:flex;flex-flow:column nowrap;align-items:center;justify-content:space-between;padding:1rem 2rem;min-height:140px;margin:auto;position:relative;z-index:var(--thtrm-layer-deco)}.thtrm-stripe .thtrm-stripe__cta,.thtrm-stripe .thtrm-stripe__location,.thtrm-stripe .thtrm-stripe__title{margin:.5rem 0}@media screen and (min-width:50em){.thtrm-stripe{flex-flow:row nowrap;position:absolute;left:var(--thtrm-page-margin);right:var(--thtrm-page-margin);transform:translateY(-50%)}}.thtrm-testimonials{width:90vw;display:block;overflow:hidden}.thtrm-testimonial{position:relative;width:100%;padding-top:1.75rem;font-size:1rem;line-height:1.5;white-space:normal;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.thtrm-testimonial:before{position:absolute;content:"\201C";top:-35px;left:20px;font-size:8rem;color:var(--thtrm-color-text);z-index:9999}.thtrm-testimonial>.thtrm-testimonial__avatar{display:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;pointer-events:none}.thtrm-testimonial>.thtrm-testimonial__quote{background-color:var(--thtrm-color-gray);padding:50px 30px 30px}.thtrm-testimonial>.thtrm-testimonial__quote cite{color:var(--thtrm-color-darkblue);font-size:.75em}.thtrm-testimonial--big{position:relative;right:0;margin-left:auto;max-width:100%}.thtrm-testimonial--big>.thtrm-testimonial__quote{background-color:var(--thtrm-color-white);padding:1rem 0 0;font-weight:400;font-style:italic}.thtrm-testimonial--big>.thtrm-testimonial__avatar{max-width:200px}.thtrm-testimonial--big>.thtrm-testimonial__quote cite{color:var(--thtrm-color-darkblue);font-size:.75em;font-style:normal;font-weight:var(--thtrm-base-fontweight);margin-top:.5rem}.thtrm-testimonial--big .thtrm-testimonial__heading{font-weight:var(--thtrm-base-fontweight);font-style:normal;margin-bottom:1rem}.thtrm-testimonials__navigation{margin-top:.5rem;text-align:center;width:100%}.thtrm-testimonials__thumbnail{width:50px;height:50px;-o-object-fit:cover;object-fit:cover;opacity:.5;font-family:"object-fit: cover;"}.is-active .thtrm-testimonials__thumbnail{opacity:1;transition:.25s}@media screen and (min-width:50em){.thtrm-testimonial{position:relative;width:100%;padding-top:50px}.thtrm-testimonial>.thtrm-testimonial:before{top:-65px;left:0;font-size:10rem}.thtrm-testimonials__thumbnail{width:100px;height:100px}.thtrm-testimonial>.thtrm-testimonial__quote{padding:68px 68px 68px 210px;max-width:80%;position:relative;left:10%;top:0;z-index:98;margin-top:40px}.thtrm-testimonial>.thtrm-testimonial__avatar{display:block;position:absolute;left:3%;top:40px;max-width:240px;z-index:99}.thtrm-testimonial--big{position:relative;right:0;margin-left:auto;top:-300px;max-width:55%;margin-bottom:-300px}.thtrm-testimonial--big>.thtrm-testimonial__quote{background-color:var(--thtrm-color-white);padding:2rem 3rem 0;font-weight:400;font-style:italic;font-size:1.25rem}.thtrm-testimonial--big>.thtrm-testimonial__avatar{position:absolute;bottom:0;left:-200px;max-width:200px}.thtrm-testimonial--big>.thtrm-testimonial__quote cite{color:var(--thtrm-color-darkblue);font-size:.75em;font-style:normal;font-weight:var(--thtrm-base-fontweight);margin-top:.5rem}.thtrm-testimonial--big .thtrm-testimonial__heading{font-weight:var(--thtrm-base-fontweight);font-style:normal;margin-bottom:1rem}}@media screen and (min-width:80em){.thtrm-testimonials{width:80vw}}.thtrm-testimonials .frame{width:100%;position:relative;font-size:0;line-height:0;overflow:hidden;white-space:nowrap}.thtrm-testimonials .slides{display:block}.thtrm-testimonials li{cursor:grab;cursor:-webkit-grab}.thtrm-testimonials li,.thtrm-testimonials li:active{position:relative;display:inline-block;width:100%;vertical-align:top}.thtrm-testimonials li:active{cursor:grabbing;cursor:-webkit-grabbing}.thtrm-teaser{display:flex;flex-direction:column}.thtrm-teaser img{display:block}.thtrm-teaser--row{align-items:flex-start;flex-direction:row;justify-content:space-between}.thtrm-teaser--row .thtrm-teaser__thumb{display:none;margin-top:0;width:160px}@media screen and (min-width:64em){.thtrm-teaser--row .thtrm-teaser__thumb{display:block}}.thtrm-teaser__thumb{margin-top:12px}.thtrm-teaser__title{margin-top:4px}.thtrm-teaser__paragraph{margin-top:8px}.thtrm-teaser__link{margin-top:12px}.thtrm-raw-link{color:var(--thtrm-color-text)}.thtrm-raw-link:hover{color:var(--thtrm-color-midblue)}.thtrm-raw-link:after{display:none}.thtrm-listing{display:flex;flex-direction:column;width:100%}.thtrm-listing__item{margin-top:24px;padding-top:24px;border-top:1px solid var(--thtrm-border-color)}.thtrm-page--yellow .thtrm-listing__item{border-top-color:#000}.thtrm-topic{font-size:var(--thtrm-small-fontsize)}.thtrm-title{font-size:var(--thtrm-h4-fontszize)}.thtrm-article{font-weight:300}.thtrm-article h2,.thtrm-article h3,.thtrm-article h4{margin-top:48px;font-weight:500}.thtrm-article h2:first-child,.thtrm-article h3:first-child,.thtrm-article h4:first-child{margin-top:0}.thtrm-article h2 code,.thtrm-article h3 code,.thtrm-article h4 code{margin:0;padding:0;background:transparent!important;color:inherit;font-family:inherit;font-size:inherit;line-height:inherit;text-shadow:inherit}.thtrm-article a:after{display:none}.thtrm-article p{margin-top:24px;font-size:.8rem}.thtrm-article p code{background-color:var(--thtrm-color-gray)!important;color:var(--thtrm-color-midblue)!important;text-shadow:none!important}.thtrm-article p:first-child{margin-top:0}.thtrm-article ol,.thtrm-article ul{margin-top:24px;padding-left:24px;font-size:.8rem}.thtrm-article ol li,.thtrm-article ul li{margin-top:12px}.thtrm-article ol li code,.thtrm-article ul li code{background-color:var(--thtrm-color-gray);color:var(--thtrm-color-midblue)}.thtrm-article ol li:first-child,.thtrm-article ul li:first-child{margin-top:0}.thtrm-article .gatsby-highlight{margin-top:24px;font-size:.65rem}.thtrm-article code{font-size:.65rem}.thtrm-article iframe{margin-top:24px;width:100%;min-height:400px}.thtrm-article-thumb{margin-bottom:32px}.thtrm-article-caption{margin-top:-16px;font-size:.6rem;width:100%;text-align:right}.thtrm-article-caption a:after{display:none}.thtrm-article-header{text-align:center}.thtrm-article-header,.thtrm-article-header__metabar,.thtrm-media{justify-content:center}.thtrm-media{align-items:center;display:grid;grid-template-rows:auto 1fr;text-align:center}@media screen and (min-width:64em){.thtrm-media{align-items:center;grid-template-columns:200px 1fr;grid-template-rows:none;justify-content:flex-start;text-align:left}}.thtrm-media__asset{margin:0 auto;max-width:200px}@media screen and (min-width:64em){.thtrm-media__asset{grid-column:1;max-width:none}}@media screen and (min-width:64em){.thtrm-media__body{grid-column:2}}.thtrm-media--top-start{align-items:flex-start}.thtrm-media-short{display:flex;flex-direction:row}.thtrm-media-short__body{padding-left:8px}.thtrm-avatar{height:25px;width:25px;border-radius:150px}.thtrm-metabar{flex-wrap:wrap;margin-top:-12px}.thtrm-metabar,.thtrm-metabar__item{align-items:center;display:flex;flex-direction:row}.thtrm-metabar__item{margin-top:4px}.thtrm-metabar__item:after{content:"/ ";padding:0 8px}.thtrm-metabar__item:last-child:after{display:none}.u-text--centered{text-align:center}.u-flex{align-items:center;display:flex;flex-direction:row}.u-flex--start{align-items:flex-start}.u-link-plain:after{display:none}.u-flex--nowrap{flex-wrap:nowrap}.u-flex--justify-center{justify-content:center}.u-flex--justify-end{justify-content:flex-end}.u-distance-reset{margin-top:0!important}.u-distance-tiny{margin-top:8px}.u-distance-small{margin-top:16px}.u-distance{margin-top:24px}.u-distance-medium{margin-top:48px}.u-distance-large{margin-top:100px}.u-distance-bottom-reset{margin-bottom:0!important}.u-unflex{display:block}.u-text--bigger{font-size:2em;line-height:1}.u-text--small{font-size:var(--thtrm-small-fontsize)}.u-min-h1{min-height:712px}.u-img-fit-height{height:100%;-o-object-fit:cover;object-fit:cover;font-family:"object-fit: cover;"}.u-mega-padding-bottom{margin-bottom:200px}.u-offscreen-text{position:absolute;left:-5000px}.u-fill-space{height:100%;width:100%}.u-color--red{color:var(--thtrm-amc-red)}.u-color--pink{color:var(--thtrm-rxjs-pink)}.u-color--grey{color:var(--thtrm-color-lighttext)}.u-bg-lightgray{background-color:var(--thtrm-color-ultralightgray)}.u-bg--red{background-color:var(--thtrm-amc-red)}.u-bg--pink{background-color:var(--thtrm-rxjs-pink)}.u-bg--orange{background-color:var(--thtrm-git-orange)}.u-color--orange{color:var(--thtrm-git-orange)}@media screen and (min-width:50em){.u-max-width--half{max-width:50%;margin:0 auto;width:100%}}@media screen and (min-width:50em){.u-max-width--3-4{max-width:75%;margin:0 auto;width:100%}}</style><style data-href="/styles.246d67a4ef7e9adeefa5.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.15.21"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#384c54"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=50794189bf1d1bd3459211725d37e57e"/><title data-react-helmet="true">Taming snakes with reactive streams | Articles by thoughtram</title><meta data-react-helmet="true" name="description" content="Reactive Programming is revolutionary but it&#x27;s not always straightforward and requires a fundamental shift in mindset. In this post, we&#x27;ll re-implement a classic video game and transform a programmatic-event-loop into a reactive-event-driven app using RxJS. The goal is to completely avoid external state and embrace a functional reactive style."/><meta data-react-helmet="true" name="google-site-verification" content="o9eGPEgIETEqYGombq7NiQuBIB_qa6gz1yAL7PxKyK0"/><meta data-react-helmet="true" name="theme-color" content="#384c54"/><meta data-react-helmet="true" property="og:title" content="Taming snakes with reactive streams"/><meta data-react-helmet="true" property="og:description" content="Reactive Programming is revolutionary but it&#x27;s not always straightforward and requires a fundamental shift in mindset. In this post, we&#x27;ll re-implement a classic video game and transform a programmatic-event-loop into a reactive-event-driven app using RxJS. The goal is to completely avoid external state and embrace a functional reactive style."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="thoughtram"/><meta data-react-helmet="true" name="twitter:title" content="Taming snakes with reactive streams"/><meta data-react-helmet="true" name="twitter:description" content="Reactive Programming is revolutionary but it&#x27;s not always straightforward and requires a fundamental shift in mindset. In this post, we&#x27;ll re-implement a classic video game and transform a programmatic-event-loop into a reactive-event-driven app using RxJS. The goal is to completely avoid external state and embrace a functional reactive style."/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-6a14d6c49d22aa388ff9.js"/><link as="script" rel="preload" href="/styles-e0e38ca7b54561c3f057.js"/><link as="script" rel="preload" href="/commons-9a6c7e4a80f98fe6d0b9.js"/><link as="script" rel="preload" href="/app-db11fdec89ef44788bcc.js"/><link as="script" rel="preload" href="/webpack-runtime-c99afa6b532686815600.js"/><link as="fetch" rel="preload" href="/page-data/rxjs/2017/08/24/taming-snakes-with-reactive-streams.html/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="thtrm-page undefined"><header class="thtrm-banner" role="banner"><a href="https://thoughtram.io" title="Home"><img src="/static/logo-8fe34043fb96d58a991170a33702a469.svg" alt="thoughtram" class="thtrm-logo" title="The thoughtram logo"/></a></header><main class="thtrm-main" role="main"><nav class="thtrm-nav-toc"><a title="Back to Blog" href="/">← Back to Blog</a></nav><div style="margin:auto;text-align:center;min-height:30px" id="codefund"></div><script type="text/javascript" src="https://app.codefund.io/properties/723/funder.js" async=""></script><section class="thtrm-section u-distance-bottom-reset"><div class="thtrm-section__heading thtrm-article-header thtrm-section-constrained u-distance-bottom-reset"><div class="thtrm-metabar thtrm-article-header__metabar"><div class="thtrm-metabar__item thtrm-topic u-color--grey"><div class="thtrm-media-short"><img alt="Author" src="https://avatars0.githubusercontent.com/u/12571019?s=400&amp;v=4" class="thtrm-avatar"/><p class="thtrm-media-short__body"><a href="https://twitter.com/d3lm" class="u-link-plain">Dominic Elm</a></p></div></div><time dateTime="24 August 2017" class="thtrm-metabar__item thtrm-topic u-color--grey">24 August 2017</time><p class="thtrm-metabar__item thtrm-topic u-color--grey"><a class="u-link-plain" href="/categories/rxjs">Rxjs</a></p></div><h1 class="thtrm-section__subheading u-distance-tiny">Taming snakes with reactive streams</h1></div><div class="thtrm-ratio--stripe thtrm-article-thumb u-fill-space u-img-fit-height gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:62.5%"></div><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgAB/9oADAMBAAIQAxAAAAEjB66C2tL/xAAZEAEBAAMBAAAAAAAAAAAAAAABAgADEiH/2gAIAQEAAQUCnZhcMLS9mFe7Ke//xAAYEQACAwAAAAAAAAAAAAAAAAABAgMQQf/aAAgBAwEBPwFYwcr/xAAYEQACAwAAAAAAAAAAAAAAAAAAAhEhQf/aAAgBAgEBPwF2jSz/xAAdEAEAAQMFAAAAAAAAAAAAAAABAAIRIQMQIlGR/9oACAEBAAY/AuVMU02+2KQgdTFvJ//EABsQAAMBAQADAAAAAAAAAAAAAAABESFRMXGB/9oACAEBAAE/IVped9sIUNyF9q9YOhmMXSLWK+j/2gAMAwEAAgADAAAAEA/f/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQARIf/aAAgBAwEBPxBhxKDKJ//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQIBAT8QZGkRtp//xAAdEAEAAgICAwAAAAAAAAAAAAABESEAQYGRMWFx/9oACAEBAAE/EGxBNeRxkoFhMQdTjt/Kg4wwt6Uta910Yi4IMiIRqIxk7QErvP/Z" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/b83a1b71df86c3a486db7df269c1bc90/10bdc/reactive_snake.jpg 158w,
/static/b83a1b71df86c3a486db7df269c1bc90/f4ab0/reactive_snake.jpg 315w,
/static/b83a1b71df86c3a486db7df269c1bc90/30037/reactive_snake.jpg 630w,
/static/b83a1b71df86c3a486db7df269c1bc90/9810d/reactive_snake.jpg 945w,
/static/b83a1b71df86c3a486db7df269c1bc90/ff2e4/reactive_snake.jpg 1260w,
/static/b83a1b71df86c3a486db7df269c1bc90/14dee/reactive_snake.jpg 1920w" sizes="(max-width: 630px) 100vw, 630px" /><img loading="lazy" sizes="(max-width: 630px) 100vw, 630px" srcset="/static/b83a1b71df86c3a486db7df269c1bc90/10bdc/reactive_snake.jpg 158w,
/static/b83a1b71df86c3a486db7df269c1bc90/f4ab0/reactive_snake.jpg 315w,
/static/b83a1b71df86c3a486db7df269c1bc90/30037/reactive_snake.jpg 630w,
/static/b83a1b71df86c3a486db7df269c1bc90/9810d/reactive_snake.jpg 945w,
/static/b83a1b71df86c3a486db7df269c1bc90/ff2e4/reactive_snake.jpg 1260w,
/static/b83a1b71df86c3a486db7df269c1bc90/14dee/reactive_snake.jpg 1920w" src="/static/b83a1b71df86c3a486db7df269c1bc90/30037/reactive_snake.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></section><section class="thtrm-section thtrm-section-constrained thtrm-article u-distance"><div class="thtrm-section__heading u-distance-reset"><p>The web moves quickly and we all know it. Today, Reactive Programming is one of the hottest topics in web development and with frameworks like Angular or React, it has become much more popular especially in the modern JavaScript world. There’s been a massive move in the community from imperative programming paradigms to functional reactive paradigms. Yet, many developers struggle with it and are often overwhelmed by its complexity (large API), fundamental shift in mindset (from imperative to declarative) and the multitude of concepts.</p>
<p>While this is not always the easiest thing to do, once we get the hang of it we’ll ask ourselves <strong>how did we live without it?</strong></p>
<p>This article is not meant to be an introduction to reactive programming and if you are completely new to it, we recommend the following resources:</p>
<ul>
<li><a href="https://egghead.io/courses/introduction-to-reactive-programming">Introduction to Reactive Programming</a> by <a href="https://twitter.com/andrestaltz">André Staltz</a></li>
<li><a href="https://www.youtube.com/watch?v=3LKMwkuK0ZE">RxJS 5 Thinking Reactively</a> by <a href="https://twitter.com/BenLesh">Ben Lesh</a></li>
<li><a href="https://chrisnoring.gitbooks.io/rxjs-5-ultimate/content/">RxJS 5 Ultimate</a> by <a href="https://twitter.com/chris_noring">Chris Noring</a></li>
<li><a href="https://www.learnrxjs.io/">Learn RxJS</a> by <a href="https://twitter.com/btroncone">Brian Troncone</a></li>
<li><a href="https://gist.github.com/btroncone/d6cf141d6f2c00dc6b35">RxJS 5 Operators By Example</a> by <a href="https://twitter.com/btroncone">Brian Troncone</a></li>
</ul>
<p>The goal of this post is to learn how to think reactively by building a classic video game that we all know and love - Snake. That’s right, a video game! They are fun but complex systems that keep a lot of external state, e.g. scores, timers, or player coordinates. For our version, we’ll make heavy use of Observables and use several different operators to completely avoid external state. At some point it might be tempting to store state outside of the Observable pipeline but remember, we want to embrace reactive programming and don’t rely on a single external variable that keeps state.</p>
<p><strong>Note</strong>: We’ll solely use <strong>HTML5</strong> and <strong>JavaScript</strong> together with <a href="http://reactivex.io/rxjs/">RxJS</a> to transform a programmatic-event-loop into a reactive-event-driven app.</p>
<p>The code is available on <a href="https://github.com/thoughtram/reactive-snake">Github</a> and a live demo can be found <a href="https://stackblitz.com/edit/reactive-snake?file=main.ts">here</a>. I encourage you to clone the project, fiddle with it and implement cool new game features. If you do, ping me on <a href="https://twitter.com/elmd_">Twitter</a>.</p>
<h2>The game</h2>
<p>As mentioned earlier, we are going to re-create Snake, a classic video game from the late 1970s. But instead of simply copying the game, we add a little bit of variation to it. Here’s how the game works.</p>
<p>As a player you control a line that resembles a hungry snake. The goal is to eat as many apples as you can to grow as long as possible. The apples can be found at random positions on the screen. Each time the snake eats an apple, its tail grows longer. Walls will not stop you! But listen up, you must try to avoid hitting your own trail at all costs. If you don’t, the game is over. How long can you survive?</p>
<p>Here’s a preview of what we are going to build:</p>
<p><img src="/1d466be0730556c40940e413ecf7b04f/snake_preview.gif" alt="button state machine"></p>
<p>For this specific implementation the snake is represented as a line of blue squares where its head is painted in black. Can you tell how the fruits look? Exactly, red squares. Everything is a square and that’s not because they look so beautiful but they are very simple geometric shapes and easy to draw. The graphics are not very shiny but hey, it’s about making the shift from imperative programming to reactive programming and not about game art.</p>
<h2>Setting up the stage</h2>
<p>Before we can start with the game’s functionality, we need set up a <code class="language-text">&lt;canvas&gt;</code> element that gives us powerful drawing APIs from within JavaScript. We’ll use the canvas to draw our graphics including the playing area, the snake, the apples and basically everything we need for our game. In other words, the game will be rendered entirely on the <code class="language-text">&lt;canvas&gt;</code> element.</p>
<p>If this is completely new to you, check out <a href="https://egghead.io/courses/learn-html5-graphics-and-animation">this</a> course on egghead by Keith Peters.</p>
<p>The <code class="language-text">index.html</code> is quite simple because most of the <em>magic</em> happens with JavaScript.</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Reactive Snake<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/main.bundle.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></div>
<p>The script that we add to the body is essentially the output of the build process and contains all of our code. However, you may be wondering why there is no such <code class="language-text">&lt;canvas&gt;</code> element inside the <code class="language-text">&lt;body&gt;</code>. It’s because we’ll create that element using JavaScript. In addition, we add a few constants that define how many <code class="language-text">rows</code> and <code class="language-text">columns</code> we have as well as the <code class="language-text">width</code> and <code class="language-text">height</code> of the canvas.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">COLS</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ROWS</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">GAP_SIZE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CELL_SIZE</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">=</span> <span class="token constant">COLS</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token constant">CELL_SIZE</span> <span class="token operator">+</span> <span class="token constant">GAP_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">=</span> <span class="token constant">ROWS</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token constant">CELL_SIZE</span> <span class="token operator">+</span> <span class="token constant">GAP_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createCanvasElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> canvas<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>With that in place we can call this function, create a <code class="language-text">&lt;canvas&gt;</code> element on the fly and append it to the <code class="language-text">&lt;body&gt;</code> of our page:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> canvas <span class="token operator">=</span> <span class="token function">createCanvasElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Note that we are also getting a reference to the <code class="language-text">CanvasRenderingContext2D</code> by calling <code class="language-text">getContext(&#39;2d&#39;)</code> on the <code class="language-text">&lt;canvas&gt;</code> element. This 2D rendering context for the canvas allows us to draw for example rectangles, text, lines, paths and much more.</p>
<p>We’re good to go! Let’s start working on the core mechanics of the game.</p>
<h2>Identifying the source streams</h2>
<p>From the preview and the game description we know that we need the following features:</p>
<ul>
<li>Navigate the snake using the arrow keys</li>
<li>Keep track of the player’s score</li>
<li>Keep track of the snake (includes eating and moving)</li>
<li>Keep track of the apples on the field (includes generating new apples)</li>
</ul>
<p>In reactive programming it’s all about programming with data streams, streams of input data. Conceptually, when a reactive program is executed, it sets up an observable pipeline that acts upon changes, e.g. a user has interacted with the application by pressing a key on the keyboard or simply a tick of an interval. So it’s all about figuring out <strong>what can change</strong>. Those <em>changes</em> often define the <strong>source streams</strong>. The key is to come up with the streams that represent the <strong>primary source of change</strong> and then compose them together to calculate whatever you need, e.g. the game state.</p>
<p>Let’s try to find our source streams by looking at the featurs above.</p>
<p>First of all, user input is definitely something that will change over time. The player navigates the hungry snake using the arrow keys. That means our first source stream is <code class="language-text">keydown$</code> which will emit values whenever a key is pressed down.</p>
<p>Next we need to keep track of the player’s score. The score basically depends on how many apples the snake has eaten. We could say that the score depends on the length of the snake because whenever the snake grows we want to increase the score by <code class="language-text">1</code>. Therefore, our next source stream is <code class="language-text">snakeLength$</code>.</p>
<p>Again, it is important to figure out the <strong>main</strong> sources from which we can compute whatever you need, e.g. the score. In most cases, the source streams are combined and refined into more concrete streams of data. We’ll see this in action in a minute. For now, let’s continue with identifying our main source streams.</p>
<p>So far, we got the user input and the score in place. What’s left are the more <strong>game-facing</strong> or <strong>interactive</strong> streams, such as the snake or the apples.</p>
<p>Let’s start with the snake. The core mechanic of the snake is simple; it moves over time and the more apples it eats the bigger it grows. But what exactly is the <strong>source</strong> of the snake? For now, we can forget about the fact that it eats and grows because what matters is that it primarily depends on a <strong>time factor</strong> as it moves <strong>over time</strong>, e.g. <code class="language-text">5</code> pixels every <code class="language-text">200ms</code>. So our source stream is an interval that produces a value after each period and we call this <code class="language-text">ticks$</code>. This stream also determines the speed of our snake.</p>
<p>Last but not least the apples. With everyting else in place, the apples are farily easy. This stream basically depends on the snake. Everytime the snake moves we check whether the head collides with an apple or not. If it does, we remove that apple and generate a new one at a random position on the field. That said, we don’t need to introduce a new source stream for the apples.</p>
<p>Great, that’s it for the source streams. Here’s a brief overview of the all source streams we need for our game:</p>
<ul>
<li><code class="language-text">keydown$</code>: keydown events (KeyboardEvent)</li>
<li><code class="language-text">snakeLength$</code>: represents the length of the snake (Number)</li>
<li><code class="language-text">ticks$</code>: interval that represents the pace of the snake (Number)</li>
</ul>
<p>These source streams build the basis for our game from which we can calculate all other values we need including the score, snake and apples.</p>
<p>In the next sections we’ll look closely at how to implement each of these source streams and compose them to generate the data we need.</p>
<h2>Steering the snake</h2>
<p>Let’s dive right into code and implement the steering mechanism for our snake. As mentioned in the previous section the steering depends on keyboard inputs. Turns out it’s deceptively simple and the first step is to create an observable sequence from keyboard events. For this we can leverage the <code class="language-text">fromEvent()</code> operator:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> keydown$ <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">'keydown'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>This is our very first source stream and it will emit a <code class="language-text">KeyboardEvent</code> everytime the user presses down a key. Note that literally every <code class="language-text">keydown</code> event is emitted. Therefore, we also get events for keys that we are not really interested in and that’s basically everything else but the arrow keys. But before we tackle this specific issue, we define a constant map of directions:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span>
  x<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  y<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Directions</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token punctuation">:</span> number<span class="token punctuation">]</span><span class="token punctuation">:</span> Point2D<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">DIRECTIONS</span><span class="token punctuation">:</span> Directions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">37</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// Left Arrow</span>
  <span class="token number">39</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// Right Arrow</span>
  <span class="token number">38</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// Up Arrow</span>
  <span class="token number">40</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>   <span class="token comment">// Down Arrow</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>By looking at the <code class="language-text">KeyboardEvent</code> object it appears that every key has a unique <code class="language-text">keyCode</code>. In order to get the codes for the arrow keys we can use <a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode">this</a> table.</p>
<p>Each direction is of type <code class="language-text">Point2D</code> which is simply an object with an <code class="language-text">x</code> and <code class="language-text">y</code> property. The value for for each property can either be <code class="language-text">1</code>, <code class="language-text">-1</code> or <code class="language-text">0</code>, indicating where the snake should be heading. Later, we’ll use the direction to derive the new grid position for the snake’s head and tail.</p>
<h3>The direction$ stream</h3>
<p>So, we already have a stream for <code class="language-text">keydown</code> events and everytime the player presses down a key we need to <strong>map</strong> the value, which will be a <code class="language-text">KeyboardEvent</code>, to one of the direction vectors above. For that we can use the <code class="language-text">map()</code> operator to project each keyboard event to a direction vector.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> direction$ <span class="token operator">=</span> keydown$
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">:</span> KeyboardEvent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">DIRECTIONS</span><span class="token punctuation">[</span>event<span class="token punctuation">.</span>keyCode<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p>As mentioned earlier, we’ll receive <strong>every</strong> keydown event because we are not filtering out the ones that we are not interested in, such as the character keys. However, one could argue that we are already filtering out events by looking them up in the directions map. For every <code class="language-text">keyCode</code> that is not defined in that map it will return <code class="language-text">undefined</code>. Nevertheless, that’s not really filtering out values on the stream which is why we can use the <code class="language-text">filter()</code> operator to only pipe through desired values.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> direction$ <span class="token operator">=</span> keydown$
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">:</span> KeyboardEvent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">DIRECTIONS</span><span class="token punctuation">[</span>event<span class="token punctuation">.</span>keyCode<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">direction</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>direction<span class="token punctuation">)</span></code></pre></div>
<p>Ok, that was easy. The code above is perfectly fine and works as expected. However, there’s still some room for improvement. Can you think of something?</p>
<p>Well, one thing is that we want to prevent the snake from going into the opposite direction, e.g. from right to left or up and down. It doesn’t really make sense to allow such behavior because the number one rule is to avoid hitting your own trail, remember?</p>
<p>The solution is fairly easy. We cache the previous direction and when a new event is emitted we check if the new direction is not equal to the opposite of the last one. Here’s a function that calculates the <code class="language-text">next</code> direction:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextDirection</span><span class="token punctuation">(</span><span class="token parameter">previous<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token function-variable function">isOpposite</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">previous<span class="token punctuation">:</span> Point2D<span class="token punctuation">,</span> next<span class="token punctuation">:</span> Point2D</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> next<span class="token punctuation">.</span>x <span class="token operator">===</span> previous<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> next<span class="token punctuation">.</span>y <span class="token operator">===</span> previous<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isOpposite</span><span class="token punctuation">(</span>previous<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> previous<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> next<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This is the first time we are tempted to store state outside of the Observable pipeline because we somehow need to keep track of the previous direction right? An easy solution is to simply keep the previous direction in an external state variable. But wait! We wanted to avoid this, right?</p>
<p>To avoid external state, we need a way to sort of aggregate infinite Observables. RxJS has a very convenient operator we can use to solve our problem - <code class="language-text">scan()</code>.</p>
<p>The <code class="language-text">scan()</code> operator is very similar to <code class="language-text">Array.reduce()</code> but instead of only returning the last value, it emits each intermediate result. With <code class="language-text">scan()</code> we can basically accumulate values and reduce a stream of incoming events to a single value infinitely. This way we can keep track of the previous direction without relying on external state.</p>
<p>Let’s apply this and take a look at our final <code class="language-text">direction$</code> stream:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> direction$ <span class="token operator">=</span> keydown$
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">:</span> KeyboardEvent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">DIRECTIONS</span><span class="token punctuation">[</span>event<span class="token punctuation">.</span>keyCode<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">direction</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>direction<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span>nextDirection<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">startWith</span><span class="token punctuation">(</span><span class="token constant">INITIAL_DIRECTION</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">distinctUntilChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Notice that we are using <code class="language-text">startWith()</code> to emit an inital value before beginning to emit values from the source Observable (<code class="language-text">keydown$</code>). Without this operator our Observable would start emitting only when the player presses a key.</p>
<p>The second improvement is to <em>only</em> emit values when the emitted direction is different from the previous one. In other words, we only want <strong>distinct</strong> values. You might have noticed <code class="language-text">distinctUntilChanged()</code> in the snippet above. This operator does the dirty work for us and suppresses duplicate items. Note that <code class="language-text">distinctUntilChanged()</code> only filters out identical values unless a different one is emitted in between.</p>
<p>The following figure visualizes our <code class="language-text">direction$</code> stream and how it works. Values painted in blue represent initial values, yellow means the value was changed on the Observable pipeline and values emitted on the <strong>result</strong> stream are colored orange.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e841bbf5ae1fe9e7334b04e1f35e3b2d/a7a94/snake_direction.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 73.8121546961326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC70lEQVQoz01S22obVxTVP/W1T/2IlkJeAoVAKZSCKeQhDQ2FPOShBCduRWtya6Fpi0MLVuqmxrawnUiyZcmyNNJII83lXPa5zEVzs2asaHpkQt31sDhs2HuvdfYqdbtdTdMA4HyWFhfFy355vbGyM/r5h/rnVeN5ufHZ/nhjrX6jbm0+bHxSm1RWa9ePzL/vvf7QlV4pjuMkSRT7vhcG0Qh3zqw3E6J1zEOTDk4n+yO7155UbWa0zaoNRmuyh2DcNLaXzYvFoiiKKIowJpRiwRMpMsEjKfIl80zrmRSngk8lzzkLXJFzHrhyzhgrFZdQI2azNMsLl1UYWvf4DnPKnqhy5ztPHIK9Grh1ie974og533qiyZy7YZhcNcdxmJ4X1H7mjL4B9MIZ3mboT2d4S8KWNbgp4R9ufQl429FXAO8i/VPB3XeylWfkIIwRUA8gpIppqN4EBycnXeT4hAgHeZS6QCOgEmisTL7bnGWZ7/vhNCLcsugQBLKofskDh0wM3JtOp2EYgsAm7XNJx6QXBMGV7OWp3havjB9/OrtZNX950lk5MH9/dPrFMak8bF6/yN4W86KBNsvtG017e7V1zXeDq81SSt8LbDoeIw2DNUI9DLaBuoapa2bLW8JXlaFzRhke2G1X/s8zVpYJluB7EAnwfRYB+JTGo/5YoClVZyRYgOuzhIMbsJT+51khz7NiUdScPyrDtTZ59UJfDVjFte6c8de/9u7M84Uy1WMHG/27A2g8738VR8lys8J8PvenQRLlx+bWjv6s4+xtDZ54rCrschfXX/bX0mR2Hmcarv3V/14nrc3BgyvZy59UmhlhLJQ85WwqWNo4Oq0fac3jTvvEqNVqhjHizFcJA8IkCQghpewSF3mmI9ac8IAOYNzwYAz6QXSZe4mHSNsLozhJZz43qV6N0zRJVKCjUqvVarbaEcf3dvWPNybe7tfObx+R/fv20w/CWCkt4PCB/fj9KMmiWQGNx3j9PTdQM2PG4F9mkw/iLStLswAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="snake direction"
        title="snake direction"
        src="/static/e841bbf5ae1fe9e7334b04e1f35e3b2d/8ff1e/snake_direction.png"
        srcset="/static/e841bbf5ae1fe9e7334b04e1f35e3b2d/9ec3c/snake_direction.png 200w,
/static/e841bbf5ae1fe9e7334b04e1f35e3b2d/c7805/snake_direction.png 400w,
/static/e841bbf5ae1fe9e7334b04e1f35e3b2d/8ff1e/snake_direction.png 800w,
/static/e841bbf5ae1fe9e7334b04e1f35e3b2d/6ff5e/snake_direction.png 1200w,
/static/e841bbf5ae1fe9e7334b04e1f35e3b2d/2f950/snake_direction.png 1600w,
/static/e841bbf5ae1fe9e7334b04e1f35e3b2d/a7a94/snake_direction.png 1810w"
        sizes="(max-width: 800px) 100vw, 800px"
        loading="lazy"
      />
  </a>
    </span></p>
<h2>Keeping track of the length</h2>
<p>Before we implement the snake itself, let’s come up with an idea to keep track of its length. Why do we need the length in the first place? Well, we use that information to model the score. It’s right that in an imperative world we’d simply check if there was a collision whenever the snake moves and if that’s the case we increase the score. So there is actually no need to keep track of the length. However, it would introduce yet another external state variable which we want to avoid at all costs.</p>
<p>In a reactive world it’s a bit different. One naive approach could be to use the <code class="language-text">snake$</code> stream and every time it emits a value we know that the snake has grown in length. While it really depends on the implementation of <code class="language-text">snake$</code>, this is not how we’ll implement it. From the beginning we know that it depends on <code class="language-text">ticks$</code> as it moves a certain distance over time. As such, <code class="language-text">snake$</code> will accumulate an array of body segments and because it’s based on <code class="language-text">ticks$</code> it will generate a value every <code class="language-text">x</code> milliseconds. That said, even if the snake does not collide with anything, <code class="language-text">snake$</code> will still produce distinct values. That’s because the snake is constantly moving on the field and therefore the array will always be different.</p>
<p>This can be a bit tricky to grasp because there are some peer dependencies between the different streams. For example <code class="language-text">apples$</code> will depend on <code class="language-text">snake$</code>. The reason for this is that, everytime the snake moves we need the array of body segments to check if any of these pieces collides with an apple. While the <code class="language-text">apples$</code> stream itself will accumulate an array of apples, we need a mechanism to model collisions that, at the same time, avoids a circular dependency.</p>
<h3>BehaviorSubject to the rescue</h3>
<p>The solution to this is that we’ll implement a <em>broadcasting</em> mechanism using a <code class="language-text">BehaviorSubject</code>. RxJS offers different types of Subjects with different functionalities. As such, the <code class="language-text">Subject</code> class provides the base for creating more specialized Subjects. In a nutshell, a Subject is a type that implements both <code class="language-text">Observer</code> and <code class="language-text">Observable</code> types. Observables define the data flow and produce the data while Observers can subscribe to Observables and receive the data.</p>
<p>A <code class="language-text">BehaviorSubject</code> is a more specialized Subject that represents a value that changes over time. Now, when an Observer subscribes to a <code class="language-text">BehaviorSubject</code>, it will receive the last emitted value and then all subsequent values. Its uniqueness lies in the fact that it requires a <strong>starting value</strong>, so that all Observers will at least receive one value on subscription.</p>
<p>Let’s go ahead and create a new <code class="language-text">BehaviorSubject</code> with an initial value of <code class="language-text">SNAKE_LENGTH</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// SNAKE_LENGTH specifies the inital length of our snake</span>
<span class="token keyword">let</span> length$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject</span><span class="token operator">&lt;</span>number<span class="token operator">></span><span class="token punctuation">(</span><span class="token constant">SNAKE_LENGTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>From here it’s only a small step to implement <code class="language-text">snakeLength$</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> snakeLength$ <span class="token operator">=</span> length$
  <span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">step<span class="token punctuation">,</span> snakeLength</span><span class="token punctuation">)</span> <span class="token operator">=></span> snakeLength <span class="token operator">+</span> step<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">share</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>In the code above we can see that <code class="language-text">snakeLength$</code> is based on <code class="language-text">length$</code> which is our <code class="language-text">BehaviorSubject</code>. This means that whenever we feed a new value to the Subject using <code class="language-text">next()</code>, it will be emitted on <code class="language-text">snakeLength$</code>. In addition, we use <code class="language-text">scan()</code> to accumulate the length over time. Cool, but you may be wondering what that <code class="language-text">share()</code> is all about, right?</p>
<p>As already mentioned, <code class="language-text">snakeLength$</code> will later be used as an input for <code class="language-text">snake$</code> but at the same time acts as a source stream for the player’s score. As a result, we would end up <strong>recreating</strong> that source stream with the second subscriptions to the same Observable. This happens because <code class="language-text">length$</code> is a <strong>cold</strong> Observable.</p>
<p>If you are completely new to hot and cold Observables, we have written an article on <a href="/angular/2016/06/16/cold-vs-hot-observables.html">Cold vs Hot Observables</a>.</p>
<p>The point is that, we use <code class="language-text">share()</code> to allow multiple subscriptions to an Observable that would otherwise recreate its source with every subscription. This operator automatically creates a Subject between the original source and all future subscribers. As soon as the number of subscribers goes from zero to one it will connect the Subject to the underlying source Observable and broadcast all its notifications. All future subscribers will be connected to that in-between Subject, so that effectively there’s just one subscription to the underlying cold Observable. This is called <strong>multicasting</strong> and will make you stand out on dinner parties.</p>
<p>Awesome! Now that we have a mechanism that we can use to broadcast values to multiple subscribers, we can go ahead and implement <code class="language-text">score$</code>.</p>
<h3>Implementing score$</h3>
<p>The player’s score is as simple as it can get. Equipped with <code class="language-text">snakeLength$</code> we can now create the <code class="language-text">score$</code> stream that simply accumulates the player’s score using <code class="language-text">scan()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> score$ <span class="token operator">=</span> snakeLength$
  <span class="token punctuation">.</span><span class="token function">startWith</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">score<span class="token punctuation">,</span> _</span><span class="token punctuation">)</span> <span class="token operator">=></span> score <span class="token operator">+</span> <span class="token constant">POINTS_PER_APPLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>We basically use <code class="language-text">snakeLength$</code> or rather <code class="language-text">length$</code> to notify subscribers that there’s been a collision and if there was, we just increase the score by <code class="language-text">POINTS_PER_APPLE</code>, a constant amount of points per apple. Note that <code class="language-text">startWith(0)</code> must be added before <code class="language-text">scan()</code> to avoid specifying a <em>seed</em> (initial accumulator value).</p>
<p>Let’s look at a more visual representation of what we just implemented:</p>
<p><img src="../assets/images/sname_length_and_score.png"></p>
<p>By looking at the figure above you may be wondering why the initial value of the <code class="language-text">BehaviorSubject</code> only shows up on <code class="language-text">snakeLength$</code> and is missing on <code class="language-text">score$</code>. That’s because the first subscriber will cause <code class="language-text">share()</code> to subscribe to the underlying data source and because the underlying data source immediately emits a value, the value has already passed by the time that the subsequent subscriptions has happened.</p>
<p>Sweet. With that in place, let’s implement the stream for our snake. Isn’t this exciting?</p>
<h2>Taming the snake$</h2>
<p>So far, we have learned a bunch of operators and we can use them to implement our <code class="language-text">snake$</code> stream. As discussed in the beginning of this post, we need some sort of <em>ticker</em> that keeps our hungry snake moving. Turns out there’s a handy operator for that called <code class="language-text">interval(x)</code> which emits a value every <code class="language-text">x</code> milliseconds. We’ll call each value <em>tick</em>.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> ticks$ <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token constant">SPEED</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>From here it’s only a small stretch to the final <code class="language-text">snake$</code> stream. For every <em>tick</em>, depending on whether the snake has eaten an apple, we want to either move it foward or add new segment. Therefore, we can use the all so familiar <code class="language-text">scan()</code> operator to accumulate an array of body segments. But, as you may have guessed, we’re facing a problem. Where’s the <code class="language-text">direction$</code> or <code class="language-text">snakeLength$</code> stream coming into play?</p>
<p>Absolutely legitimate question to ask. The direction nor the snake’s length is easily accessible from within our <code class="language-text">snake$</code> stream unless we kept those information in a variable outside of the Observable pipeline. But again, we would be breaking our rule of not modifying external state.</p>
<p>Luckily, RxJS offers yet another very convenient operator called <code class="language-text">withLatestFrom()</code>. It’s an operator used to combine streams and that’s exactly what we’re looking for. This operator is applied to a <em>primary</em> source that controls when data is emitted on the result stream. In other words, you can think of <code class="language-text">withLatestFrom()</code> as a way to <strong>throttle</strong> the output of a secondary stream.</p>
<p>With the above, we have the tools we need to finally implement the hungry <code class="language-text">snake$</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> snake$ <span class="token operator">=</span> ticks$
  <span class="token punctuation">.</span><span class="token function">withLatestFrom</span><span class="token punctuation">(</span>direction$<span class="token punctuation">,</span> snakeLength$<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> direction<span class="token punctuation">,</span> snakeLength</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>direction<span class="token punctuation">,</span> snakeLength<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span>move<span class="token punctuation">,</span> <span class="token function">generateSnake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">share</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Our <em>primary</em> source is <code class="language-text">ticks$</code> and whenever a new value comes down the pipe, we take the latest
values from both <code class="language-text">direction$</code> and <code class="language-text">snakeLength$</code>. Note that even if the <em>secondary</em> streams frequently emit values, for example if the player is smashing his head on the keyboard, we’d only be proccessing the data for each <em>tick</em>.</p>
<p>In addition, we are passing a <strong>selector</strong> function to <code class="language-text">withLatestFrom</code> which is invoked when the <em>primary</em> stream produces a value. This function is optional and if omitted, a list with all elements is yielded.</p>
<p>We’ll leave out the explanation for the <code class="language-text">move()</code> function as the primary goal of this post is to facilitate the fundamental shift in mindset. Nonetheless, you can find the source code for this on <a href="https://github.com/d3lm/reactive-snake/blob/master/src/utils.ts#L25-L45">GitHub</a>.</p>
<p>Here’s a figure that visually demonstrates the code above:</p>
<p><img src="../assets/images/sname_stream.png"></p>
<p>See how we <em>throttle</em> <code class="language-text">direction$</code>? The point is that <code class="language-text">withLatestFrom()</code> is very practical when you want to <strong>combine</strong> multiple streams and you are not interested in producing values on the Observable pipeline when <strong>either</strong> of the streams emit data.</p>
<h2>Generating apples</h2>
<p>You may notice that implementing our core building blocks for the game becomes easier as we learn more and more operators. If you made it so far then the rest is going to be easy peasy.</p>
<p>So far we have implemented a couple of streams such as <code class="language-text">direction$</code>, <code class="language-text">snakeLength$</code>, <code class="language-text">score$</code> and <code class="language-text">snake$</code>. If we combine them together we could already navigate that beast of snake around. But what is this game if there’s nothing to devour. Quite boring.</p>
<p>Let’s generate some apples to satisfy our snake’s appetite. First, let’s clarify what the state we need to preserve. Well, it could either be a single object or an array of objects. For our implementation we go with an array of apples. You hear the bells ringing?</p>
<p>Right, we can use <code class="language-text">scan()</code> again to accumulate an array of apples. We start with an initial value and every time the snake moves, we check if there was a collision. If that’s the case, we generate a new apple and return a <strong>new</strong> array. This way we can leverage <code class="language-text">distinctUntilChanged()</code> to filter out identical values.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> apples$ <span class="token operator">=</span> snake$
  <span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span>eat<span class="token punctuation">,</span> <span class="token function">generateApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">distinctUntilChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">share</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Cool! This means that whenever <code class="language-text">apples$</code> produces a new value we can assume that our snake has devoured one of those tasty fruits. What’s left is to increase to score and also notify other streams about this event, such as <code class="language-text">snake$</code> that takes the latest value from <code class="language-text">snakeLength$</code> to figure out whether to add a new body segment.</p>
<h3>Broadcasting events</h3>
<p>Earlier we have implemented this <strong>broadcasting</strong> mechanism, remember? Let’s use that to trigger the desired actions. Here’s our code for <code class="language-text">eat()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token parameter">apples<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Point2D<span class="token operator">></span><span class="token punctuation">,</span> snake</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> head <span class="token operator">=</span> snake<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> apples<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>apples<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      apples<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// length$.next(POINTS_PER_APPLE);</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>apples<span class="token punctuation">,</span> <span class="token function">getRandomPosition</span><span class="token punctuation">(</span>snake<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> apples<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>A simple solution is to call <code class="language-text">length$.next(POINTS_PER_APPLE)</code> right inside that <code class="language-text">if</code> block. But then we’re facing a problem because we couldn’t extract this <em>utility</em> method into its own module (ES2015 module). In ES2015 modules are stored in files and there’s exactly one module per file. The goal is to organize our code in a way that is easy to maintain and to reason about.</p>
<p>A more <em>sophisticated</em> solution is to introduce yet another stream called <code class="language-text">applesEaten$</code>. This stream is based on <code class="language-text">apples$</code> and every time a new value is emitted on the stream, we’d like to perform some kind of <strong>action</strong>, calling <code class="language-text">length$.next()</code>. To do so we can use the <code class="language-text">do()</code> operator which will execute some piece of code for each <em>event</em>.</p>
<p>Sounds feasible. But, we somehow need to <strong>skip</strong> the first (initial) value emitted by <code class="language-text">apples$</code>. Otherwise we end up increasing the score right away which doesn’t make much sense as the game has just started. Turns out RxJS has an operator for that, namely <code class="language-text">skip()</code>.</p>
<p>The fact that <code class="language-text">applesEaten$</code> only acts as a <em>publisher</em> to notify other streams, there’s not going to be an Observer subscribing to this stream. Therefore, we have to <strong>manually</strong> subscribe.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> appleEaten$ <span class="token operator">=</span> apples$
  <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> length$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token constant">POINTS_PER_APPLE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Putting everything together</h2>
<p>At this point, we have implemented all core buildings blocks of our game and we are good to go to finally combine everything into one result stream - <code class="language-text">scene$</code>. For that we’ll use <code class="language-text">combineLatest</code>. It’s quite similar to <code class="language-text">withLatestFrom</code> but different in detail. First, let’s look at the code:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> scene$ <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">combineLatest</span><span class="token punctuation">(</span>snake$<span class="token punctuation">,</span> apples$<span class="token punctuation">,</span> score$<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">snake<span class="token punctuation">,</span> apples<span class="token punctuation">,</span> score</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> snake<span class="token punctuation">,</span> apples<span class="token punctuation">,</span> score <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Instead of throttling secondary streams, we are interested in an event whenever <strong>any</strong> of the <em>input</em> Observables produces a new value. The last argument is again a selector function and we are simply taking all the values and returning an object that represents our <strong>game state</strong>. The game state contains everything that needs to be rendered onto the canvas.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b5d4d10a33d804002fd42e7a2e3e75c2/b89ef/snake_scene.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 28.355457227138643%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFklEQVQY022NyUvDUBjE8//f1CqCp2gFN9SD0FK3UtPaYE3apHbJqy+mffuSkhgseIg+8CRkGD4YmPl9FlqSx/DiNjxujg6bgX0XnjyMzxpDuxUcNUd2K6zH7wmM4U+VrFRk9/O6CxsRHgI8egKXHXAOcDBFg+lqMMOvWmlKaVmWFWOKZGtiB3Ev5fmaF8/gxgHXmdxwygVVkmuEUJIkf+3yvyxBVDs6HS9dLdepyvuLRmd2Jdmacc6FwBibMSGk+nOefzKKlWRSMC35Konn07cYLpRgxmj1EUWRQRRFobU2QAMlQhmciVaabcTLAXa2aLdGuju0tyvcfXNpr4adbd7fK76+mcFjDADwPS8YT7xZ7PsehPAXZz49D3xUV+0AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="snake scene"
        title="snake scene"
        src="/static/b5d4d10a33d804002fd42e7a2e3e75c2/8ff1e/snake_scene.png"
        srcset="/static/b5d4d10a33d804002fd42e7a2e3e75c2/9ec3c/snake_scene.png 200w,
/static/b5d4d10a33d804002fd42e7a2e3e75c2/c7805/snake_scene.png 400w,
/static/b5d4d10a33d804002fd42e7a2e3e75c2/8ff1e/snake_scene.png 800w,
/static/b5d4d10a33d804002fd42e7a2e3e75c2/6ff5e/snake_scene.png 1200w,
/static/b5d4d10a33d804002fd42e7a2e3e75c2/2f950/snake_scene.png 1600w,
/static/b5d4d10a33d804002fd42e7a2e3e75c2/b89ef/snake_scene.png 2712w"
        sizes="(max-width: 800px) 100vw, 800px"
        loading="lazy"
      />
  </a>
    </span></p>
<h3>Maintaining performance</h3>
<p>Not only in games but but also for web applications we aim for performance. Performance can mean a lot but in terms of our game, we’d like to redraw the whole scene 60 times per second.</p>
<p>We can do that by introducing another stream similar to <code class="language-text">ticks$</code> but for rendering. Basically it’s another interval:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// Interval expects the period to be in milliseconds which is why we devide FPS by 1000</span>
Observable<span class="token punctuation">.</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">/</span> <span class="token constant">FPS</span><span class="token punctuation">)</span></code></pre></div>
<p>The problem is that JavaScript is single-threaded. The worst case is that we prevent the browser from doing anything so that it locks up. In other words, the browser may not be able to process all these updates quickly enough. The reason for this is that the browser is trying to render a frame and then it’s immediately asked to render the next one. As a result, it drops the current one to keep up the speed. That’s when animations start to look choppy.</p>
<p>Luckily, we can use <code class="language-text">requestAnimationFrame</code> allowing the browser to line up work and perform it at the most appropriate time. But how do we use it for our Observable pipeline? The good news is that many operators including <code class="language-text">interval()</code> take a <code class="language-text">Scheduler</code> as its last argument. In a nutshell, a <code class="language-text">Scheduler</code> is a mechanism to <strong>schedule</strong> some task to be performed in the future.</p>
<p>While RxJS offers a variety of Schedulers, the one that we’re interested in is called <code class="language-text">animationFrame</code>. This Scheduler performs a task when <code class="language-text">window.requestAnimationFrame</code> would fire.</p>
<p>Perfect! Let’s apply this to our interval and we’ll call the resulting Observable <code class="language-text">game$</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// Note the last parameter</span>
<span class="token keyword">const</span> game$ <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">/</span> <span class="token constant">FPS</span><span class="token punctuation">,</span> animationFrame<span class="token punctuation">)</span></code></pre></div>
<p>This interval will now produce values roughly every 16ms maintaining 60 FPS.</p>
<h3>Rendering the scene</h3>
<p>What’s left is to combine our <code class="language-text">game$</code> with the <code class="language-text">scene$</code>. Can you guess what operator we use for that? Remember, both streams emit at different intervals and the goal now is to render our scene onto the canvas, 60 times per second. We’ll use <code class="language-text">game$</code> as our <strong>primary</strong> stream and every time it emits a value we combine it with the <strong>latest</strong> value from <code class="language-text">scene$</code>. Sounds familiar? Yes, we can use <code class="language-text">withLatestFrom</code> again.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// Note the last parameter</span>
<span class="token keyword">const</span> game$ <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">/</span> <span class="token constant">FPS</span><span class="token punctuation">,</span> animationFrame<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withLatestFrom</span><span class="token punctuation">(</span>scene$<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> scene</span><span class="token punctuation">)</span> <span class="token operator">=></span> scene<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">takeWhile</span><span class="token punctuation">(</span><span class="token parameter">scene</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token function">isGameOver</span><span class="token punctuation">(</span>scene<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">scene</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">renderScene</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> scene<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">complete</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">renderGameOver</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>You may have spotted <code class="language-text">takeWhile()</code> in the code above. It’s another very useful operator that we can call on an exisiting Observable. It will return values from <code class="language-text">game$</code> <strong>until</strong> <code class="language-text">isGameOver()</code> returns <code class="language-text">true</code>.</p>
<p>That’s it! We have just implemented snake, fully reactively and without relying on any external state using nothing but Observables and operators provided by RxJS.</p>
<p>Here’s a <a href="https://stackblitz.com/edit/reactive-snake?file=main.ts" target="_blank" style="border-bottom: 0;">live demo</a> for you to play with.</p>
<h2>Future work</h2>
<p>The game is very basic and in a follow-up post we’ll extend it with various features, one of which is restarting the whole game. In addition we’ll look at how we could implement <strong>pause</strong> and <strong>resume</strong> as well as different <strong>levels</strong> of difficulty.</p>
<p>Stay tuned!</p>
<h2>Special Thanks</h2>
<p>Special thanks to <a href="https://twitter.com/MrJamesHenry">James Henry</a> and <a href="https://twitter.com/brechtbilliet">Brecht Billiet</a> for their help with the code.</p></div></section><section class="thtrm-section"><div class="thtrm-section__heading thtrm-article-header thtrm-section-constrained u-distance-reset"><div class="thtrm-metabar thtrm-article-header__metabar"><div class="thtrm-metabar__item thtrm-topic u-color--grey"><div class="thtrm-media-short">Written by  <img alt="Author" src="https://avatars0.githubusercontent.com/u/12571019?s=400&amp;v=4" class="thtrm-avatar"/><p class="thtrm-media-short__body"><a href="https://twitter.com/d3lm" class="u-link-plain">Dominic Elm</a></p></div></div></div></div></section></main><footer class="thtrm-footer" role="contentinfo"><div class="thtrm-copyright"><p>© <!-- -->2024<!-- --> The thoughtram Blog Maintainers</p></div></footer><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" hidden=""><symbol viewBox="0 0 24 24" id="icon--chevron-right"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path><path d="M0 0h24v24H0z" fill="none"></path></symbol><symbol viewBox="0 0 24 24" id="icon--chevron-down"><path d="M7.41 7.84L12 12.42l4.59-4.58L18 9.25l-6 6-6-6z"></path><path d="M0-.75h24v24H0z" fill="none"></path></symbol><symbol viewBox="0 0 24 24" id="icon--menu"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path><path d="M0 0h24v24H0z" fill="none"></path></symbol></svg></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-51360648-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/rxjs/2017/08/24/taming-snakes-with-reactive-streams.html";window.webpackCompilationHash="0c5d630095500f933ccd";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-db11fdec89ef44788bcc.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-6a14d6c49d22aa388ff9.js"],"component---src-templates-category-js":["/component---src-templates-category-js-4376524bed80ab31f5c7.js"],"component---src-pages-404-js":["/component---src-pages-404-js-6a74e57e5569370f5224.js"],"component---src-pages-all-js":["/component---src-pages-all-js-7aa251af6b402c5bb6a7.js"],"component---src-pages-confirmation-thank-you-js":["/component---src-pages-confirmation-thank-you-js-e20b16d362e2acd832ef.js"],"component---src-pages-finish-newsletter-subscription-js":["/component---src-pages-finish-newsletter-subscription-js-9bc9dd352c7e25398f2b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-34313bc70d6e2470e416.js"]};/*]]>*/</script><script src="/webpack-runtime-c99afa6b532686815600.js" async=""></script><script src="/app-db11fdec89ef44788bcc.js" async=""></script><script src="/commons-9a6c7e4a80f98fe6d0b9.js" async=""></script><script src="/styles-e0e38ca7b54561c3f057.js" async=""></script><script src="/component---src-templates-blog-post-js-6a14d6c49d22aa388ff9.js" async=""></script></body></html>