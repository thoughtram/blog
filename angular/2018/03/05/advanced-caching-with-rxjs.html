<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/commons.743a077edf8bbf03e9ea.css">/*! normalize.css v7.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}:root{--thtrm-color-darkblue:#456474;--thtrm-color-midblue:#4c91a7;--thtrm-color-blue:#69caff;--thtrm-color-lighterblue:#dbe8ec;--thtrm-color-teal:#42899b;--thtrm-color-lightblue:#72c7df;--thtrm-color-text:#000;--thtrm-color-lighttext:#7d7d7d;--thtrm-color-gray:#eee;--thtrm-color-lightgray:#f8f8f9;--thtrm-color-ultralightgray:#fbfbfb;--thtrm-color-white:#fff;--thtrm-rustforjs-yellow:#ffd45e;--thtrm-amc-red:#dd0031;--thtrm-git-orange:#de4c36;--thtrm-rxjs-pink:#b7178c;--thtrm-border-color:var(--thtrm-color-gray);--thtrm-base-font:Roboto;--thtrm-base-font-stack:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";--thtrm-base-fontweight:500;--thtrm-base-fontsize:19px;--thtrm-small-fontsize:calc(0.85*var(--thtrm-base-fontsize));--thtrm-nav-fontsize:calc(1*var(--thtrm-base-fontsize));--thtrm-h1-fontszize:calc(1.75*var(--thtrm-base-fontsize));--thtrm-h2-fontszize:calc(1.5*var(--thtrm-base-fontsize));--thtrm-h3-fontszize:calc(1.3*var(--thtrm-base-fontsize));--thtrm-h4-fontszize:calc(1.1*var(--thtrm-base-fontsize));--thtrm-page-margin:5vw;--thtrm-page-neg-margin:-5vw;--thtrm-layer-submarine:-1;--thtrm-layer-deco:9;--thtrm-layer-navigation:99;--thtrm-layer-surface:99999999999}@font-face{font-family:Roboto;font-style:normal;font-weight:300;src:local("Roboto"),local("Roboto")}@font-face{font-family:Roboto;font-weight:500;src:local("Roboto Medium"),local("Roboto Medium")}@font-face{font-family:Roboto;font-style:italic;font-weight:500;src:local("Roboto Medium Italic"),local("Roboto-MediumItalic")}*,:after,:before{box-sizing:border-box;margin:0;padding:0}html{font-family:var(--thtrm-base-font),var(--thtrm-base-font-stack);font-size:var(--thtrm-base-fontsize);font-weight:var(--thtrm-base-fontweight);line-height:1.45;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{position:relative}h1,h2,h3,h4{font-weight:var(--thtrm-bold-fontweight);line-height:1.2;letter-spacing:0;margin:0}h1{font-size:var(--thtrm-h1-fontszize)}a{color:var(--thtrm-color-midblue);text-decoration:none}.thtrm-page--yellow a{color:#000}a:after{color:currentColor;content:"\203A";font-weight:400;font-size:1.15em;margin-left:.25em}a[title=Home]:after{display:none}img{width:100%;height:auto}@media screen and (min-width:80em){:root{--thtrm-base-fontsize:25px;--thtrm-small-fontsize:calc(0.75*var(--thtrm-base-fontsize));--thtrm-nav-fontsize:calc(1*var(--thtrm-base-fontsize));--thtrm-h1-fontszize:calc(2.25*var(--thtrm-base-fontsize));--thtrm-h2-fontszize:calc(2*var(--thtrm-base-fontsize));--thtrm-page-margin:10vw;--thtrm-page-neg-margin:-10vw}}@media screen and (min-width:120em){:root{--thtrm-base-fontsize:27px}}.thtrm-page{padding-left:5vw;padding-right:5vw;overflow-x:hidden}.thtrm-page.thtrm-page--yellow{background-color:var(--thtrm-rustforjs-yellow)}.thtrm-banner{display:flex;align-items:center;justify-content:space-between;height:90px}@media screen and (min-width:80em){.thtrm-page{padding-left:10vw;padding-right:10vw}.thtrm-banner{height:160px}}@media screen and (min-width:120em){.thtrm-page{padding-left:10vw;padding-right:10vw}.thtrm-banner{height:260px}}@supports (display:grid){.thtrm-page{display:grid;grid-template-columns:[pad-left] 5vw [center] 90vw [pad-left] 5vw;grid-template-rows:[banner] 90px [main] auto [aside] auto [footer] auto;padding-left:0;padding-right:0}@media screen and (min-width:80em){.thtrm-page{grid-template-columns:[pad-left] 10vw [center] 80vw [pad-left] 10vw;grid-template-rows:[banner] 160px [main] auto [aside] auto [footer] auto}}@media screen and (min-width:120em){.thtrm-page{grid-template-columns:[pad-left] 10vw [center] 80vw [pad-left] 10vw;grid-template-rows:[banner] 260px [main] auto [aside] auto [footer] auto}}.thtrm-banner{height:auto;grid-row-start:1;grid-row-end:1}.thtrm-banner,.thtrm-main{grid-column-start:2;grid-column-end:2}.thtrm-main{grid-row-start:2;grid-row-end:2}.thtrm-aside{grid-row-start:3;grid-row-end:3}.thtrm-aside,.thtrm-footer{grid-column-start:2;grid-column-end:2}.thtrm-footer{grid-row-start:4;grid-row-end:4}}.thtrm-banner{position:relative}.thtrm-footer{border-top:5px solid var(--thtrm-color-text);font-size:var(--thtrm-small-fontsize);padding:2rem 0;margin-top:2rem}.thtrm-footer .thtrm-sitemap{margin-bottom:2rem}.thtrm-footer .thtrm-sitemap__heading{font-size:var(--thtrm-base-fontsize);margin-top:1rem;margin-bottom:.5rem}.thtrm-footer .thtrm-copyright{display:flex;align-items:center;justify-content:space-between}.thtrm-footer .thtrm-sitemap nav ul{list-style:none}.thtrm-footer .thtrm-sitemap nav li a{text-decoration:none}.thtrm-footer .thtrm-sitemap nav li a:after{color:currentColor;content:"\203A";font-weight:400;font-size:1.15em;margin-left:.25em}@media screen and (min-width:31.5em){.thtrm-footer .thtrm-sitemap{display:grid;grid-template-columns:33.33333333333% 33.33333333333% 33.33333333333%;margin-bottom:2rem}.thtrm-footer .thtrm-sitemap__item{-ms-grid-column-span:1}.thtrm-footer .thtrm-sitemap__item:first-of-type{-ms-grid-column:1}.thtrm-footer .thtrm-sitemap__item:nth-of-type(2){-ms-grid-column:2}.thtrm-footer .thtrm-sitemap__item:nth-of-type(3){-ms-grid-column:3}.thtrm-footer .thtrm-sitemap__heading{margin-top:0;margin-bottom:1rem}}.thtrm-box{background-color:var(--thtrm-color-midblue);color:var(--thtrm-color-white);font-size:var(--thtrm-small-fontsize);padding:1.5rem;width:100%}.thtrm-box--light{background-color:var(--thtrm-color-lightblue)}.thtrm-box--red{background-color:var(--thtrm-amc-red)}.thtrm-box--red,.thtrm-box--white{box-shadow:0 2px 24px 0 rgba(0,0,0,.04)}.thtrm-box--white{background-color:var(--thtrm-color-white);color:var(--thtrm-color-text)}.thtrm-box--dark{background-color:var(--thtrm-color-darkblue)}.thtrm-box--mid{background-color:var(--thtrm-color-teal)}.thtrm-box>.thtrm-box__heading{margin-bottom:1rem}.thtrm-box--offset-left,.thtrm-box--offset-right{margin-bottom:.5rem}.thtrm-box>.thtrm-box__more-link{color:var(--thtrm-color-white);display:block;font-size:var(--thtrm-base-fontsize);text-decoration:none;margin-top:1rem}@media screen and (min-width:43.75em){.thtrm-box{padding:2rem}.thtrm-box:not([class*=thtrm-box--offset]){width:auto}.thtrm-box--offset-left,.thtrm-box--offset-right{margin-bottom:1rem;position:absolute;top:2.5rem;width:80%;right:-70%;z-index:var(--thtrm-layer-deco)}.thtrm-box--offset-right{right:-70%}.thtrm-box--offset-left{left:-70%}}.thtrm-button,[class*=thtrm-button],[class^=thtrm-button]{border:none;background-color:var(--thtrm-color-darkblue);color:var(--thtrm-color-white);display:inline-block;font-weight:var(--thtrm-base-fontweight);font-size:inherit;padding:.5rem 1rem;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.thtrm-page--yellow .thtrm-button,.thtrm-page--yellow [class*=thtrm-button],.thtrm-page--yellow [class^=thtrm-button]{background-color:#000}.thtrm-button--bordered{border:4px solid;background-color:transparent}.thtrm-button--ghost{color:inherit;padding:.25rem}.thtrm-button--ghost,.thtrm-page--yellow .thtrm-button--ghost{background-color:transparent}.thtrm-card{background-color:var(--thtrm-color-midblue);color:var(--thtrm-color-white);font-size:var(--thtrm-small-fontsize);padding:1rem;width:100%}.thtrm-card--red{background-color:var(--thtrm-amc-red)}.thtrm-card--black,.thtrm-card--red{box-shadow:0 2px 24px 0 rgba(0,0,0,.04)}.thtrm-card--black{background-color:var(--thtrm-git-orange)}.thtrm-card--pink{background-color:var(--thtrm-rxjs-pink)}.thtrm-card--pink,.thtrm-card--white{box-shadow:0 2px 24px 0 rgba(0,0,0,.04)}.thtrm-card--white{background-color:var(--thtrm-color-white);color:var(--thtrm-color-text)}.thtrm-card>.thtrm-card__heading{margin-bottom:1rem}.thtrm-card__topic{font-size:.625rem;margin-bottom:.5rem;color:var(--thtrm-color-white);text-transform:uppercase;letter-spacing:.02em}.thtrm-card__topic.thtrm-card__topic--red{color:var(--thtrm-amc-red)}.thtrm-card__topic.thtrm-card__topic--pink{color:var(--thtrm-rxjs-pink)}.thtrm-card__topic.thtrm-card__topic--grey{color:var(--thtrm-color-lighttext)}.thtrm-card__topic.thtrm-card__topic--black{color:var(--thtrm-git-orange)}.thtrm-card__list{list-style:none}.thtrm-card__list li{position:relative;padding-left:1rem;margin-top:.5em;line-height:1.2}.thtrm-card__list li:before{content:"\2192   ";margin-left:-1rem;position:absolute}.thtrm-card__paragraph{margin:.5rem 0}.thtrm-card__link{color:inherit}@media screen and (min-width:43.75em){.thtrm-card{padding:1.5rem}}.thtrm-form .thtrm-form__label{display:none}.thtrm-form .thtrm-form__input--text{background-color:var(--thtrm-color-gray);border:none;font-size:inherit;padding:.5rem 1rem;min-width:40%}.thtrm-form__info-text{font-size:.4rem;font-weight:400;max-width:500px;color:#aaa;margin:.4em auto auto}.thtrm-form__info-text a{text-decoration:underline;color:#aaa}.thtrm-form__info-text a:after{display:none}.thtrm-form__row{margin-top:16px}.thtrm-form__column-group{display:grid;grid-column-gap:24px;grid-template-columns:1fr 1fr;grid-template-rows:auto auto}.thtrm-form__column-group label{grid-row:1}.thtrm-form__column-group input{grid-row:2}.thtrm-icon,[class^=thtrm-icon--]{color:inherit;display:inline-block;vertical-align:middle;transition:all .25s linear;height:24px;width:24px}svg.thtrm-icon,svg[class^=thtrm-icon]{fill:currentColor}svg.thtrm-icon path:not([fill=none]),svg.thtrm-icon use,svg[class^=thtrm-icon] path:not([fill=none]),svg[class^=thtrm-icon] use{fill:inherit}.thtrm-image-grid{display:flex;flex-flow:column wrap;align-items:center;justify-content:space-around;z-index:var(--thtrm-layer-submarine);margin-top:-.25rem}.thtrm-image-grid img{text-align:center;-o-object-fit:contain;object-fit:contain;font-family:"object-fit: contain;";width:50%;max-width:200px;max-height:200px}@media screen and (min-width:20em){.thtrm-image-grid{flex-flow:row wrap}}@media screen and (min-width:43.75em){.thtrm-image-grid img{width:25%;max-width:18%;max-height:250px;-o-object-fit:contain;object-fit:contain;font-family:"object-fit: contain;"}}.thtrm-layout{display:grid;grid-gap:1rem;padding:1rem;width:100%}.thtrm-layout.thtrm-layout-fourths,.thtrm-layout.thtrm-layout-halfs,.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr}@media screen and (min-width:43.75em){.thtrm-layout.thtrm-layout-fourths,.thtrm-layout.thtrm-layout-halfs,.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr 1fr}}@media screen and (min-width:50em){.thtrm-layout.thtrm-layout-fourths,.thtrm-layout.thtrm-layout-halfs,.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr 1fr}}@media screen and (min-width:64em){.thtrm-layout.thtrm-layout-halfs,.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr 1fr}.thtrm-layout.thtrm-layout-fourths{grid-template-columns:1fr 1fr 1fr}}@media screen and (min-width:80em){.thtrm-layout{grid-gap:1.5rem;padding:1.5rem}.thtrm-layout.thtrm-layout-halfs{grid-template-columns:1fr 1fr}.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr 1fr 1fr}.thtrm-layout.thtrm-layout-fourths{grid-template-columns:1fr 1fr 1fr 1fr}}@media screen and (min-width:120em){.thtrm-layout{display:grid;grid-gap:1.5rem}.thtrm-layout.thtrm-layout-halfs{grid-template-columns:1fr 1fr}.thtrm-layout.thtrm-layout-thirds{grid-template-columns:1fr 1fr 1fr}.thtrm-layout.thtrm-layout-fourths{grid-template-columns:1fr 1fr 1fr 1fr 1fr}}.thtrm-logo{max-height:45px;width:160px;margin-top:-1.65rem}@media screen and (min-width:80em){.thtrm-logo{max-height:80px;width:200px;margin-top:-1rem}}@media screen and (min-width:120em){.thtrm-logo{max-height:100px;width:380px}}.thtrm-nav{display:flex;align-items:center;justify-content:space-between;font-size:var(--thtrm-nav-fontsize)}.thtrm-nav .thtrm-nav__list{background-color:var(--thtrm-color-lightgray);box-shadow:0 1px 2px rgba(50,50,50,.1);list-style:none;text-align:left;position:absolute;right:0;top:70%;width:auto;z-index:99;opacity:0;visibility:hidden;transition:.25s;transform:translate3d(0,-10%,0);padding:1rem .5rem}.thtrm-nav .thtrm-nav__list:before{content:"";width:10px;height:10px;border-right:6px solid transparent;border-left:6px solid transparent;border-bottom:6px solid var(--thtrm-color-lightgray);position:absolute;top:-10px;right:10px}.thtrm-nav .thtrm-nav__list li{padding:0 1rem;margin-top:.5rem}.thtrm-nav .thtrm-nav__list a{color:var(--thtrm-color-text);font-weight:var(--thtrm-base-fontweight);text-decoration:none;transition:.25s}.thtrm-nav .thtrm-nav__list a.active{border-bottom:2px solid var(--thtrm-color-text);padding-bottom:.3em}.thtrm-nav .thtrm-nav__list a:hover{color:var(--thtrm-color-blue)}.thtrm-nav .thtrm-nav__list a:after{content:""}.no-js .thtrm-nav .thtrm-nav__button:focus+.thtrm-nav__list,.no-js .thtrm-nav .thtrm-nav__button:hover+.thtrm-nav__list,.no-js .thtrm-nav__list:hover,.thtrm-nav__list.is-visible{opacity:1;pointer-events:all;visibility:visible;transform:translateZ(0)}.thtrm-nav-toc{border-top:3px solid #000;font-size:.75rem}.thtrm-nav-toc li{display:inline-block}.thtrm-nav-toc li:first-child a{padding-left:0}.thtrm-nav-toc li:last-child a{padding-right:0}.thtrm-nav-toc a{color:var(--thtrm-color-text);display:block;padding:.75rem 1rem}.thtrm-nav-toc a.is-active{color:var(--thtrm-color-midblue)}.thtrm-nav-toc a:after{content:""}@media screen and (min-width:50em){.thtrm-nav .thtrm-nav__list li:last-of-type{padding-right:0}.thtrm-nav .thtrm-nav__button,.thtrm-nav .thtrm-nav__list:before{display:none}.thtrm-nav .thtrm-nav__list{background-color:transparent;box-shadow:none;display:flex;flex-flow:row wrap;align-items:center;justify-content:flex-end;opacity:1;pointer-events:all;visibility:visible;transform:translateZ(0);position:static}}[class*=thtrm-ratio--]{position:relative}[class*=thtrm-ratio--]:before{content:"";display:block;width:100%}[class*=thtrm-ratio--]>*{position:absolute;bottom:0;left:0;right:0;top:0}[class*=thtrm-ratio--]>img{height:100%;-o-object-fit:cover;object-fit:cover}.thtrm-ratio--landscape:before{padding-top:75%}.thtrm-ratio--square:before{padding-top:100%}.thtrm-ratio--stripe:before{padding-top:50%}.thtrm-section,[class^=thtrm-section--]{position:relative;margin-bottom:3rem}.thtrm-section .thtrm-section__item,[class^=thtrm-section--] .thtrm-section__item{width:100%}.thtrm-section .thtrm-section__heading,[class^=thtrm-section--] .thtrm-section__heading{width:100%;margin-top:1.5rem;margin-bottom:.75rem}.thtrm-section .thtrm-section__paragraph,[class^=thtrm-section--] .thtrm-section__paragraph{margin-bottom:1rem}.thtrm-section .thtrm-section__paragraph a:after,[class^=thtrm-section--] .thtrm-section__paragraph a:after{display:none}.thtrm-section .thtrm-section__paragraph--small,[class^=thtrm-section--] .thtrm-section__paragraph--small{font-size:.8rem;font-weight:400}.thtrm-section .thtrm-section__link,[class^=thtrm-section--] .thtrm-section__link{display:inline-block;margin-bottom:1rem}.thtrm-section .thtrm-section__link--black,[class^=thtrm-section--] .thtrm-section__link--black{color:#000}.thtrm-section .thtrm-section__link--black .thtrm-section__link,[class^=thtrm-section--] .thtrm-section__link--black .thtrm-section__link{color:var(--thtrm-color-midblue)}.thtrm-section .thtrm-section__link--black .thtrm-section__link:after,[class^=thtrm-section--] .thtrm-section__link--black .thtrm-section__link:after{color:currentColor}.thtrm-section .thtrm-section__heading--unpadded-top,[class^=thtrm-section--] .thtrm-section__heading--unpadded-top{width:100%;margin-top:0;margin-bottom:.75rem}.thtrm-section .thtrm-section__heading--small,[class^=thtrm-section--] .thtrm-section__heading--small{width:100%;margin-bottom:1rem;font-size:1.25rem;line-height:1.3}.thtrm-section--centered{text-align:center}.thtrm-section--unpadded-bottom{margin-bottom:0}.thtrm-section--fullbleed{margin-left:-5vw;margin-right:-5vw;min-height:300px}.thtrm-section--fullbleed-intrinsic{margin-left:-5vw;margin-right:-5vw;margin-top:0}@media screen and (min-width:80em){.thtrm-section--fullbleed-intrinsic{margin-left:-10vw;margin-right:-10vw}}.thtrm-section--privacy-statement li,.thtrm-section--privacy-statement p,.thtrm-section--privacy-statement strong{font-size:.8rem;font-weight:400}.thtrm-section--privacy-statement p,.thtrm-section--privacy-statement ul{margin-bottom:.75rem}.thtrm-section--privacy-statement ul{margin-left:1rem}.thtrm-section--privacy-statement h3,.thtrm-section--privacy-statement h4{margin-bottom:1rem;margin-top:.5rem}.thtrm-stripe--fullwidth{font-weight:700;color:#fff;font-size:1.5rem;height:6rem;text-align:center;display:flex;width:100%;align-items:center;justify-content:center}.thtrm-section__footer,.thtrm-section__header{text-align:center;width:100%;padding:2rem 5vw}.thtrm-section__footer p+a,.thtrm-section__header p+a{display:inline-block;margin-top:2em}.thtrm-section__footer p>a:after,.thtrm-section__header p>a:after{display:none}.thtrm-section__subheading{margin-bottom:1rem}.thtrm-section--offright-white{background-color:var(--thtrm-color-white)}.thtrm-section__item--flushleft,.thtrm-section__item--flushright,.thtrm-section__item--fullwidth,.thtrm-section__item--halfpadded{width:100%}.thtrm-section__item--columns>*{margin-bottom:1rem}.thtrm-section__item--columns{font-size:var(--thtrm-small-fontsize);left:0}.thtrm-section__hero{width:100%;position:relative;margin-top:1rem;padding-top:6.25rem}.thtrm-section__hero .thtrm-section__hero-image{height:6.25rem;width:6.25rem;-o-object-fit:contain;object-fit:contain;position:absolute;left:0;top:0;z-index:var(--thtrm-layer-deco)}@media screen and (min-width:64em){.thtrm-section__hero{padding-left:16rem;margin-top:2rem;padding-top:0}.thtrm-section__hero .thtrm-section__hero-image{height:14rem;width:14rem}}@media screen and (min-width:120em){.thtrm-section__hero{width:75%}}.thtrm-content-box{background-color:var(--thtrm-color-darkblue);color:var(--thtrm-color-white);font-size:var(--thtrm-small-fontsize);padding:2rem;z-index:var(--thtrm-layer-deco)}.thtrm-section-constrained{max-width:800px;margin-left:auto;margin-right:auto;width:100%}@media screen and (min-width:50em){.thtrm-section--fullbleed{margin-left:var(--thtrm-page-neg-margin);margin-right:var(--thtrm-page-neg-margin);height:50vh;min-height:600px}}@media screen and (min-width:43.75em){.thtrm-section,[class^=thtrm-section--]{display:flex;flex-flow:row wrap;position:relative}.thtrm-section .thtrm-section__item,[class^=thtrm-section--] .thtrm-section__item{width:50%}.thtrm-section .thtrm-section__item--halfpadded,[class^=thtrm-section--] .thtrm-section__item--halfpadded{width:calc(50% - 5vw)}.thtrm-section .thtrm-section__item--flushright,[class^=thtrm-section--] .thtrm-section__item--flushright{position:relative;right:var(--thtrm-page-neg-margin);width:calc(50% + 5vw)}.thtrm-section .thtrm-section__item--flushleft,[class^=thtrm-section--] .thtrm-section__item--flushleft{position:relative;left:var(--thtrm-page-neg-margin);width:calc(50% + 5vw)}.thtrm-section .thtrm-section__item--pulldown,[class^=thtrm-section--] .thtrm-section__item--pulldown{position:relative;transform:translateY(50%);z-index:var(--thtrm-layer-deco)}.thtrm-section .thtrm-section__item--flushright-maxed,[class^=thtrm-section--] .thtrm-section__item--flushright-maxed{position:relative;right:var(--thtrm-page-neg-margin);width:calc(50% + 10vw)}.thtrm-section .thtrm-section__item--flushleft-maxed,[class^=thtrm-section--] .thtrm-section__item--flushleft-maxed{position:relative;left:var(--thtrm-page-neg-margin);width:calc(50% + 10vw)}.thtrm-section .thtrm-content-box,[class^=thtrm-section--] .thtrm-content-box{position:absolute;right:0;bottom:0;max-width:70%;transform:translate3d(0,50%,0)}.thtrm-section--undercut-bottom{margin-bottom:-2rem;z-index:var(--thtrm-layer-deco)}.thtrm-section--offright-white{background-color:var(--thtrm-color-white);max-width:70%;position:relative;right:-5%}.thtrm-section--fullbleed{margin-top:6rem}.thtrm-section__item--columns{display:grid;grid-template-columns:50% 50%;font-size:var(--thtrm-small-fontsize)}.thtrm-section__item--columns>*{margin-left:2%;margin-right:2%;-ms-grid-column-span:1}.thtrm-section__item--columns>:nth-child(odd){-ms-grid-column:1}.thtrm-section__item--columns>:nth-child(2n){-ms-grid-column:2}}@media screen and (min-width:64em){.thtrm-section__item--columns{display:grid;grid-template-columns:33% 33% 33%;font-size:var(--thtrm-small-fontsize)}.thtrm-section__item--columns>*{margin-bottom:.75rem}.thtrm-section__item--columns>:nth-child(3n+1){-ms-grid-column:1}.thtrm-section__item--columns>:nth-child(3n+2){-ms-grid-column:2}.thtrm-section__item--columns>:nth-child(3n+3){-ms-grid-column:3}}@media screen and (min-width:80em){.thtrm-section--padded-bottom{margin-bottom:7rem}.thtrm-section--offright-white{max-width:70%}.thtrm-section__footer p{padding-left:4em;padding-right:4em}}@media screen and (min-width:120em){.thtrm-section,[class^=thtrm-section--]{margin-bottom:5rem}.thtrm-section--fullbleed{height:50vh;min-height:700px}.thtrm-section--offright-white{max-width:50%;right:-30%}}.thtrm-stripe{background-color:var(--thtrm-color-lightblue);color:var(--thtrm-color-white);text-align:center;display:flex;flex-flow:column nowrap;align-items:center;justify-content:space-between;padding:1rem 2rem;min-height:140px;margin:auto;position:relative;z-index:var(--thtrm-layer-deco)}.thtrm-stripe .thtrm-stripe__cta,.thtrm-stripe .thtrm-stripe__location,.thtrm-stripe .thtrm-stripe__title{margin:.5rem 0}@media screen and (min-width:50em){.thtrm-stripe{flex-flow:row nowrap;position:absolute;left:var(--thtrm-page-margin);right:var(--thtrm-page-margin);transform:translateY(-50%)}}.thtrm-testimonials{width:90vw;display:block;overflow:hidden}.thtrm-testimonial{position:relative;width:100%;padding-top:1.75rem;font-size:1rem;line-height:1.5;white-space:normal;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.thtrm-testimonial:before{position:absolute;content:"\201C";top:-35px;left:20px;font-size:8rem;color:var(--thtrm-color-text);z-index:9999}.thtrm-testimonial>.thtrm-testimonial__avatar{display:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;pointer-events:none}.thtrm-testimonial>.thtrm-testimonial__quote{background-color:var(--thtrm-color-gray);padding:50px 30px 30px}.thtrm-testimonial>.thtrm-testimonial__quote cite{color:var(--thtrm-color-darkblue);font-size:.75em}.thtrm-testimonial--big{position:relative;right:0;margin-left:auto;max-width:100%}.thtrm-testimonial--big>.thtrm-testimonial__quote{background-color:var(--thtrm-color-white);padding:1rem 0 0;font-weight:400;font-style:italic}.thtrm-testimonial--big>.thtrm-testimonial__avatar{max-width:200px}.thtrm-testimonial--big>.thtrm-testimonial__quote cite{color:var(--thtrm-color-darkblue);font-size:.75em;font-style:normal;font-weight:var(--thtrm-base-fontweight);margin-top:.5rem}.thtrm-testimonial--big .thtrm-testimonial__heading{font-weight:var(--thtrm-base-fontweight);font-style:normal;margin-bottom:1rem}.thtrm-testimonials__navigation{margin-top:.5rem;text-align:center;width:100%}.thtrm-testimonials__thumbnail{width:50px;height:50px;-o-object-fit:cover;object-fit:cover;opacity:.5;font-family:"object-fit: cover;"}.is-active .thtrm-testimonials__thumbnail{opacity:1;transition:.25s}@media screen and (min-width:50em){.thtrm-testimonial{position:relative;width:100%;padding-top:50px}.thtrm-testimonial>.thtrm-testimonial:before{top:-65px;left:0;font-size:10rem}.thtrm-testimonials__thumbnail{width:100px;height:100px}.thtrm-testimonial>.thtrm-testimonial__quote{padding:68px 68px 68px 210px;max-width:80%;position:relative;left:10%;top:0;z-index:98;margin-top:40px}.thtrm-testimonial>.thtrm-testimonial__avatar{display:block;position:absolute;left:3%;top:40px;max-width:240px;z-index:99}.thtrm-testimonial--big{position:relative;right:0;margin-left:auto;top:-300px;max-width:55%;margin-bottom:-300px}.thtrm-testimonial--big>.thtrm-testimonial__quote{background-color:var(--thtrm-color-white);padding:2rem 3rem 0;font-weight:400;font-style:italic;font-size:1.25rem}.thtrm-testimonial--big>.thtrm-testimonial__avatar{position:absolute;bottom:0;left:-200px;max-width:200px}.thtrm-testimonial--big>.thtrm-testimonial__quote cite{color:var(--thtrm-color-darkblue);font-size:.75em;font-style:normal;font-weight:var(--thtrm-base-fontweight);margin-top:.5rem}.thtrm-testimonial--big .thtrm-testimonial__heading{font-weight:var(--thtrm-base-fontweight);font-style:normal;margin-bottom:1rem}}@media screen and (min-width:80em){.thtrm-testimonials{width:80vw}}.thtrm-testimonials .frame{width:100%;position:relative;font-size:0;line-height:0;overflow:hidden;white-space:nowrap}.thtrm-testimonials .slides{display:block}.thtrm-testimonials li{cursor:grab;cursor:-webkit-grab}.thtrm-testimonials li,.thtrm-testimonials li:active{position:relative;display:inline-block;width:100%;vertical-align:top}.thtrm-testimonials li:active{cursor:grabbing;cursor:-webkit-grabbing}.thtrm-teaser{display:flex;flex-direction:column}.thtrm-teaser img{display:block}.thtrm-teaser--row{align-items:flex-start;flex-direction:row;justify-content:space-between}.thtrm-teaser--row .thtrm-teaser__thumb{display:none;margin-top:0;width:160px}@media screen and (min-width:64em){.thtrm-teaser--row .thtrm-teaser__thumb{display:block}}.thtrm-teaser__thumb{margin-top:12px}.thtrm-teaser__title{margin-top:4px}.thtrm-teaser__paragraph{margin-top:8px}.thtrm-teaser__link{margin-top:12px}.thtrm-raw-link{color:var(--thtrm-color-text)}.thtrm-raw-link:hover{color:var(--thtrm-color-midblue)}.thtrm-raw-link:after{display:none}.thtrm-listing{display:flex;flex-direction:column;width:100%}.thtrm-listing__item{margin-top:24px;padding-top:24px;border-top:1px solid var(--thtrm-border-color)}.thtrm-page--yellow .thtrm-listing__item{border-top-color:#000}.thtrm-topic{font-size:var(--thtrm-small-fontsize)}.thtrm-title{font-size:var(--thtrm-h4-fontszize)}.thtrm-article{font-weight:300}.thtrm-article h2,.thtrm-article h3,.thtrm-article h4{margin-top:48px;font-weight:500}.thtrm-article h2:first-child,.thtrm-article h3:first-child,.thtrm-article h4:first-child{margin-top:0}.thtrm-article h2 code,.thtrm-article h3 code,.thtrm-article h4 code{margin:0;padding:0;background:transparent!important;color:inherit;font-family:inherit;font-size:inherit;line-height:inherit;text-shadow:inherit}.thtrm-article a:after{display:none}.thtrm-article p{margin-top:24px;font-size:.8rem}.thtrm-article p code{background-color:var(--thtrm-color-gray)!important;color:var(--thtrm-color-midblue)!important;text-shadow:none!important}.thtrm-article p:first-child{margin-top:0}.thtrm-article ol,.thtrm-article ul{margin-top:24px;padding-left:24px;font-size:.8rem}.thtrm-article ol li,.thtrm-article ul li{margin-top:12px}.thtrm-article ol li code,.thtrm-article ul li code{background-color:var(--thtrm-color-gray);color:var(--thtrm-color-midblue)}.thtrm-article ol li:first-child,.thtrm-article ul li:first-child{margin-top:0}.thtrm-article .gatsby-highlight{margin-top:24px;font-size:.65rem}.thtrm-article code{font-size:.65rem}.thtrm-article iframe{margin-top:24px;width:100%;min-height:400px}.thtrm-article-thumb{margin-bottom:32px}.thtrm-article-caption{margin-top:-16px;font-size:.6rem;width:100%;text-align:right}.thtrm-article-caption a:after{display:none}.thtrm-article-header{text-align:center}.thtrm-article-header,.thtrm-article-header__metabar,.thtrm-media{justify-content:center}.thtrm-media{align-items:center;display:grid;grid-template-rows:auto 1fr;text-align:center}@media screen and (min-width:64em){.thtrm-media{align-items:center;grid-template-columns:200px 1fr;grid-template-rows:none;justify-content:flex-start;text-align:left}}.thtrm-media__asset{margin:0 auto;max-width:200px}@media screen and (min-width:64em){.thtrm-media__asset{grid-column:1;max-width:none}}@media screen and (min-width:64em){.thtrm-media__body{grid-column:2}}.thtrm-media--top-start{align-items:flex-start}.thtrm-media-short{display:flex;flex-direction:row}.thtrm-media-short__body{padding-left:8px}.thtrm-avatar{height:25px;width:25px;border-radius:150px}.thtrm-metabar{flex-wrap:wrap;margin-top:-12px}.thtrm-metabar,.thtrm-metabar__item{align-items:center;display:flex;flex-direction:row}.thtrm-metabar__item{margin-top:4px}.thtrm-metabar__item:after{content:"/ ";padding:0 8px}.thtrm-metabar__item:last-child:after{display:none}.u-text--centered{text-align:center}.u-flex{align-items:center;display:flex;flex-direction:row}.u-flex--start{align-items:flex-start}.u-link-plain:after{display:none}.u-flex--nowrap{flex-wrap:nowrap}.u-flex--justify-center{justify-content:center}.u-flex--justify-end{justify-content:flex-end}.u-distance-reset{margin-top:0!important}.u-distance-tiny{margin-top:8px}.u-distance-small{margin-top:16px}.u-distance{margin-top:24px}.u-distance-medium{margin-top:48px}.u-distance-large{margin-top:100px}.u-distance-bottom-reset{margin-bottom:0!important}.u-unflex{display:block}.u-text--bigger{font-size:2em;line-height:1}.u-text--small{font-size:var(--thtrm-small-fontsize)}.u-min-h1{min-height:712px}.u-img-fit-height{height:100%;-o-object-fit:cover;object-fit:cover;font-family:"object-fit: cover;"}.u-mega-padding-bottom{margin-bottom:200px}.u-offscreen-text{position:absolute;left:-5000px}.u-fill-space{height:100%;width:100%}.u-color--red{color:var(--thtrm-amc-red)}.u-color--pink{color:var(--thtrm-rxjs-pink)}.u-color--grey{color:var(--thtrm-color-lighttext)}.u-bg-lightgray{background-color:var(--thtrm-color-ultralightgray)}.u-bg--red{background-color:var(--thtrm-amc-red)}.u-bg--pink{background-color:var(--thtrm-rxjs-pink)}.u-bg--orange{background-color:var(--thtrm-git-orange)}.u-color--orange{color:var(--thtrm-git-orange)}@media screen and (min-width:50em){.u-max-width--half{max-width:50%;margin:0 auto;width:100%}}@media screen and (min-width:50em){.u-max-width--3-4{max-width:75%;margin:0 auto;width:100%}}</style><style data-href="/styles.246d67a4ef7e9adeefa5.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.15.21"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#384c54"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=50794189bf1d1bd3459211725d37e57e"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=50794189bf1d1bd3459211725d37e57e"/><title data-react-helmet="true">Advanced caching with RxJS | Articles by thoughtram</title><meta data-react-helmet="true" name="description" content="When building web applications, performance should always be a top priority. One very efficient way to optimize the performance of our applications and improve the experience of our site is to use caching mechanisms. In this post we&#x27;ll develop an advanced caching mechanism with RxJS and the tools provided by Angular to cache application data."/><meta data-react-helmet="true" name="google-site-verification" content="o9eGPEgIETEqYGombq7NiQuBIB_qa6gz1yAL7PxKyK0"/><meta data-react-helmet="true" name="theme-color" content="#384c54"/><meta data-react-helmet="true" property="og:title" content="Advanced caching with RxJS"/><meta data-react-helmet="true" property="og:description" content="When building web applications, performance should always be a top priority. One very efficient way to optimize the performance of our applications and improve the experience of our site is to use caching mechanisms. In this post we&#x27;ll develop an advanced caching mechanism with RxJS and the tools provided by Angular to cache application data."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="thoughtram"/><meta data-react-helmet="true" name="twitter:title" content="Advanced caching with RxJS"/><meta data-react-helmet="true" name="twitter:description" content="When building web applications, performance should always be a top priority. One very efficient way to optimize the performance of our applications and improve the experience of our site is to use caching mechanisms. In this post we&#x27;ll develop an advanced caching mechanism with RxJS and the tools provided by Angular to cache application data."/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-6a14d6c49d22aa388ff9.js"/><link as="script" rel="preload" href="/styles-e0e38ca7b54561c3f057.js"/><link as="script" rel="preload" href="/commons-9a6c7e4a80f98fe6d0b9.js"/><link as="script" rel="preload" href="/app-db11fdec89ef44788bcc.js"/><link as="script" rel="preload" href="/webpack-runtime-c99afa6b532686815600.js"/><link as="fetch" rel="preload" href="/page-data/angular/2018/03/05/advanced-caching-with-rxjs.html/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="thtrm-page undefined"><header class="thtrm-banner" role="banner"><a href="https://thoughtram.io" title="Home"><img src="/static/logo-8fe34043fb96d58a991170a33702a469.svg" alt="thoughtram" class="thtrm-logo" title="The thoughtram logo"/></a></header><main class="thtrm-main" role="main"><nav class="thtrm-nav-toc"><a title="Back to Blog" href="/">← Back to Blog</a></nav><div style="margin:auto;text-align:center;min-height:30px" id="codefund"></div><script type="text/javascript" src="https://app.codefund.io/properties/723/funder.js" async=""></script><section class="thtrm-section u-distance-bottom-reset"><div class="thtrm-section__heading thtrm-article-header thtrm-section-constrained u-distance-bottom-reset"><div class="thtrm-metabar thtrm-article-header__metabar"><div class="thtrm-metabar__item thtrm-topic u-color--grey"><div class="thtrm-media-short"><img alt="Author" src="https://avatars0.githubusercontent.com/u/12571019?s=400&amp;v=4" class="thtrm-avatar"/><p class="thtrm-media-short__body"><a href="https://twitter.com/d3lm" class="u-link-plain">Dominic Elm</a></p></div></div><time dateTime="05 March 2018" class="thtrm-metabar__item thtrm-topic u-color--grey">05 March 2018</time><p class="thtrm-metabar__item thtrm-topic u-color--grey"><a class="u-link-plain" href="/categories/angular">Angular</a></p></div><h1 class="thtrm-section__subheading u-distance-tiny">Advanced caching with RxJS</h1></div><div class="thtrm-ratio--stripe thtrm-article-thumb u-fill-space u-img-fit-height gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:66.625%"></div><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUCAwT/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAByOF1guJkf//EABoQAAIDAQEAAAAAAAAAAAAAAAADARMiAhH/2gAIAQEAAQUCX4Wrr7nSpGzg/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BV//EABgQAAMBAQAAAAAAAAAAAAAAAAAQIQEx/9oACAEBAAY/Alq4Wn//xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhYTFx/9oACAEBAAE/IUV6rwlE0o7pHZTxpEJfRn//2gAMAwEAAgADAAAAEBA//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8QR//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EGP/xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhMXH/2gAIAQEAAT8QNpKnrv3XmQAcPHRZY1gt2QOvgeYogOkXB1Ai1N//2Q==" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/4dcba919d21b7d986d8bd9b25275ef06/10bdc/advanced_caching.jpg 158w,
/static/4dcba919d21b7d986d8bd9b25275ef06/f4ab0/advanced_caching.jpg 315w,
/static/4dcba919d21b7d986d8bd9b25275ef06/30037/advanced_caching.jpg 630w,
/static/4dcba919d21b7d986d8bd9b25275ef06/9810d/advanced_caching.jpg 945w,
/static/4dcba919d21b7d986d8bd9b25275ef06/ff2e4/advanced_caching.jpg 1260w,
/static/4dcba919d21b7d986d8bd9b25275ef06/989b1/advanced_caching.jpg 1600w" sizes="(max-width: 630px) 100vw, 630px" /><img loading="lazy" sizes="(max-width: 630px) 100vw, 630px" srcset="/static/4dcba919d21b7d986d8bd9b25275ef06/10bdc/advanced_caching.jpg 158w,
/static/4dcba919d21b7d986d8bd9b25275ef06/f4ab0/advanced_caching.jpg 315w,
/static/4dcba919d21b7d986d8bd9b25275ef06/30037/advanced_caching.jpg 630w,
/static/4dcba919d21b7d986d8bd9b25275ef06/9810d/advanced_caching.jpg 945w,
/static/4dcba919d21b7d986d8bd9b25275ef06/ff2e4/advanced_caching.jpg 1260w,
/static/4dcba919d21b7d986d8bd9b25275ef06/989b1/advanced_caching.jpg 1600w" src="/static/4dcba919d21b7d986d8bd9b25275ef06/30037/advanced_caching.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></section><section class="thtrm-section thtrm-section-constrained thtrm-article u-distance"><div class="thtrm-section__heading u-distance-reset"><p>When building web applications, performance should always be a top priority. There are many things we can do to speed up our Angular applications like tree-shaking, AoT (ahead-of-time compilation), lazy loading modules or caching. To get an overview of practices that will help you boost the performance of your Angular applications, we highly recommend you to check out the <a href="https://github.com/mgechev/angular-performance-checklist#lazy-loading-of-resources">Angular Performance Checklist</a> by <a href="https://twitter.com/mgechev">Minko Gechev</a>. In this post we focus on <strong>caching</strong>.</p>
<p>In fact, caching is one of the most efficient ways to improve the experience of our site, especially when our users are on bandwidth restricted devices or slow networks.</p>
<p>There are several ways to cache data or assets. Static assets are most commenly cached with the standard browser cache or Service Workers. While Service Workers can also cache API requests, they are typically more useful for caching resources like images, HTML, JS or CSS files. To cache application <em>data</em> we usually use custom mechanisms.</p>
<p>No matter what mechanism we use, a cache generally <strong>improves the responsiveness</strong> of our application, <strong>decreases network costs</strong> and has the advantage that <strong>content becomes available during network interruptions</strong>. In other words, when the content is cached closer to the consumer, say on the client side, requests don’t cause additional network activity and cached data can be retrieved much faster because we save on an entire network round trip.</p>
<p>In this post we’ll develop an advanced caching mechanism with RxJS and the tools provided by Angular.</p>
<h2>Motivation</h2>
<p>Every now and then there’s this question popping up how to cache data in an Angular application that makes excessive use of Observables. Most people have a good understanding on how to cache data with Promises but feel overwhelmed when it comes to functional reactive programming, due to its complexity (large API), fundamental shift in mindset (from imperative to declarative) and the multitude of concepts. Hence, it can be hard to actually translate an existing caching mechanism based on Promises to Observables, especially if you want that mechanism to be a little bit more advanced.</p>
<p>In an Angular application, we typically perform HTTP requests through the <code class="language-text">HttpClient</code> that comes with the <code class="language-text">HttpClientModule</code>. All of its APIs are Observable-based meaning that methods like <code class="language-text">get</code>, <code class="language-text">post</code>, <code class="language-text">put</code> or <code class="language-text">delete</code> return an Observable. Because Observables are lazy by nature the request is only made when we call <code class="language-text">subscribe</code>. However, calling <code class="language-text">subscribe</code> multiple times on the same Observable will cause the source Observable to be re-created over and over again and, hence, perform a request on each subscription. We call this <strong>cold</strong> Observables.</p>
<p>If you are completely new to this, we have written an article on <a href="/angular/2016/06/16/cold-vs-hot-observables.html">Cold vs Hot Observables</a>.</p>
<p>This behavior can make it tricky to implement a caching mechanism with Observables. Simple approaches often require a fair amount of boilerplate and we probably end up bypassing RxJS, which works, but is not the recommended way if we want to harness the power of Observables. Literally speaking, we don’t wanna drive a Ferrari with a scooter engine, right?</p>
<h2>The Requirements</h2>
<p>Before we dive into code, let’s start to define the requirements for our advanced caching mechanism.</p>
<p>We want to build an application called <strong>World of Jokes</strong>. It’s a simple app that randomly shows jokes for a given category. To keep it simple and focused, there’s only one category.</p>
<p>This app has three components: <code class="language-text">AppComponent</code>, <code class="language-text">DashboardComponent</code> and <code class="language-text">JokeListComponent</code>.</p>
<p>The <code class="language-text">AppComponent</code> is our entry point and renders a toolbar as well as a <code class="language-text">&lt;router-outlet&gt;</code> that is filled based on the current router state.</p>
<p>The <code class="language-text">DashboardComponent</code> simply shows a list of categories. From here, we can navigate to the <code class="language-text">JokeListComponent</code> which then renders a list of jokes onto the screen.</p>
<p>The jokes themselves are fetched from a server using Angular’s <code class="language-text">HttpClient</code> service. To keep the component’s responsibility focused and separate the concerns, we want to create a <code class="language-text">JokeService</code> that takes care of requesting the data. The component can then simply inject the service and access the data through its public APIs.</p>
<p>All of the above is just our application’s architecture and there’s no caching involved yet.</p>
<p>When navigating from the dashboard to the list view, we prefer to request the data from a cache rather than requesting it from the server every time. The underlying data of this cache would update itself every 10 seconds.</p>
<p>Of course, polling for new data every 10 seconds isn’t a solid strategy for a production app where we would rather use a more sophisticated approach to update the cache (e.g. web socket push updates). But we’ll try to keep things simple here to focus on the caching aspect.</p>
<p>In any case we’d receive some sort of update notification. For our application we want the data in the UI (<code class="language-text">JokeListComponent</code>) to not automatically update when the cache updates but rather waits for the user to enforce the UI update. Why? Imagine a user may be reading one of the jokes and then all of a sudden it’s gone because the data is updated automatically. That would be super annoying and a bad user experience. Therefore, our users receive notifications whenever new data is available.</p>
<p>To make it even more fun, we want the user to be able to force the cache to update. This is different from solely updating the UI because forcing an update means to freshly request the data from the server, update the cache and then also update the UI accordingly.</p>
<p>Let’s summarize what we want to build:</p>
<ul>
<li>Our app has two components where navigating from component A to B should prefer requesting B’s data from a cache rather than requesting it from the server every time</li>
<li>Cache is updated every 10 seconds</li>
<li>Data in the UI is not automatically updated and requires the user to enforce an update</li>
<li>User can force an update that will cause a request to actually update the cache and the UI</li>
</ul>
<p>Here’s a preview of what we are going to build:</p>
<p><img src="/de01053cbb60b1444dbc31084e68240b/cache_app_preview.gif" alt="app preview"></p>
<h2>Implementing a basic cache</h2>
<p>Let’s start simple and work our way up to the final and fully-fledged solution.</p>
<p>The first step is to create a new service.</p>
<p>Next, we’ll add two interfaces, one that describes the shape of a <code class="language-text">Joke</code> and the other is used to <strong>strongly type</strong> the response of our HTTP request. This makes TypeScript happy but most importantly more convenient and obvious to work with.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Joke</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  joke<span class="token punctuation">:</span> string<span class="token punctuation">;</span>
  categories<span class="token punctuation">:</span> Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span><span class="token plain-text">;
}

export interface JokeResponse </span><span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> string<span class="token punctuation">;</span>
  value<span class="token punctuation">:</span> Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Joke</span></span><span class="token punctuation">></span></span><span class="token plain-text">;
}</span></code></pre></div>
<p>Now let’s implement the <code class="language-text">JokeService</code>. We don’t want to reveal the implementation detail of whether the data was served from cache or freshly requested from the server, hence we simply expose a property <code class="language-text">jokes</code> returning an Observable that captures a list of jokes.</p>
<p>In order to perform HTTP requests, we need to make sure to inject the <code class="language-text">HttpClient</code> service in the <strong>constructor</strong> of our service.</p>
<p>Here’s the shell for the <code class="language-text">JokeService</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeService</span> <span class="token punctuation">{</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> http<span class="token punctuation">:</span> HttpClient</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">jokes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Next, we implement a <em>private</em> method <code class="language-text">requestJokes()</code> which uses the <code class="language-text">HttpClient</code> to perform a <em>GET</em> request to retrieve a list of jokes.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeService</span> <span class="token punctuation">{</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> http<span class="token punctuation">:</span> HttpClient</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">jokes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">requestJokes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span>get<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">JokeResponse</span></span><span class="token punctuation">></span></span><span class="token plain-text">(API_ENDPOINT).pipe(
      map(response => response.value)
    );
  }
}</span></code></pre></div>
<p>With that in place, we have everything we need to implement the <code class="language-text">jokes</code> getter method.</p>
<p>One naive approach would be to simply return <code class="language-text">this.requestJokes()</code>, but that doesn’t do the trick. We know from the beginning that all methods exposed by the <code class="language-text">HttpClient</code>, for instance <code class="language-text">get</code>, return <strong>cold</strong> Observables. This means that the whole data stream is re-emitted for each subscriber causing an overhead of HTTP requests. After all, the idea behind a cache is to speed up the load time of our application and limit the amount of network requests to a minimum.</p>
<p>Instead we want to make our stream <strong>hot</strong>. Not only that, but every new subscriber should receive the latest cached value. It turns out that there’s a very convenient operator called <code class="language-text">shareReplay</code>. This operator returns an Observable that shares a <strong>single</strong> subscription to the underlying source, which is the Observable returned from <code class="language-text">this.requestJokes()</code>.</p>
<p>In addition, <code class="language-text">shareReplay</code> accepts an optional parameter <code class="language-text">bufferSize</code> that is really handy in our case. The <code class="language-text">bufferSize</code> determines the maximum element count of the replay buffer, that is the number of elements that are cached and replayed for every subscriber. For our scenario we only want to replay the most recent value and, hence, set the <code class="language-text">bufferSize</code> to one (1).</p>
<p>Let’s look at the code and use what we have just learned:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Observable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shareReplay<span class="token punctuation">,</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">API_ENDPOINT</span> <span class="token operator">=</span> <span class="token string">'https://api.icndb.com/jokes/random/5?limitTo=[nerdy]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CACHE_SIZE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> cache$<span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Joke</span></span><span class="token punctuation">></span></span><span class="token plain-text">>;

  constructor(private http: HttpClient) </span><span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token plain-text">

  get jokes() </span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cache$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">requestJokes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">shareReplay</span><span class="token punctuation">(</span><span class="token constant">CACHE_SIZE</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache$<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">

  private requestJokes() </span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span>get<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">JokeResponse</span></span><span class="token punctuation">></span></span><span class="token plain-text">(API_ENDPOINT).pipe(
      map(response => response.value)
    );
  }
}</span></code></pre></div>
<p>Ok, we already talked about most of what we see above. But wait, what’s about the private <code class="language-text">cache$</code> property and <code class="language-text">if</code> statement inside the getter? The answer to this is quite simple. If we returned <code class="language-text">this.requestJokes().pipe(shareReplay(CACHE_SIZE))</code> directly then every subscriber creates a <strong>new</strong> cache instance. However, we want to share a single instance across all subscribers. Therefore, we keep the instance in a private property <code class="language-text">cache$</code> and initialize it as soon as the getter was called the first time. All subsequent consumers will receive the shared instance without re-creating the cache every time.</p>
<p>Let’s look at a more visual representation of what we’ve just implemented:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/09604c3dd9a4385deaed1e323d42c4f2/7d0e5/cache_sequence_diagram.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.351606805293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAABPUlEQVQoz3WS146DQAxF+f//QzwACh3Re285whuWJLt+GBmPj33tQdF13TAM0zRxyrKMokgilmUVReE4Dn6e58dptm0/Ho+6rjVNc11XaZqGuziOkyTB4cyyjCpkjOPYnDbPs8Bt2/K5LAu3+AqhaZrIXte167phGCQDh0+SqEsCPszxsn3fORXxtm27LugjPGeapqqqMovv+33fXznkQynHl9GHtlIOIAgCdBFhBZSjNOOgCKV/wzACoxYYgCAAccTjsx1KKPcZ5LzDNGThYRhSoqoqJIh4Svwr+4LpCYBgz/M4WR7KiaP5B5bVs6HiNHk8Ssh4RMQnDRItb7AsgPGkCW3lMeeX3V9IFP3C8s4kwUOKCnkt5qQcEcYmB0Wfsr/fGYaKNEcUvvw58sPR4A3+MBgyttOEv8sGu+AnMkLvNkfD0ZAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="cache sequence diagram"
        title="cache sequence diagram"
        src="/static/09604c3dd9a4385deaed1e323d42c4f2/8ff1e/cache_sequence_diagram.png"
        srcset="/static/09604c3dd9a4385deaed1e323d42c4f2/9ec3c/cache_sequence_diagram.png 200w,
/static/09604c3dd9a4385deaed1e323d42c4f2/c7805/cache_sequence_diagram.png 400w,
/static/09604c3dd9a4385deaed1e323d42c4f2/8ff1e/cache_sequence_diagram.png 800w,
/static/09604c3dd9a4385deaed1e323d42c4f2/6ff5e/cache_sequence_diagram.png 1200w,
/static/09604c3dd9a4385deaed1e323d42c4f2/2f950/cache_sequence_diagram.png 1600w,
/static/09604c3dd9a4385deaed1e323d42c4f2/7d0e5/cache_sequence_diagram.png 2645w"
        sizes="(max-width: 800px) 100vw, 800px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Above we can see a <strong>sequence diagram</strong> that depicts the objects involved in our scenario, that is requesting a list of jokes, and the sequences of messages exchanged between the objects. Let’s break it down to understand what’s going on here.</p>
<p>We start out on the dashboard from where we navigate to the list component.</p>
<p>After the component was initialized and Angular calls the <code class="language-text">ngOnInit</code> life cycle hook, we request the list of jokes by calling the getter function <code class="language-text">jokes</code> exposed by the <code class="language-text">JokeService</code>. Since this is the first time we ask for the data, the cache itself is empty and not yet initialized, meaning <code class="language-text">JokeService.cache$</code> is <code class="language-text">undefined</code>. Internally we call <code class="language-text">requestJokes()</code>. This will give us an Observable that emits the data from the server. At the same time we apply the <code class="language-text">shareReplay</code> operator to get the desired behavior.</p>
<p>The <code class="language-text">shareReplay</code> operator automatically creates a <code class="language-text">ReplaySubject</code> between the original source and all future subscribers. As soon as the number of subscribers goes from zero to one it will connect the Subject to the underlying source Observable and broadcast all its values. All future subscribers will be connected to that in-between Subject, so that effectively there’s just one subscription to the underlying cold Observable. This is called <strong>multicasting</strong> and defines the foundation for our simple cache.</p>
<p>Once the data comes back from the server it will be cached.</p>
<p>Note that the <code class="language-text">Cache</code> is a standalone object in the sequence diagram and is supposed to illustrate the <code class="language-text">ReplaySubject</code> that is created in between the consumer (subscribers) and the underlying source (HTTP request).</p>
<p>The next time we request the data for the list component, our cache will replay the most recent value and send that to the consumer. There’s no additional HTTP call involved.</p>
<p>Simple, right?</p>
<p>To rip this really apart, let’s take this one step further and look at how the cache works on an Observable level. For this we use a <strong>marble diagram</strong> to visualize how the stream actually works:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4a4c0279ed7a2dfee6c644d4707fac69/68b76/cache_share_replay.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 51.128608923884514%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZ0lEQVQoz3WSTU7DMBSEc1HWnIJDsIMbsOUKSCwQXaBSCZK2Ck2bpk7ipI4dP//F5oWWvwq+RSTbmjczsaPlcpkkSZwkDaUNByEESNh3zeXk7KV4sOCF4P1flGUZfS0G53oTiBi0CyH4Qiy0k+F/hmGIvhaoJ1VN6qamDSKY2resKIosy9brNfo0n1BKGWOr1epb3HUd2e2q8ki2eduR3WKxmE6ns9kM9VV1PCSE4Ij5fD6KlVKvcVxXFeXAOYdetoxePZ0n5LETHhRopTCX+A3OOjpba70fpA1Ueu087mRV3EOnbBDGGdzx/o/O3nsMjB201mAck0Yb55y9X96Sdm1dKLnleGBPAYAIB2y3281mwzqG+UFKBYrx/U188ZJP0jwF1WFsCadg7dE5z/M0TdF/vKKPeJgSv86666fz5+2d10HK/lMlD+A/jw6F0ROz/qx00LeybNramDGk0kZZp8ZSGBefhXsHBIA3HbDEkvkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="cache share replay"
        title="cache share replay"
        src="/static/4a4c0279ed7a2dfee6c644d4707fac69/8ff1e/cache_share_replay.png"
        srcset="/static/4a4c0279ed7a2dfee6c644d4707fac69/9ec3c/cache_share_replay.png 200w,
/static/4a4c0279ed7a2dfee6c644d4707fac69/c7805/cache_share_replay.png 400w,
/static/4a4c0279ed7a2dfee6c644d4707fac69/8ff1e/cache_share_replay.png 800w,
/static/4a4c0279ed7a2dfee6c644d4707fac69/6ff5e/cache_share_replay.png 1200w,
/static/4a4c0279ed7a2dfee6c644d4707fac69/2f950/cache_share_replay.png 1600w,
/static/4a4c0279ed7a2dfee6c644d4707fac69/68b76/cache_share_replay.png 1905w"
        sizes="(max-width: 800px) 100vw, 800px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>The marble diagram makes it really clear that there’s only <strong>one subscription</strong> to the underlying Observable and all consumers simply subscribe to the shared Observable, that is the <code class="language-text">ReplaySubject</code>. We can also see that only the first subscriber triggers the HTTP call and all others get the latest value replayed.</p>
<p>Finally, let’s look at the <code class="language-text">JokeListComponent</code> and how we can display the data. The first step is to inject the <code class="language-text">JokeService</code>. After that, inside <code class="language-text">ngOnInit</code> we initialize a property <code class="language-text">jokes$</code> with the value returned by the getter function that is exposed by our service. This will return an Observable of type <code class="language-text">Array&lt;Joke&gt;</code> and this is exactly what we want.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  jokes$<span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Joke</span></span><span class="token punctuation">></span></span><span class="token plain-text">>;

  constructor(private jokeService: JokeService) </span><span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token plain-text">

  ngOnInit() </span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>jokes$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jokeService<span class="token punctuation">.</span>jokes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">

  ...
}</span></code></pre></div>
<p>Note that we are not imperatively subscribing to <code class="language-text">jokes$</code>. Instead we use the <code class="language-text">async</code> pipe in the template because it turns out that this pipe is full of little wonders. Curious? Check out this article that unravels <a href="/angular/2017/02/27/three-things-you-didnt-know-about-the-async-pipe.html">three things you didn’t know about the AsyncPipe</a>.</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-card</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>let joke of jokes$ | async<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-card</span><span class="token punctuation">></span></span></code></pre></div>
<p>Cool! Here’s our simple cache in action. To verify if the request is only made once, open up Chrome’s DevTools, click on the <em>Network</em> tab and then select <em>XHR</em>. Start out on the dashboard, go to the list view and then navigate back and forth.</p>
<iframe style="height: 500px" src="https://stackblitz.com/edit/advanced-caching-with-rxjs-step-1?ctl=1&embed=1&file=app/joke.service.ts&view=preview" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
<h2>Automatic updates</h2>
<p>So far we have built a simple caching mechanism in a few lines of code. In fact, most of the heavy lifting is done by the <code class="language-text">shareReplay</code> operator which takes care of caching and replaying the most recent value(s).</p>
<p>This works perfectly fine but the data is never actually updated in the background. What if the data is likely to change every few minutes? We certainly don’t want to force the user to reload the entire page just to get the latest data from the server.</p>
<p>Wouldn’t it be cool if our cache is updated every 10 seconds in the background? Totally! As a user we don’t have to reload the page and if the data has changed the UI will update accordingly. Again, in a real-world application we would most probably not even use polling but instead have the server <strong>push</strong> notifications. For our little demo app a <em>refresh interval</em> of 10 seconds is just fine.</p>
<p>The implementation is fairly easy. In a nutshell, we want to create an Observable that emits a sequence of values spaced by a given time interval, or simply said, we want to produce a value every <em>X</em> milliseconds. For that we have several options.</p>
<p>The first option is to use <code class="language-text">interval</code>. This operator takes an optional parameter <code class="language-text">period</code> that defines the time between each emission. Consider the following example:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/observable/interval'</span><span class="token punctuation">;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Here we set up an Observable that emits an infinite sequence of integers where each value is emitted every 10 seconds. That also means that the first value is somewhat delayed by the given interval. To better demonstrate the behavior, let’s take a look at the marble diagram for <code class="language-text">interval</code>.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/91d558f19e64d2c38dd9f1bf97634a31/b4436/interval_operator.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 20.22147327876745%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA1ElEQVQI102LO07DQBiEfVQKRMEFqGjoOAAIIVGFAiEkDhCJwgfgqZBQOAJDpDghwtjZ/Xf3f0wWpWGqme/TFFVVfc1mfeA1cedjS5ETLkeHZX0LQd3Wpw9789+lCYbTwc3kmBm91/Pn/aePsgghpJREVEWSWEvKinVoA3sziHJHK1GBgZJzsctQ1frwExIV+BcDuggSsMZ8+yNmkWlrM2GJ256hmhZZ59E0zXj8ulgsnXfqMRgdlO9XiKi/304ed+arTwsYVhfXkyMhuN6fvezeT+82tnPc2s1i89sAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="interval operator"
        title="interval operator"
        src="/static/91d558f19e64d2c38dd9f1bf97634a31/8ff1e/interval_operator.png"
        srcset="/static/91d558f19e64d2c38dd9f1bf97634a31/9ec3c/interval_operator.png 200w,
/static/91d558f19e64d2c38dd9f1bf97634a31/c7805/interval_operator.png 400w,
/static/91d558f19e64d2c38dd9f1bf97634a31/8ff1e/interval_operator.png 800w,
/static/91d558f19e64d2c38dd9f1bf97634a31/6ff5e/interval_operator.png 1200w,
/static/91d558f19e64d2c38dd9f1bf97634a31/2f950/interval_operator.png 1600w,
/static/91d558f19e64d2c38dd9f1bf97634a31/b4436/interval_operator.png 2077w"
        sizes="(max-width: 800px) 100vw, 800px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Yep, as expected. The first value is “delayed” and this is not what we want. Why? Because if we come from the dashboard and navigate to the list component to read some funny jokes, we’d have to wait for 10 seconds before the data is requested from the server and rendered onto the screen.</p>
<p>We could fix this by introducing another operator called <code class="language-text">startWith(value)</code> which would emit the given <code class="language-text">value</code> first, as an initial value. But we can do better!</p>
<p>What if I told you that there’s an operator that emits a sequence of values after a given duration (initial delay) and then after each period (regular interval)? Meet <code class="language-text">timer</code>.</p>
<p>Visualization time!</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3af2199188e2cb55ee1d8a1bc50eee32/ea2dd/timer_operator.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 24.333719582850524%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5klEQVQY04WPMU7DQBBFfTe4CD3iDCjQQ0GdFokudNATCAWQoMSWEBiMLGwRy8b2zM7O7s5ghECi4lW/+k8vKotcHKABsNKTa4EcfagN4/n28WrfsxLr/dv17uVG0ayNFTB6dLM1iQ8eli8RGTTYMltiD8TspTVWRR6r2VO9EFEOWmN1W5wbts6L8xq/T1+buG8xUlXRP3SsJSp5/ZfodyFi13UIgOyQhvvZcz2XoD5Ig+u74ozY+BDCl/kiq3/M32RZliRJmqaA4EDHi52T1cijMrllPt272iyrnAxR74bm0+RwaP4EZrsUIsLOndcAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="timer operator"
        title="timer operator"
        src="/static/3af2199188e2cb55ee1d8a1bc50eee32/8ff1e/timer_operator.png"
        srcset="/static/3af2199188e2cb55ee1d8a1bc50eee32/9ec3c/timer_operator.png 200w,
/static/3af2199188e2cb55ee1d8a1bc50eee32/c7805/timer_operator.png 400w,
/static/3af2199188e2cb55ee1d8a1bc50eee32/8ff1e/timer_operator.png 800w,
/static/3af2199188e2cb55ee1d8a1bc50eee32/6ff5e/timer_operator.png 1200w,
/static/3af2199188e2cb55ee1d8a1bc50eee32/2f950/timer_operator.png 1600w,
/static/3af2199188e2cb55ee1d8a1bc50eee32/ea2dd/timer_operator.png 1726w"
        sizes="(max-width: 800px) 100vw, 800px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Cool, but does that really solve our problem? Yep it does. If we set the initial delay to <strong>zero (0)</strong> and set the period to <strong>10 seconds</strong>, we end up with the same behavior as if we used <code class="language-text">interval(10000).pipe(startWith(0))</code> but only with a single operator.</p>
<p>Let’s take that and plug it into our exisiting caching mechanism.</p>
<p>We have to set up a <strong>timer</strong> and for every <em>tick</em> we want to make an HTTP request to fetch new data from the server. That is, for every tick we need to <strong>switchMap</strong> to an Observable that, on subscription, fetches a new list of jokes. Using <code class="language-text">switchMap</code> has the positive side effect that we avoid race conditions. That’s due to the nature of this operator because it will unsubscribe from the previously projected Observable and only emit values from the most recently projected Observable.</p>
<p>The rest of our cache remains untouched, meaning that our stream is still multicasted and all subscribers share one underlying source.</p>
<p>Again, the nature of <code class="language-text">shareReplay</code> will broadcast new values to exisiting subscribers and replay the most recent value to new subscribers.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f70a3fd57b58d673a43f23a1abf65aaf/7c216/timer_cache.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70.68295391449195%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB60lEQVQoz31Sy47TMBTtF/EL7JBYsuEb+Ag+ACGxZ8GKxbAYzWokWMFmKiRaRDtMJ+lQ2jQvJ43rPBrbSezY5qYRnYeqOYurm3vvOT659sCy7W2COC9Zo4qqVtJcrE/eX77ijdHaXOMf736+LJtaKYN2m7e/Xvi5K6ThrUZRNKCUMlpWFa9FyxsBQ0tkXbrDNNthTBbu/Lv9xUHLeLsNPMjPURKTrCB50ZHNfUgpfTfYxmSzif844WR6dT29+To5my1m8+HpfDpZr30Uhgghx3EekgFtK8FOnhfJt9fk7wUpWJ7mna7SqkOrlG5hSMojZIDWXXs7fFN440pozmhf7ntKVv3YcXKPWhil4UcE55wBYDVCZ2iOPj3HkYui+DGyaCrdmVTgEIxA1lSMWOfY+gxiWZYNjnruIQQsXx2KECl20MmzyF9WjYwQevRkIXrOXV1Rs0PxHpnukRKS7YExTtMUYhTBMShJEiiStGvleQ6fg7uqcHUrZ71YufF+OvB9iLZtj8fj0WgECaiEYYBQCMlqtXpoG9Zb1KoS3aL2F6sPJiHplqeM+o9b8qHEhcEM3rhJPKvmu/5qewnVyng9g9hr3ZKDILAsy/U8xuGlc1qW/sen+Pcpl4bRHaOU15KEdvjhCQlvGql9z/sH/6cXDX365cMAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="timer cache"
        title="timer cache"
        src="/static/f70a3fd57b58d673a43f23a1abf65aaf/8ff1e/timer_cache.png"
        srcset="/static/f70a3fd57b58d673a43f23a1abf65aaf/9ec3c/timer_cache.png 200w,
/static/f70a3fd57b58d673a43f23a1abf65aaf/c7805/timer_cache.png 400w,
/static/f70a3fd57b58d673a43f23a1abf65aaf/8ff1e/timer_cache.png 800w,
/static/f70a3fd57b58d673a43f23a1abf65aaf/6ff5e/timer_cache.png 1200w,
/static/f70a3fd57b58d673a43f23a1abf65aaf/2f950/timer_cache.png 1600w,
/static/f70a3fd57b58d673a43f23a1abf65aaf/7c216/timer_cache.png 1801w"
        sizes="(max-width: 800px) 100vw, 800px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>As we can see in the marble diagram, the timer emits a value every 10 seconds. For every value we switch to an inner Observable that fetches our data. Because we are using <code class="language-text">switchMap</code>, we avoid race conditions and therefore the consumer only receives the value <code class="language-text">1</code> and <code class="language-text">3</code>. The value from the second inner Observable is “skipped” because we are already unsubscribed when the value arrives.</p>
<p>Let’s apply our learnings and update the <code class="language-text">JokeService</code> accordingly.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> timer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/observable/timer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> switchMap<span class="token punctuation">,</span> shareReplay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">REFRESH_INTERVAL</span> <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> cache$<span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Joke</span></span><span class="token punctuation">></span></span><span class="token plain-text">>;

  constructor(private http: HttpClient) </span><span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token plain-text">

  get jokes() </span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Set up timer that ticks every X milliseconds</span>
      <span class="token keyword">const</span> timer$ <span class="token operator">=</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">REFRESH_INTERVAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// For each tick make an http request to fetch new data</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cache$ <span class="token operator">=</span> timer$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">requestJokes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">shareReplay</span><span class="token punctuation">(</span><span class="token constant">CACHE_SIZE</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache$<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">

  ...
}</span></code></pre></div>
<p>Awesome! Wanna try it out yourself? Go ahead and play with the following live demo. From the dashboard, go to the list component and then watch the magic happening. Give it a few seconds so that you can see the update in action. Remember, the cache is refreshed every <strong>10 seconds</strong>, but feel free to fiddle with the <code class="language-text">REFRESH_INTERVAL</code>.</p>
<iframe style="height: 500px" src="https://stackblitz.com/edit/advanced-caching-with-rxjs-step-2?ctl=1&embed=1&file=app/joke.service.ts&view=preview" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
<h2>Sending update notifications</h2>
<p>Let’s recap for a moment what we have built so far.</p>
<p>When we request data from our <code class="language-text">JokeService</code> we always prefer to request that data from a cache rather than requesting it from the server every time. The underlying data of this cache is refreshed every 10 seconds and when this happens, the data is propagated to the component causing the UI to update automatically.</p>
<p>That’s unfortunate. Imagine we’re a user that is reading one of the jokes and all of the sudden it’s gone because the UI is updated automatically. That’s super annoying and a bad user experience.</p>
<p>Therefore, our users should rather receive <strong>notifications</strong> when there’s new data available. In other words, we want the user to enforce the UI update.</p>
<p>It turns out that we don’t have to touch our service in order to implement this. The logic is quite simple. After all, our service should not worry about sending notifications and the view should be in charge when and how to update the data on the screen.</p>
<p>First, we have to get an <strong>initial value</strong> to show something to the user, because otherwise the screen will be blank until the cache was updated the first time. We’ll see why in just a moment. Setting up a stream for the inital value is as easy as calling the getter function. Additionally, since we are only interested in the very first value we can use the <code class="language-text">take</code> operator.</p>
<p>To make this logic reusable we create a helper methode <code class="language-text">getDataOnce()</code>.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> take <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> initialJokes$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>

  <span class="token function">getDataOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jokeService<span class="token punctuation">.</span>jokes<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>From our requirements we know that we only want to update the UI when the user really enforces an update rather than reflecting the change automatically. How does the user enforce an update you ask? This happens when we click on a button in the UI that says “Update”. This button is shown together with the notification. For now, let’s not worry about the notification and instead focus on the logic that updates the UI when we click that button.</p>
<p>To make this work, we need a way to create an Observable from DOM events, specifically from button clicks. There are several ways but a very common way is to use a <code class="language-text">Subject</code> as a <strong>bridge</strong> between the template and the view logic that lives in the component class. In a nutshell, a Subject is a type that implements both <code class="language-text">Observer</code> and <code class="language-text">Observable</code> types. Observables define the data flow and produce the data while Observers can subscribe to Observables and receive the data.</p>
<p>The good thing about the Subject here is that we can simply use an event binding in the template and then call <code class="language-text">next</code> when the event is triggered. This will cause the specified value to be broadcasted to all Observers that are listening for values. Note that we can also omit the value if the Subject is of type <code class="language-text">void</code>. In fact, this is true for our case.</p>
<p>Let’s go ahead and instantiate a new Subject.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Subject'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  update$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text">();
  ...
}</span></code></pre></div>
<p>Now we can go ahead and wire this up in the template.</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notification<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>There's new data available. Click to reload the data.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">mat-raised-button</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>accent<span class="token punctuation">"</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>update$.next()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>flex-row<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-icon</span><span class="token punctuation">></span></span>cached<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-icon</span><span class="token punctuation">></span></span>
      UPDATE
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<p>See how we use the <strong>event binding</strong> syntax to capture the click event on the <code class="language-text">&lt;button&gt;</code>? When we click on the button we simply propagate a <em>ghost</em> value causing all active Observers to be notified. We call it ghost value because we are not actually passing in any value, or at least a value of type <code class="language-text">void</code>.</p>
<p>Another way would be to use the <code class="language-text">@ViewChild()</code> decorator in combination with the <code class="language-text">fromEvent</code> operator from RxJS. However, this requires us to “mess” with the DOM and query an HTML element from the view. With a Subject we are actually just bridging the two sides and don’t really touch the DOM at all except the event binding we are adding to the button.</p>
<p>Alright, with the view being setup we can now switch to the logic that takes care of updating the UI.</p>
<p>So what does it mean to update the UI? Well, the cache is updated in the background automatically and we want to render the most recent value from the cache when we click on that button, right? This means that our <strong>source</strong> stream in this case is the Subject. Every time a value is broadcasted on <code class="language-text">update$</code> we want to <strong>map</strong> this value to an Observable that gives us the latest cached value. In other words, we are dealing with a so-called <strong>Higher Order Observable</strong>, an Observable that emits Observables.</p>
<p>From before we should know that there’s <code class="language-text">switchMap</code> that solves exactly this problem. This time we’ll use <code class="language-text">mergeMap</code> instead. This operator behaves very similar to <code class="language-text">switchMap</code> with the difference that it does not unsubscribe from the previously projected inner Observable and simply merges the inner emissions in the output Observable.</p>
<p>In fact, when requesting the most recent value from the cache, the HTTP request is already done and the cache was successfully updated. Therefore, we don’t really face the problem of race-conditions here. Though it seems to be asynchronous, it’s actually somewhat <strong>synchronous</strong> because the value will be emitted in the same <em>tick</em>.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Subject'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mergeMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  update$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text">();
  ...

  ngOnInit() </span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">const</span> updates$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token plain-text">
  ...
}</span></code></pre></div>
<p>Sweet! For every “update” we request the latest value from the cache using our helper method we implemented earlier.</p>
<p>From here, it’s only a small step to come up with the stream for the jokes that are rendered onto the screen. All we have to do is to merge the initial list of jokes with our <code class="language-text">update$</code> stream.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Observable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Subject'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/observable/merge'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mergeMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  jokes$<span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Joke</span></span><span class="token punctuation">></span></span><span class="token plain-text">>;
  update$ = new Subject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text">();
  ...

  ngOnInit() </span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> initialJokes$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> updates$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>jokes$ <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>initialJokes$<span class="token punctuation">,</span> updates$<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token plain-text">
  ...
}</span></code></pre></div>
<p>It’s important that we use our helper method <code class="language-text">getDataOnce()</code> to map each update event to the latest cached value. If we recall, it uses <code class="language-text">take(1)</code> internally which will take the first value and then <strong>complete</strong> the stream. This is crucial because otherwise we’d end up with an on-going stream or live connection to the cache. In this case we would basically break our logic of enforcing a UI update only by clicking the “Update” button.</p>
<p>Also, because the underlying cache is multicasted, it’s totally safe to always re-subscribe to the cache to get the latest value.</p>
<p>Before we continue with the notification stream, let’s stop for a moment and visualize what we just implemented as a marble diagram.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/fc97a55e2c09ce83f0fc9c7deb3b1917/79fa9/jokes.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 85.6536101934875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAABYlAAAWJQFJUiTwAAACZ0lEQVQ4y3VTSW/TQBj1/0Xc4MAFiQN3JMQZCS4cy6USCLVIFVKFkGikUIJD4zYk8TLjLZ7Fs/PstKUQ8aTYzufPM99bJgohOOc4513XbYUWJijjjPPhDpz3vXFhDxG+jON4vV5ba2XfB98/fpe/nTYhGK21Ugrfnq3YvYPU9KIfIaVEvWmayHsvhMDOVVWVVdU2zXmSxZerPF3HV+tfKcmX3y9Xm6/zdV2VdV3VNyjLMtoNgMXyPC9GVCRbJMtZnJycxdOL1eXk/cXPOS0y2khS1oQUhFC0oT+6JeBH4N5xxTYTNj+0PmjdgxfellXTTt/wcqm0w9y75mhPBW9DaBafii8vmbQgZoxGVQhJT5+3WcylbtvmWjCoArbgbEbgL3bfpjMy++AHI+yubq1LJweKUfjg7FAE0whqJUkC9pBRSCGl6E1oL46rzy+kDhI7SpiguBD05CnLf/QaAnOo3bbt/tj/hd/3eSfVeHVCdTfPNjjzb6/Twfu7AkdIyHwek7zMmqtX5w9ISQRGVFpgPI6nP5DGC9mLsQouUCrC9JRSxpjo+aZegKQynhdxl5wgp2qMFHrw2y6O5bZQ2qqxAo0HwZbL5WiJscZp1RsPwY6q02fawWc1SAu7lSZHj3g+w1v0wBSchYEzBkC2yZCunAwoCK2LcksJybIMvHDFdKTaElqOCRtwnTDOWFk3KW3gPgAP2qZu62q812maIslDsR6S395gOBi36jW9p1xdK+ks0vGP2NZo7//yK8KqGIySelNfvZ4+xPrShPLbQfHxCVees4513XDaGU8P77eriVCOsQ5qI1e/AaccxFFkiLiHAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="jokes"
        title="jokes"
        src="/static/fc97a55e2c09ce83f0fc9c7deb3b1917/8ff1e/jokes.png"
        srcset="/static/fc97a55e2c09ce83f0fc9c7deb3b1917/9ec3c/jokes.png 200w,
/static/fc97a55e2c09ce83f0fc9c7deb3b1917/c7805/jokes.png 400w,
/static/fc97a55e2c09ce83f0fc9c7deb3b1917/8ff1e/jokes.png 800w,
/static/fc97a55e2c09ce83f0fc9c7deb3b1917/6ff5e/jokes.png 1200w,
/static/fc97a55e2c09ce83f0fc9c7deb3b1917/2f950/jokes.png 1600w,
/static/fc97a55e2c09ce83f0fc9c7deb3b1917/79fa9/jokes.png 2119w"
        sizes="(max-width: 800px) 100vw, 800px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>As we can see in the diagram above, <code class="language-text">initialJokes$</code> is crucial because otherwise we’d only see something on the screen when we click “Update”. While the data is already updated in the background every 10 seconds, there’s no way we can press this button. That’s because the button is part of the notification and we never really show it to the user.</p>
<p>Let’s fill this gap and implement the missing functionality to complete the puzzle.</p>
<p>For that, we have to create an Observable that is responsible for showing or hiding the notification. Essentially, we need a stream that either emits <code class="language-text">true</code> or <code class="language-text">false</code>. We want the value to be <code class="language-text">true</code> when there’s an update, and <code class="language-text">false</code> when the user clicks on the “Update” button.</p>
<p>In addition we want to <strong>skip</strong> the first (initial) value emitted by our cache because it’s not really a refresh.</p>
<p>If we think in terms of streams, we can break this up into multiple streams and <strong>merge</strong> them together to turn them into a single Observable. The final stream then has the desired behavior to show or hide notifications.</p>
<p>Enough theory! Here’s the code:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Observable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Subject'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> skip<span class="token punctuation">,</span> mapTo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  showNotification$<span class="token punctuation">:</span> Observable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">></span></span><span class="token plain-text">;
  update$ = new Subject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text">();
  ...

  ngOnInit() </span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">const</span> initialNotifications$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jokeService<span class="token punctuation">.</span>jokes<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> show$ <span class="token operator">=</span> initialNotifications$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> hide$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showNotification$ <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>show$<span class="token punctuation">,</span> hide$<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">
  ...
}</span></code></pre></div>
<p>Here, we listen for all values emitted by our cache but skip the first because it’s not a <strong>refresh</strong>. For every new value on <code class="language-text">initialNotifications$</code> we map it to <code class="language-text">true</code> to show the notification. Once we click the “Update” button in the notification, a value is produced on <code class="language-text">update$</code> and we can simply map it to <code class="language-text">false</code> causing the notification to disappear.</p>
<p>Let’s use <code class="language-text">showNotification$</code> inside the template of the <code class="language-text">JokeListComponent</code> to toggle a class that either shows or hides the notification.</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notification<span class="token punctuation">"</span></span> <span class="token attr-name">[class.visible]</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showNotification$ | async<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<p>Yay! We are getting really close to the final solution. But before we continue, let’s try it out and play around with the live demo. Take your time and go through the code step by step again.</p>
<iframe style="height: 500px" src="https://stackblitz.com/edit/advanced-caching-with-rxjs-step-3?ctl=1&embed=1&file=app/joke.service.ts&view=preview" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
<h2>Fetching new data on demand</h2>
<p>Awesome! We have come a long way and already implemented a few very cool features for our cache. To finish up this article and take our cache to a whole new level, there’s one thing left for us to do. As a user we want to be able to <strong>force</strong> an update at any point in time.</p>
<p>It’s not really that complicated but we have to touch both the component and the service to make this work.</p>
<p>Let’s start with our service. What we need is a public facing API that will force the cache to reload the data. Technically speaking, we’ll <strong>complete</strong> the current cache and set it to <code class="language-text">null</code>. This means that the next time we request the data from our service we will set up a new cache, fetch the data and store this for future subscribers. It’s not a big deal to create a new cache every time we enforce an update because it will be completed and eventually garbage collected. In fact, this has the positive side effect that we also <strong>reset</strong> the timer which is absolutely desired. Let’s say we have waited 9 seconds and now click “Fetch new Jokes”. We expect the data to be refreshed, but we don’t to see a notification popping up 1 second later. Instead we want to restart the timer so that when we enforce an update it another 10 seconds to trigger the <strong>automatic update</strong>.</p>
<p>Another reason for the destroying the cache is that it’s much less complex compared to a mechanism that keeps the cache running all the time. If that’s the case then the cache needs to be aware of whether a reload was enforced or not.</p>
<p>Let’s create a Subject that we use to tell the cache to complete. We’ll leverage <code class="language-text">takeUntil</code> and pluck it into our <code class="language-text">cache$</code> stream. In addition, we implement a public facing API that, internally, sets the cache to <code class="language-text">null</code> and also broadcasts an event on our Subject.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Subject'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> timer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/observable/timer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> switchMap<span class="token punctuation">,</span> shareReplay<span class="token punctuation">,</span> map<span class="token punctuation">,</span> takeUntil <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">REFRESH_INTERVAL</span> <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> reload$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text">();
  ...

  get jokes() </span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> timer$ <span class="token operator">=</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">REFRESH_INTERVAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>cache$ <span class="token operator">=</span> timer$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">requestJokes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reload$<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">shareReplay</span><span class="token punctuation">(</span><span class="token constant">CACHE_SIZE</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache$<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">

  forceReload() </span><span class="token punctuation">{</span>
    <span class="token comment">// Calling next will complete the current cache instance</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reload$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Setting the cache to null will create a new cache the</span>
    <span class="token comment">// next time 'jokes' is called</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache$ <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">

  ...
}</span></code></pre></div>
<p>This alone doesn’t do much, so let’s go ahead and use that in our <code class="language-text">JokeListComponent</code>. For this we’ll implement a function <code class="language-text">forceReload()</code> that is called whenever we click on the button that says “Fetch new Jokes”. Also, we need to create a Subject that is used as an event bus for updating the UI as well as showing the notifications. We’ll see in a moment where this comes into play.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Subject'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  forceReload$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text">();
  ...

  forceReload() </span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>jokeService<span class="token punctuation">.</span><span class="token function">forceReload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>forceReload$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">
  ...
}</span></code></pre></div>
<p>With this in place we can wire up the button in the template of the <code class="language-text">JokeListComponent</code> to force the cache to reload the data. All we have to do is listen for the <code class="language-text">click</code> event using Angular’s event binding syntax and call <code class="language-text">forceReload()</code>.</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reload-button<span class="token punctuation">"</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>forceReload()<span class="token punctuation">"</span></span> <span class="token attr-name">mat-raised-button</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>accent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>flex-row<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-icon</span><span class="token punctuation">></span></span>cached<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-icon</span><span class="token punctuation">></span></span>
    FETCH NEW JOKES
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></code></pre></div>
<p>This already works, but only if we go back to the dashboard and then again to the list view. This is of course not what we want. We want the UI to update <strong>immediately</strong> when we force the cache to reload the data.</p>
<p>Remeber that we have implemented a stream <code class="language-text">updates$</code> that, when we click on “Update”, requests the latest data from our cache? It turns out that we need exactly the same behavior, so we can go ahead and extend this stream. This means we have to <strong>merge</strong> both <code class="language-text">update$</code> and <code class="language-text">forceReload$</code>, because those two streams are the sources for updating the UI.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Subject'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/observable/merge'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mergeMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  update$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text">();
  forceReload$ = new Subject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text">();
  ...

  ngOnInit() </span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">const</span> updates$ <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>update$<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>forceReload$<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token plain-text">
  ...
}</span></code></pre></div>
<p>That was easy, wasn’t it? Yea but we are not done. In fact, we just “broke” our notifications. It all works just fine until we click “Fetch new Jokes”. The data is updated on the screen as well as in our cache, but when we wait 10 seconds there’s no notification popping up. The problem here is that forcing an update will complete the cache instance, meaning we no longer receive values in the component. The notification stream (<code class="language-text">initialNotifications$</code>) is basically dead. That’s unfortunate, so how can we fix this?</p>
<p>Quite easy! We listen for events on <code class="language-text">forceReload$</code> and for every value we switch to a new notification stream. Important here is that we <strong>unsubscribe</strong> from the <strong>previous</strong> stream. Does that ring a bell? Sounds a lot like we need <code class="language-text">switchMap</code> here, doesn’t it?</p>
<p>Let’s get our hands dirty and implement this!</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Observable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/Subject'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/observable/merge'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> take<span class="token punctuation">,</span> switchMap<span class="token punctuation">,</span> mergeMap<span class="token punctuation">,</span> skip<span class="token punctuation">,</span> mapTo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JokeListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  showNotification$<span class="token punctuation">:</span> Observable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">></span></span><span class="token plain-text">;
  update$ = new Subject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text">();
  forceReload$ = new Subject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text">();
  ...

  ngOnInit() </span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">const</span> reload$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>forceReload$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getNotifications</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> initialNotifications$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getNotifications</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> show$ <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>initialNotifications$<span class="token punctuation">,</span> reload$<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> hide$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showNotification$ <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>show$<span class="token punctuation">,</span> hide$<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">

  getNotifications() </span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jokeService<span class="token punctuation">.</span>jokes<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">
  ...
}</span></code></pre></div>
<p>That’s it. Whenever <code class="language-text">forceReload$</code> emits a value we unsubscribe from the previous Observable and switch to a new <em>notification</em> stream. Note that there’s a piece of code that we needed twice, that is <code class="language-text">this.jokeService.jokes.pipe(skip(1))</code>. Instead of repeating ourselves, we created a function <code class="language-text">getNotifications()</code> that simply returns a stream of jokes but <strong>skips</strong> the first value. Finally, we merge both <code class="language-text">initialNotifications$</code> and <code class="language-text">reload$</code> together into one stream called <code class="language-text">show$</code>. This stream is responsible for showing the notification on the screen. There’s also no need to unsubscribe from <code class="language-text">initialNotifications$</code> because this stream completes before the cache is re-created on the next subscription. The rest stays the same.</p>
<p>Puh, we did it. Let’s take a moment and look at a more visual representation of what we just implemented.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f3afff57dea325487ec8e2f07a53d1ea/79b5e/notification_cache.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 110.96075778078485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAABYlAAAWJQFJUiTwAAADB0lEQVQ4y5VUaY/bNhD1//8lRZAGSIGkQdIjKIoUKIxsssVms75tiaIOSqR4n1JH8mbt9FsfLII0OaM38x61GGeEEITgUlupjRBCCvHXlgqXYGsYpgELvyEWZikNZ6SUFufgvu8RQjBqrZVSUspXd4RQzlVPKQtK3e7YHw9ddLClzoB3PAYPc37OeVVVTdMQQvp6wurzenO/zZdV/U/Z4bKsK/gTzpzHS/ATJm4x9gelQshfEt5Y/Dshd62OxmproDZjjdDW2sfgJ8QQtPUuJB/8lPTxGSNPhgV29OgNlzRmLxgcuQQDW6jZOae1sdYZo20Y+f2Ppi/F5p3Cd34YZflAb39SrG6XPyjjLsFPnJ/675znzU6JnpNMsNq4YJ2Kuh5SCArDmSkY2EProJBgY7Ip6KD2FuQyxsRh9JAmJR+j9z6mYZxFukgFTcYYH7NjhzvbOVHJ4mcitbAu8GxpJJP4TnW5i6OmiKNbLSg/LZU2F9rwci64NkpppeMktjKefn3Nu7J++KXHX7UfebXu1r8JWrf3r5Seu33mABNKaZ7nJehZlMAFF0VFxCnLt3tUVgQXCFekbHpcViUBssViGC6t4j0vwQh1jfCpnvzQFPi4P+wOqx0kAu9AVtiq6goVR1DnQtvEXnsRfBSa/Xl6pozybviQPaeyvsFvD92XMY6IrZboNVPNh9NzZ8MCrAINA9GurZKG9G0Sh2/tfSxw3jqXuQBHQIu0C23bgkNgO8ZpY92YT0hP3kpT2K61H3NYDrCcckHWGC/eZozOv+mRnN1n5GbfKMFwVVFMHk7kIyw5o9ORCV3XLcara8WlhDYAha5r85KccEO7LkN5eShRQY7Tsr3Glc5uUC7CxXA+ANmbTLxf9zBxPkKNt0j8ujovwxlQ439v1f/CFAxuKsAPoC9I2cAAD6gMIwHD7A/brDpuUQ1fguZ7TMHQN7hA0ENhHJMG+ASfgncxwMUELcCIyhggCse+w+LqAwix3vjBeL1q33/B8u+jgk6GWVIsNptuOSsX0wx45b/C8eScVtA2SwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="notification cache"
        title="notification cache"
        src="/static/f3afff57dea325487ec8e2f07a53d1ea/8ff1e/notification_cache.png"
        srcset="/static/f3afff57dea325487ec8e2f07a53d1ea/9ec3c/notification_cache.png 200w,
/static/f3afff57dea325487ec8e2f07a53d1ea/c7805/notification_cache.png 400w,
/static/f3afff57dea325487ec8e2f07a53d1ea/8ff1e/notification_cache.png 800w,
/static/f3afff57dea325487ec8e2f07a53d1ea/6ff5e/notification_cache.png 1200w,
/static/f3afff57dea325487ec8e2f07a53d1ea/2f950/notification_cache.png 1600w,
/static/f3afff57dea325487ec8e2f07a53d1ea/79b5e/notification_cache.png 2956w"
        sizes="(max-width: 800px) 100vw, 800px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>As we can see in the marble diagrams, <code class="language-text">initialNotifications$</code> is very important for showing notifications. If we were missing this particular stream then we would only see a notification when we force the cache to update. That said, when we request new data on demand, we have to constantly switch to a new notification stream because the previous (old) Observable will complete and no longer emit values.</p>
<p>That’s it! We’ve made it and implemented a sophisticated caching mechanism using RxJS and the tools provided by Angular. To recap, our service exposes a stream that gives us a list of jokes. The underlying HTTP request is periodically triggered every 10 seconds to update the cache. To improve the user experience, we show a notification so that the user has to enforce an update of the UI. On top of that, we have implemented a way for the user to request new data on demand.</p>
<p>Awesome! Here’s the final solution. Take a few minutes to review the code once again. Try out different scenarios to see if everything works as expected.</p>
<iframe style="height: 500px" src="https://stackblitz.com/edit/advanced-caching-with-rxjs-step-4?ctl=1&embed=1&file=app/joke.service.ts&view=preview" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
<h2>Outlook</h2>
<p>If you want some homework or brain food for later, here are some thoughts for improvements:</p>
<ul>
<li>Add error handling</li>
<li>Refactor the logic from the component into a service to make it reusable</li>
</ul>
<h2>Special Thanks</h2>
<p>Special thanks to <a href="https://twitter.com/KwintenP">Kwinten Pisman</a> for helping me with the code. Also, I’d like to thank <a href="https://twitter.com/BenLesh">Ben Lesh</a> and <a href="https://twitter.com/BTroncone">Brian Troncone</a> for giving me valuable feedback and pointing out a few improvements. In addition, big thanks to <a href="https://twitter.com/cburgdorf">Christoph Burgdorf</a> for reviewing my article as well as the code.</p></div></section><section class="thtrm-section"><div class="thtrm-section__heading thtrm-article-header thtrm-section-constrained u-distance-reset"><div class="thtrm-metabar thtrm-article-header__metabar"><div class="thtrm-metabar__item thtrm-topic u-color--grey"><div class="thtrm-media-short">Written by  <img alt="Author" src="https://avatars0.githubusercontent.com/u/12571019?s=400&amp;v=4" class="thtrm-avatar"/><p class="thtrm-media-short__body"><a href="https://twitter.com/d3lm" class="u-link-plain">Dominic Elm</a></p></div></div></div></div></section></main><footer class="thtrm-footer" role="contentinfo"><div class="thtrm-copyright"><p>© <!-- -->2024<!-- --> The thoughtram Blog Maintainers</p></div></footer><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" hidden=""><symbol viewBox="0 0 24 24" id="icon--chevron-right"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path><path d="M0 0h24v24H0z" fill="none"></path></symbol><symbol viewBox="0 0 24 24" id="icon--chevron-down"><path d="M7.41 7.84L12 12.42l4.59-4.58L18 9.25l-6 6-6-6z"></path><path d="M0-.75h24v24H0z" fill="none"></path></symbol><symbol viewBox="0 0 24 24" id="icon--menu"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path><path d="M0 0h24v24H0z" fill="none"></path></symbol></svg></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-51360648-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/angular/2018/03/05/advanced-caching-with-rxjs.html";window.webpackCompilationHash="0c5d630095500f933ccd";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-db11fdec89ef44788bcc.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-6a14d6c49d22aa388ff9.js"],"component---src-templates-category-js":["/component---src-templates-category-js-4376524bed80ab31f5c7.js"],"component---src-pages-404-js":["/component---src-pages-404-js-6a74e57e5569370f5224.js"],"component---src-pages-all-js":["/component---src-pages-all-js-7aa251af6b402c5bb6a7.js"],"component---src-pages-confirmation-thank-you-js":["/component---src-pages-confirmation-thank-you-js-e20b16d362e2acd832ef.js"],"component---src-pages-finish-newsletter-subscription-js":["/component---src-pages-finish-newsletter-subscription-js-9bc9dd352c7e25398f2b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-34313bc70d6e2470e416.js"]};/*]]>*/</script><script src="/webpack-runtime-c99afa6b532686815600.js" async=""></script><script src="/app-db11fdec89ef44788bcc.js" async=""></script><script src="/commons-9a6c7e4a80f98fe6d0b9.js" async=""></script><script src="/styles-e0e38ca7b54561c3f057.js" async=""></script><script src="/component---src-templates-blog-post-js-6a14d6c49d22aa388ff9.js" async=""></script></body></html>